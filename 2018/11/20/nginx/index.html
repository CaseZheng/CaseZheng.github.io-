<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="msvalidate.01" content="F14AAB2D4C842CB9F200D0A80DA8CB2F">
  <meta name="baidu-site-verification" content="GNlbaIvRtqlfiBfg">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.casezheng.date","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="nginx介绍轻量级,高性能,跨平台Web服务器,基于REST架构风格,以统一资源描述符(URI)或统一资源定位符(URL)作为沟通依据,通过HTTP为浏览器等客户端程序提供各种网络服务. nginx特性 更快 单次请求得到更快的响应 高并发下比其它web服务器更快地响应请求   高扩展性 高可靠性 低内存消耗 高并发 热部署 不停服升级nginx,不停服更新配置,不停服更快日志文件等 开源(BS">
<meta name="keywords" content="linux,nginx">
<meta property="og:type" content="article">
<meta property="og:title" content="nginx学习笔记">
<meta property="og:url" content="http://www.casezheng.date/2018/11/20/nginx/index.html">
<meta property="og:site_name" content="CaseZheng">
<meta property="og:description" content="nginx介绍轻量级,高性能,跨平台Web服务器,基于REST架构风格,以统一资源描述符(URI)或统一资源定位符(URL)作为沟通依据,通过HTTP为浏览器等客户端程序提供各种网络服务. nginx特性 更快 单次请求得到更快的响应 高并发下比其它web服务器更快地响应请求   高扩展性 高可靠性 低内存消耗 高并发 热部署 不停服升级nginx,不停服更新配置,不停服更快日志文件等 开源(BS">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://www.casezheng.date/Picture/simplified_flow_of_nginx_http_module_calls.svg">
<meta property="og:image" content="http://www.casezheng.date/Picture/nginx_ngx_list_t.png">
<meta property="og:updated_time" content="2018-11-20T01:50:37.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="nginx学习笔记">
<meta name="twitter:description" content="nginx介绍轻量级,高性能,跨平台Web服务器,基于REST架构风格,以统一资源描述符(URI)或统一资源定位符(URL)作为沟通依据,通过HTTP为浏览器等客户端程序提供各种网络服务. nginx特性 更快 单次请求得到更快的响应 高并发下比其它web服务器更快地响应请求   高扩展性 高可靠性 低内存消耗 高并发 热部署 不停服升级nginx,不停服更新配置,不停服更快日志文件等 开源(BS">
<meta name="twitter:image" content="http://www.casezheng.date/Picture/simplified_flow_of_nginx_http_module_calls.svg">

<link rel="canonical" href="http://www.casezheng.date/2018/11/20/nginx/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>nginx学习笔记 | CaseZheng</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?4f1686055a927fa7bf1a09bc1143b57c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">CaseZheng</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">CaseZheng Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.casezheng.date/2018/11/20/nginx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CaseZheng">
      <meta itemprop="description" content="CaseZheng的博客网站">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CaseZheng">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          nginx学习笔记
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-20 09:50:37" itemprop="dateCreated datePublished" datetime="2018-11-20T09:50:37+08:00">2018-11-20</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/高性能服务器/" itemprop="url" rel="index"><span itemprop="name">高性能服务器</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="nginx介绍"><a href="#nginx介绍" class="headerlink" title="nginx介绍"></a>nginx介绍</h1><p>轻量级,高性能,跨平台Web服务器,基于REST架构风格,以统一资源描述符(URI)或统一资源定位符(URL)作为沟通依据,通过HTTP为浏览器等客户端程序提供各种网络服务.</p>
<h1 id="nginx特性"><a href="#nginx特性" class="headerlink" title="nginx特性"></a>nginx特性</h1><ol>
<li>更快<ol>
<li>单次请求得到更快的响应</li>
<li>高并发下比其它web服务器更快地响应请求</li>
</ol>
</li>
<li>高扩展性</li>
<li>高可靠性</li>
<li>低内存消耗</li>
<li>高并发</li>
<li>热部署 不停服升级nginx,不停服更新配置,不停服更快日志文件等</li>
<li>开源(BSD许可)</li>
</ol>
<p>核心:支持高并发的同时保持高效的服务</p>
<h1 id="nginx编译安装"><a href="#nginx编译安装" class="headerlink" title="nginx编译安装"></a>nginx编译安装</h1><h2 id="源码获取"><a href="#源码获取" class="headerlink" title="源码获取"></a>源码获取</h2><p><a href="http://nginx.org/en/download.html" target="_blank" rel="noopener">nginx官网</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.15.6.tar.gz</span><br><span class="line">tar zxvf nginx-1.15.6.tar.gz</span><br><span class="line">cd nginx-1.15.6</span><br></pre></td></tr></table></figure></p>
<h2 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>configure命令检测操作系统内核,检测已安装软件,参数解析,中间目录生成,根据参数生成C源码文件和Makefile文件<br>make执行configure命令生成的Makefile文件编译nginx工程,并生成目标文件和最终的二进制文件<br>make install根据configure执行时的参数将nginx部署到指定的安装目录,包括相关目录的建立和二进制文件,配置文件的复制</p>
<h1 id="nginx命令"><a href="#nginx命令" class="headerlink" title="nginx命令"></a>nginx命令</h1><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><p>默认配置文件<code>/usr/local/nginx/conf/nginx.conf</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx</span><br></pre></td></tr></table></figure></p>
<p>可以通过<code>-c</code>参数指定配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx -c /etc/nginx.conf</span><br></pre></td></tr></table></figure></p>
<h2 id="测试配置文件信息是否有错误"><a href="#测试配置文件信息是否有错误" class="headerlink" title="测试配置文件信息是否有错误"></a>测试配置文件信息是否有错误</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx -t</span><br></pre></td></tr></table></figure>
<h2 id="停止服务"><a href="#停止服务" class="headerlink" title="停止服务"></a>停止服务</h2><p>stop强制停止nginx服务<br>quit处理完所有当前请求再停止服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx -s stop</span><br><span class="line">/usr/local/nginx/sbin/nginx -s quit</span><br></pre></td></tr></table></figure></p>
<h2 id="重读配置并生效"><a href="#重读配置并生效" class="headerlink" title="重读配置并生效"></a>重读配置并生效</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx -s reload</span><br></pre></td></tr></table></figure>
<h2 id="日志文件回滚"><a href="#日志文件回滚" class="headerlink" title="日志文件回滚"></a>日志文件回滚</h2><p>先将当前日志文件改名或转移到别的地址,再执行下面命令生成新的日志文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx -s reopen</span><br></pre></td></tr></table></figure></p>
<h1 id="nginx配置"><a href="#nginx配置" class="headerlink" title="nginx配置"></a>nginx配置</h1><h2 id="nginx进程"><a href="#nginx进程" class="headerlink" title="nginx进程"></a>nginx进程</h2><p>在生产环境部署nginx都是采用一个master进程管理多个worker进程的模式.一般情况下,woker进程的数量和服务器上的CPU核心数相等即可(最好每个worker进程都绑定特定的CPU核心,让进程间切换的代价最小).<br>woker进程提供正在的互联网服务,master进程负责监控woker进程(当worker进程意外退出立即启动新的worker进程继续提供服务),为管理员提供命令行服务(启动服务,停止服务,重新载入配置,平滑升级程序等)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">                     |--&gt; worker进程 ------HTTP请求---- Client</span><br><span class="line">                     |</span><br><span class="line">                     |--&gt; worker进程 ------HTTP请求---- Client</span><br><span class="line">                     |                 |</span><br><span class="line">master进程 ---管理----                  |---HTTP请求---- Client</span><br><span class="line">                     |</span><br><span class="line">                     |--&gt; worker进程 ------HTTP请求---- Client</span><br><span class="line">                     |</span><br><span class="line">                     |--&gt; worker进程 ------HTTP请求---- Client</span><br></pre></td></tr></table></figure></p>
<h2 id="nginx配置-1"><a href="#nginx配置-1" class="headerlink" title="nginx配置"></a>nginx配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br></pre></td><td class="code"><pre><span class="line">#块配置项由一个块配置项名和一对大括号组成 events http server location upstream等都是块配置项</span><br><span class="line">#块配置项一定会用大括号把所属的一系列所属的配置项包含进来,表示大括号内的配置项同时生效</span><br><span class="line">#块配置项可以嵌套,内层块直接继承外层块</span><br><span class="line"></span><br><span class="line">#配置项单位 空间: K或者k千字节 M或m兆字节  时间:ms(毫秒),s(秒),m(分钟),h(小时),d(天),w(周),M(月),y(年)</span><br><span class="line"></span><br><span class="line">#以守护进程方式运行Nginx  默认on</span><br><span class="line">daemon on;</span><br><span class="line"></span><br><span class="line">#以mater/worker(一个master进程管理多个worker进程)方式工作,如果关闭就不会fork出worker子进程,而是master进程自身来处理请求  默认on</span><br><span class="line">master_process on;</span><br><span class="line"></span><br><span class="line">#error日志设置 语法: error_log /path/file level;</span><br><span class="line">#/path/file是一个具体文件, /path/file也可以设置为/dev/null,不再输出任何日志(关闭error日志的唯一手段)</span><br><span class="line">#level是日志等级 debug info notice warn error crit alert emerg 从左到右等级依次增大 如果想把日志等级设置为debug,必须在configure时加入--with-debug配置项</span><br><span class="line">error_log  /var/log/nginx/error.log error;</span><br><span class="line">#error_log  logs/error.log  notice;</span><br><span class="line">#error_log  logs/error.log  info;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#限制coredump核心转储文件的大小,防止core文件过大占满了磁盘 语法: worker_rlimit_core size;</span><br><span class="line">worker_rlimit_core 1024M;</span><br><span class="line"></span><br><span class="line">#指定coredump文件生成目录,worker进程的工作目录,该配置的唯一用途是设置coredump文件防止的目录,协助定位问题,需要确保worke进程有权限向working_directory指定目录写入文件 语法: working_directory path;</span><br><span class="line">working_directory /data/nginx;</span><br><span class="line"></span><br><span class="line">#定义环境变量 语法: env VAR|VAR=VALUE; 该配置让用户直接操作操作系统上的环境变量</span><br><span class="line">#嵌入其他配置文件 语法: inclue /path/file; 将其它配置文件嵌入到当前的nginx.conf文件中,参数可以是绝对路径也可以是相对路径(相对nginx配置目录)</span><br><span class="line">#include nginx.d/http/server.casezheng.com.conf</span><br><span class="line">#include nginx.d/*.conf</span><br><span class="line"></span><br><span class="line">#pid文件路径 保存master进程ID的pid文件存储路径.默认和configure设置的--pid-path所指定位置相同,需要确认nginx有权在相应目录中建立pid文件</span><br><span class="line">pid        /run/nginx.pid;</span><br><span class="line"></span><br><span class="line">#ningx worker进程运行的用户及用户组</span><br><span class="line">user  nginx;</span><br><span class="line"></span><br><span class="line">#设置一个nginx worker进程可以打开的最大文件描述符个数</span><br><span class="line">worker_rlimit_nofile 65535;</span><br><span class="line"></span><br><span class="line">#限制信号队列 设置每个用户发往nginx的信号队列的大小,当某个用户的信号队列满了,该用户发送的信号量将被丢弃</span><br><span class="line">#worker_rlimit_sigpending limit;</span><br><span class="line"></span><br><span class="line">#nginx worker进程个数 在master/worker运行方式下,定义worker进程的个数</span><br><span class="line">worker_processes  auto;</span><br><span class="line"></span><br><span class="line">#绑定nginx worker进程到指定的CPU内核 语法: worker_cpu_affinity cpumask [cpumask...]; 该配置仅针对Linux操作系统有效</span><br><span class="line"></span><br><span class="line">#SSL硬件加速 如果服务器上有SSL硬件加速设备,可以进行配置加快SSL协议的处理速度.用户可以使用OpenSSL提供的命令来查看是否有SSL硬件加速设备: openssl engine -t</span><br><span class="line">#ssl_engine device;</span><br><span class="line"></span><br><span class="line">#nginx worker进程的优先级设置, 优先级有静态优先级和进程执行情况共同决定.这里设置的是静态优先级. 语法: worker_priority nice;   nice -20 ~ +19, -20最高优先级 +19最低优先级 希望nginx占用更多系统资源可以将其设置小点,但不建议比内核进程的nice(-5)小.</span><br><span class="line">#worker_priority 0;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">include /usr/share/nginx/modules/*.conf;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    #对指定的客户端输出debug级别的日志 语法: debug_connection [IP|CIDR];  该配置属于事件类配置,必须放在events配置块中才有效,值可以是IP地址或CIDR地址 可以用于高并发请求下定位问题</span><br><span class="line">    debug_connection 127.0.0.1;</span><br><span class="line">    debug_connection 127.0.0.0/24;</span><br><span class="line">    </span><br><span class="line">    #accept锁 accept_mutex是Nginx的负载均衡锁,让多个worker进程轮流的,序列化地与新的客户端建立TCP连接,当一个worker进程建立的连接达到worker_connections配置的最大连接数的7/8时,大大减少该worker进程试图建立新TCP连接的机会,以此实现所有worker进程上处理的客户端请求数尽量接近. accept锁默认打开,关闭后建立TCP连接的耗时会更短,但worker进程间的负载会不均衡,因此不建议关闭它</span><br><span class="line">    accept_mutex on;</span><br><span class="line"></span><br><span class="line">    #使用accept锁后真正建立连接的延迟时间 语法: accept_mutext_delay Nms;    在使用accept锁后,同一时间只有一个worker进程可以获取到accept锁,accept锁不是阻塞锁,如果获取不到会立即返回.如果有一个worker进程试图获取accept锁而没有获取到,至少要等accept_mutex_delay定义的时间间隔后才能再次试图获取锁.</span><br><span class="line"></span><br><span class="line">    #批量建立新连接 当事件模型通知有新连接时,尽可能对本次调度中客户端发起的所有TCP请求都建立连接. 语法: multi_accept [on|off];</span><br><span class="line">    multi_accept off;</span><br><span class="line"></span><br><span class="line">    #选择事件模型 语法: use [kququ | rtsig | epoll | /dev/poll | select | poll | eventport]; nginx默认会选择最合适的事件模型</span><br><span class="line">    use epoll;</span><br><span class="line"></span><br><span class="line">    #每个worker可以处理的最大连接数</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line"></span><br><span class="line">    log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #gzip  on;</span><br><span class="line"></span><br><span class="line">    #内存和磁盘资源的分配</span><br><span class="line">    #client_body_in_file_only HTTP包体只存储在磁盘空间中 语法:client_body_in_file_only on|clean|off; 默认off; 适用于配置块:http,server,location 当非off值时,用户请求中的HTTP包体一律存储到磁盘文件中,即使只有0字节也会存储为文件.当请求结束时如果配置为on,则该文件不会被删除(一般用于调试定位问题),若配置为clean,则会删除该文件</span><br><span class="line">    client_body_in_file_only off;</span><br><span class="line">    #client_body_in_single_buffer on|off; HTTP包体尽量写到一个内存buffer中.如果HTTP包体的大小超过了client_body_buffer_size设置的值,包体还是会写入到磁盘文件中 适用于配置块:http,server,location</span><br><span class="line">    client_body_in_single_buffer off;</span><br><span class="line">    #client_header_buffer_size size; 存储HTTP头部的内存buffer大小 配置块:http,server 存储HTTP头部的内存buffer大小 定义了正常情况下Nginx接收用户请求中HTTP header部分(包括HTTP行和HTTP头部)时分配的内存buffer大小.如果请求中的HTTP header部分超过client_header_buffer_size,large_client_header_buffers将会生效</span><br><span class="line">    client_header_buffer_size 1K;</span><br><span class="line">    #large_client_header_buffers number size; 配置块:http,server large_client_header_buffers定义了nginx接收超大HTTP头部请求的buffer个数和每个buffer的大小.如果HTTP请求行的大小超过单个buffer,则返回&quot;Request URI toolager&quot;(414).请求中一般有多个header,每个header的大小也不能超过单个buffer的大小.否则返回&quot;Bad request&quot;(400).请求行和请求头部的总和也不可以超过buffer个数和*buffer大小</span><br><span class="line">    large_client_header_buffers 4 8K;</span><br><span class="line">    #client_body_buffer_size size; 配置块:http,server,location 存储HTTP包体的内存buffer大小 定义了nginx接收HTTP包体的内存缓冲区大小 即HTTP包体会先接收到指定的这块内存中,之后才决定是否写入磁盘.</span><br><span class="line">    #如果用户请求中包含HTTP头部Content-Length,并且其标识长度小于定义的buffer长度,nginx会自动降低本次请求所使用的内存buffer,降低内存消耗.</span><br><span class="line">    client_body_buffer_size 16k;</span><br><span class="line">    #client_body_temp_path dir-path [level1[level2[level3]]]; 配置块:http,server,location 定义HTTP包体存放的临时目录.在请求HTTP包体时,如果包体大小大于client_body_buffer_size,则会以一个递增的整数命名并存放到client_body_temp_path所指定的目录中.其后跟随的level1,level2,level3是为了防止一个目录下文件太多导致性能下降,因此使用level参数,按照临时文件名最多再加三层目录.</span><br><span class="line">    client_body_temp_path client_body_temp 1 2;</span><br><span class="line">    #connection_pool_size size; 配置块:http,server nginx对每个建立的TCP连接会预先分配一个内存池,size指定该内存池的初始大小,用于减少内核对小块内存的分配次数,需谨慎设置.过大的size会使服务器消耗内存增多,更小的size会引发更多的内存分配次数.</span><br><span class="line">    connection_pool_size 256;</span><br><span class="line">    #request_pool_size size; 配置块:http,server nginx开始处理HTTP请求时,会为每个请求分配一个内存池,size配置项指定该内存池的初始大小,用于减少内核对小块内存的分配次数.TCP连接关闭时会销毁connection_pool_size指定的连接池,HTTP请求结束时会销毁request_pool_size指定的HTTP请求内存池.但TCP连接内存池和HTTP请求内存池的创建和销毁时间并不一致,因为一个TCP连接可能被复用于多个HTTP请求.</span><br><span class="line">    request_pool_size 4k;</span><br><span class="line"></span><br><span class="line">    #网络连接的设置</span><br><span class="line">    #client_header_timeout time(默认单位s); 配置块:http,server,location 读取HTTP头部的超时时间 客户端和服务器建立连接后开始接收HTTP头部,如果在一个时间间隔内没有读取到客户端发来的字节,则认为超时,并向客户端返回408(&quot;Request timed out&quot;)响应.</span><br><span class="line">    client_header_timeout 60;</span><br><span class="line">    #client_body_timeout time(默认单位s); 配置块:http,server,location 读取HTTP包体的超时时间</span><br><span class="line">    client_body_timeout 60;</span><br><span class="line">    #send_timeout time; 配置块:http,server,location 发送响应的超时时间 nginx服务器向客户端发送数据包,但客户端一直没有去接收这个数据包.如果某个连接超过send_timeout定义的超时时间,nginx将关闭这个连接</span><br><span class="line">    send_timeout 60;</span><br><span class="line">    #reset_timedout_connection on|off; 配置块:http,server,location 连接超时后将通过向客户端发送RST包来直接重置连接.该选项打开后,nginx会在某个连接超时后,不是使用正常情况下的四次挥手关闭TCP连接,而是直接向用户发送RST重置包,不在等待用户的应答,直接使用nginx服务器上关于该套接字的所有缓存,与正常关闭方式相比,使得服务器避免了产生更多处于FIN_WAIT_1,FIN_WAIT_2,TIME_WAIT状态的TCP连接. 但是,使用RST重置包关闭连接会带来一些问题,默认情况下不会开启.</span><br><span class="line">    reset_timedout_connection off;</span><br><span class="line">    #lingering_close off|on|always; 配置块:http,server,location 控制nginx关闭用户连接的方式.always表示关闭用户连接前必须无条件地处理连接上所有用户发送的请求.off表示关闭连接时完全不管连接上是否有已经准备就绪的来自用户的数据.on是中间值,一般情况下在关闭前都会处理l连接上用户发送的数据,除了有些情况下在业务上认定之后的数据是不必要的.</span><br><span class="line">    lingering_close on;</span><br><span class="line">    #lingering_time time; 配置块:http,server,location lingering_close启用后,对上传大文件很有用,当用户上传的Content-Length大于max_client_body_size时,nginx服务器向用户发送413(Request entity too large)响应,如果客户端不管413返回值继续上传HTTP body,经过lingering_time设置的时间后,nginx将不管用户是否仍在上传,都将连接关闭掉</span><br><span class="line">    lingering_time 30s;</span><br><span class="line">    #lingering_timeout time; 配置块:http,server,location lingering_close生效后,在关闭连接前,会检测是否有用户发送的数据到达服务器,如果超过了lingering_timeout还没有数据可读,就直接关闭连接,否则,必须在读取完连接缓冲区上的数据并丢弃后才能关闭连接</span><br><span class="line">    lingering_timeout 5s;</span><br><span class="line">    #keepalive_disable [msie6|safari|none...]; 配置块:http,server,location HTTP请求的keepalive功能让多个请求复用一个HTTP长连接,对服务器的性能提高很有帮助,但有的浏览器对keepalive功能的POST请求有功能项问题,因此可以对特定浏览器禁用keepalive功能</span><br><span class="line">    keepalive_disable msie6 safari;</span><br><span class="line">    #keepalive_timeout time(秒); 配置块:http,server,location  一个httpalive在闲置一定时间后,服务器和浏览器都会去关闭这个连接,keepalive_timeout配置项用来约束nginx服务器,nginx会按照规范将keepalive_timeout传给浏览器,但每个浏览器对keepalive的策略有可能不同</span><br><span class="line">    keepalive_timeout   65;</span><br><span class="line">    #keepalive_requests n; 配置块:http,server,location 一个keepalive长连接上允许的请求最大数 即一个keepalive连接上最多只能发送n个请求</span><br><span class="line">    keepalive_requests 100;</span><br><span class="line">    #tcp_nodelay on|off; 配置块:http,server,location 确定对keepalive连接是否使用TCP_NODELAY选项</span><br><span class="line">    tcp_nodelay         on;</span><br><span class="line">    #tcp_nopush on|off; 配置块:http,server,location 在打开sendfile选项时,确认是否开启FreeBSD系统的TCP_NOPUSH或Linux系统上的TCP_CORK功能,打开tcp_nopush后,将在发送响应时把真个响应头放在一个TCP包中发送.</span><br><span class="line">    tcp_nopush          on;</span><br><span class="line">    </span><br><span class="line">    #MIME类型的设置</span><br><span class="line">    #MIME type与文件扩展的映射 语法: type &#123;...&#125;; 配置块:http,server,location  定义MIME type到文件拓展名的映射.多个拓展名可映射到同一个MIME type.</span><br><span class="line">    #默认MIME type 语法:default_type MIME-type; 配置块:http,server,location 当找不到相应的MIME type与文件扩展名之间的映射时使用默认的MIME type作为HTTP header中的Content-Type.</span><br><span class="line">    default_type application/octet-stream;</span><br><span class="line">    #types_hash_bucket_size size; 默认type_hash_bucket_size 32|64|128; 配置块:http,server,location 为了快速查找相应MIME type,nginx使用散列表来存储MIME type与文件扩展名.types_hash_bucket_size设置了每个散列桶占用内存大小</span><br><span class="line">    types_hash_bucket_size 64;</span><br><span class="line">    #types_hash_max_size size; 配置块:http,server,location  影响散列表的冲突率,types_hash_max_size越大,消耗内存越大,打散列表的冲突率会降低,检索速度会更快,types_hash_max_size越小,消耗内存越少,但散列表冲突率会上升.</span><br><span class="line">    types_hash_max_size 2048;</span><br><span class="line"></span><br><span class="line">    #文件操作的优化</span><br><span class="line">    #sendfile系统调用 sendfile on|off; 配置块:http,server,location 启用Linux上的sendfile系统调用来发送文件,减少系统内核和用户态之间的两次内存复制,从磁盘中直接读取文件后直接在内核态发送到网卡设备.提高发送文件的效率.</span><br><span class="line">    #sendfile off;</span><br><span class="line">    #AIO系统调用 aio on|off; 配置块:http,server,location 表示是否在FreeBSD或Linux系统上启用内核级别的异步文件I/O功能.该配置和sendfile功能互斥</span><br><span class="line">    aio on;</span><br><span class="line">    #directio size|off; 配置块:http,server,location 在FreeBSD和Linux系统上使用O_DIRECT选项来读文件,缓冲区大小为size,通常对大文件的读取速度有优化功能,与sendfile功能相斥.</span><br><span class="line">    directio off;</span><br><span class="line">    #directio_alignment size; 配置块:http,server,location 与directio配合使用,指定以directio方式读取文件时的对齐方式.</span><br><span class="line">    directio_alignment 512;</span><br><span class="line">    #打开文件缓存 open_file_cache max=N[inactive=time]|off; 配置块:http,server,location 文件缓存会在内存中存储3种信息:1.文件句柄,文件大小和上次修改时间 2.已经打开过的目录结构 3.没有找到的或者没有操作权限的文件信息</span><br><span class="line">    #open_file_cache 后面跟3个参数.max表示在内存中存储元素的最大个数,当达到最大值后,将采用LRU算法从缓存中淘汰最近最少使用的元素.inactive表示在inactive指定的时间段内没有被访问过的元素将被淘汰.默认时间为60秒.off关闭缓存功能</span><br><span class="line">    open_file_cache off;</span><br><span class="line">    #open_file_cache max=100 inactive=20s;</span><br><span class="line">    #缓存打开文件错误的信息 open_file_cache_errors on|off; 配置块:http,server,location</span><br><span class="line">    open_file_cache_errors off;</span><br><span class="line">    #不被淘汰的最小访问次数 open_file_cache_min_uses number; 配置块:http,server,location 与open_file_cache中的inactive参数配合使用.如果在inactive指定时间段内,访问次数超过了open_file_cache_min_uses指定的最小次数,那么将不会被淘汰出缓存.</span><br><span class="line">    open_file_cache_min_uses 1;</span><br><span class="line">    #检查缓存中元素有效性的频率. open_file_cache_valid time; 配置块:http,server,location</span><br><span class="line">    open_file_cache_valid 60s;</span><br><span class="line"></span><br><span class="line">    include             /etc/nginx/mime.types;</span><br><span class="line">    include             /etc/nginx/default.d/*.conf;</span><br><span class="line">    include             /etc/nginx/conf.d/*.conf;</span><br><span class="line"></span><br><span class="line">    #server_names_hash_bucket_size设置nginx存储server_name的散列表每个散列桶占用的内存大小 适用于配置块:http,server,location 取值32,64,128</span><br><span class="line">    server_names_hash_bucket_size 128;</span><br><span class="line">    #server_names_hash_max_size影响散列表的冲突率,值越大消耗内存越多,散列key的冲突率约低,检索速度越快 适用于配置块:http,server,location</span><br><span class="line">    server_names_hash_max_size 512;</span><br><span class="line"></span><br><span class="line">    #对客户端请求的特殊处理</span><br><span class="line">    #忽略不合法的HTTP头部 ignore_invalid_headers on|off; 配置块:http,server 如果将其设置为off,当出现不合法的HTTP头部时,ngin将拒绝服务,并直接想用户发送400(Bad Request)错误,如果设置为on,则将忽略此HTTP头部.</span><br><span class="line">    ignore_invalid_headers on;</span><br><span class="line">    #HTTP头部允许下划线 underscores_in_headers on|off; 配置块:http,server 默认off,表示HTTP头部名称中不允许带&quot;_&quot;</span><br><span class="line">    underscores_in_headers off;</span><br><span class="line">    #If-Modified-Since头部的处理策略 if_modified_since [off|exact|before]; 配置块:http,server,location Web浏览器一般会缓存文件到本地,并存储当时获取的时间,下次向Web服务器获取缓存过的资源时,使用If-Modified-Since头部把上次获取的时间捎带上,而if_modified_since将根据后面的参数决定如何处理If-Modified-Since头部.</span><br><span class="line">    #off: 直接忽略用户请求中的If-Modified-Since头部,如果获取一个文件,会正常返回文件内容,HTTP响应吗通常为200</span><br><span class="line">    #exact: 将If-Modified-Since头部包含的时间和将要返回的文件上次修改时间做精准比较,如果没有匹配上则返回200和文件实际内容,如果匹配上了,则表示浏览器缓存的已经是最新的啦,没有必要再返回文件浪费时间和宽带,返回304 Not Modified,浏览器收到后会直接读取自己的本地缓存</span><br><span class="line">    #before: 比exact更宽松,只要文件上次修改时间等于或早于用户请求中的If-Modified-Since头部的时间,会向客户端返回304Not Modified.</span><br><span class="line">    if_modified_since exact;</span><br><span class="line">    #文件未找到时记录到error日志 log_not_found on|off; 配置块:http,server,location 表示当处理用户请求且需要访问文件时,如果未找到文件,是否将错误记录到error.log日志.可用于定位问题.</span><br><span class="line">    log_not_found on;</span><br><span class="line">    #merge_slashes on|off; 配置块:http,server,location 合并相邻的&quot;/&quot;.</span><br><span class="line">    merge_slashes on;</span><br><span class="line">    #DNS解析地址 resolver address ...; 配置块:http,server,location 设置DNS名字解析服务器地址.</span><br><span class="line">    #DNS解析超时时间 resolver_timeout time; 配置块:http,server,location</span><br><span class="line">    resolver_timeout 30s;</span><br><span class="line">    #server_tokens on|off; 返回错误页面时是否在Server中注明nginx版本 配置块:http,server,location 方便定位问题</span><br><span class="line">    server_tokens on;</span><br><span class="line"></span><br><span class="line">    #server块 虚拟主机定义</span><br><span class="line">    server &#123;</span><br><span class="line">        #监听端口 默认监听80端口 listen决定nginx服务如何监听端口.在listen后面可以只加IP地址,端口或主机名</span><br><span class="line">        #listen 127.0.0.1:8080;</span><br><span class="line">        #listen 127.0.0.1;  #不写端口时,默认监听80端口</span><br><span class="line">        #listen *:80;</span><br><span class="line">        #listen localhost:80;</span><br><span class="line">        #listen后面也可以加其他参数</span><br><span class="line">        #1. default/default_server: 将这个server块作为整个Web服务的默认server块.未设置则将nginx解析配置时找到的第一个server块作为默认块,当一个请求无法匹配配置文件中所有主机域名时,选择默认的虚拟主机.</span><br><span class="line">        #2. backlog=num: 表示TCP中backlog队列的大小,默认为-1,表示不予设置.在TCP三次握手的工程中,进程还没有开始处理监听句柄,这时backlog队列会放置这些新连接.如果backlog队列已满,新的客户端试图建立新连接将会失败.</span><br><span class="line">        #3. rcvbuf=size: 设置监听句柄的SO_RCVBUF参数 </span><br><span class="line">        #4. sndbuf=size: 设置监听句柄的SO_SNDBUF参数</span><br><span class="line">        #5. accept_filter: 设置accept过滤器,只对FreeBSD操作系统有效</span><br><span class="line">        #6. deferred: 设置该参数,若用户发起建立连接请求,并且完成TCP的三次握手,内核也不会调度worker进程来处理这个连接,当用户真的发送请求数据时,内核才会调度worker进程处理这个连接,这个参数适合大并发的情况下,减轻worker进程的负担</span><br><span class="line">        #7. bind: 绑定当前端口/地址对, 只有同时对一个端口监听多个地址才会生效</span><br><span class="line">        #8. ssl: 在当前监听的端口上建立的连接必须基于SSL协议</span><br><span class="line">        listen       80 default_server;</span><br><span class="line">        listen       [::]:80 default_server;</span><br><span class="line"></span><br><span class="line">        #主机名称 server_name可以跟多个主机名称</span><br><span class="line">        #server_name  localhost test.casezheng.date;</span><br><span class="line">        #server_name  localhost 127.0.0.1;</span><br><span class="line">        #当nginx处理一个HTTP请求时,nginx取出header头中的host,与每个server中的server_name匹配.匹配规则如下:</span><br><span class="line">        #1. 完全匹配server_name</span><br><span class="line">        #2. 通配符在前面的server_name</span><br><span class="line">        #3. 通配符在后面的server_name</span><br><span class="line">        #4. 正则表达式才匹配的server_name</span><br><span class="line">        #5. 前面都未匹配到,找listen配置项后加了default或default_server的server块</span><br><span class="line">        #6. 前面都未匹配到,找匹配listen端口的第一个server块</span><br><span class="line">        #server_name后面跟空字符串表示匹配没有host这个HTTP头部的请求</span><br><span class="line">        server_name  localhost test.casezheng.date;</span><br><span class="line"></span><br><span class="line">        #server_name_in_redirect 重定向主机名称 配合server_name使用,当打开时表示重定向请求时会使用server_name里配置的第一个主机名代替原先请求中的Host头部,关闭时表示在重定向请求时使用请求本身的Host头部. 适用于配置块:http,server,location  默认on</span><br><span class="line">        server_name_in_redirect on;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #location 语法: location [=|~|~*|^~|@]/uri/ &#123; ... &#125; 适用于配置块:server  location尝试根据用户请求中的URI来匹配/uri表达式,如果可以匹配,就选择location块中的配置处理用户请求, 匹配规则如下:</span><br><span class="line">        #1. =表示把URI作为字符串,以便与参数中的uri做完全匹配</span><br><span class="line">        #2. ~表示匹配URI时是大小写敏感的</span><br><span class="line">        #3. ~*表示匹配URI时忽略字母大小写问题</span><br><span class="line">        #4. ^~表示匹配URI时只需要其前半部分与uri参数匹配即可</span><br><span class="line">        #5. @表示仅用于nginx服务内部请求之间的重定向</span><br><span class="line">        #在uri参数中可以使用正则表达式进行匹配</span><br><span class="line">        #location存在顺序,当一个请求有可能匹配多个location时,该请求将被第一个location处</span><br><span class="line">        </span><br><span class="line">        root /data/nginx/;</span><br><span class="line"></span><br><span class="line">        #对客户端请求的限制</span><br><span class="line">        #对HTTP方法名限制用户请求 limit_except method ... &#123; ... &#125; 配置块:location   nginx通过limit_except后面指定的方法名来限制用户请求.方法名取值包括:GET,HEAD,POST,PUT,DELETE,MKCOL,COPY,MOVE,OPTIONS,PROPFIND,PROPPATCH,LOCK,UNLOCK或者PATCH.</span><br><span class="line">        #请求包体的最大值 client_max_body_size size; 配置块:http,server,location 浏览器发送含较大HTTP包体的请求时,其头部有Content-Length字段,client_max_body_size是用来限制Content-Length所示值的大小的.nginx在接受到包头后,发现Content-Length的值大于client_max_body_size,直接发送403(&quot;Request Entity Too Large&quot;)响应给客户端</span><br><span class="line">        client_max_body_size 1m;</span><br><span class="line"></span><br><span class="line">        #对请求的限制 limit_rate speed; 配置块:http,server,location,if 对客户端请求限制每秒传输的字节数. 0表示不限速.</span><br><span class="line">        limit_rate 0;</span><br><span class="line">        #limit_rate_after length; 表示nginx向客户端发送的请求长度超过limit_rate_after后才开始限速.</span><br><span class="line">        limit_rate_after 100m;</span><br><span class="line"></span><br><span class="line">        location = /test_root &#123;</span><br><span class="line">            #以root方式设置资源路径 适用于配置块:http,server,location,if  root根据完整的URI请求来映射</span><br><span class="line">            #root /data/nginx/;</span><br><span class="line">            limit_except GET &#123;</span><br><span class="line">                allow 192.168.1.0/32;</span><br><span class="line">                deny all;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location = /test_alias &#123;</span><br><span class="line">            #以alias方式设置资源路径 适用于配置块:location alias在URI向实际文件路径的映射过程中,会丢弃掉location后面配置的那部分uri</span><br><span class="line">            alias /data/nginx/test_alias/;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            #访问首页   语法: index file ...; 用ngx_http_index_module模块提供的index配置实现返回网站首页,nginx按照配置的顺序访问index后配置的文件</span><br><span class="line">            root   /data/nginx;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #error_page code [code...][=|=answer-code]uri|@named_location  适用于配置块:http,server,location,if</span><br><span class="line">        #当某个请求返回错误码时,如果匹配上了erro_page中设置的code,则重定向到新的URI中.</span><br><span class="line">        #error_page  404              /404.html;</span><br><span class="line">        #error_page  404 =200         /404.html;    #重定向后返回的错误码还是原来的,可以通过=更改返回的错误码</span><br><span class="line">        #error_page  404 =            /404.html;    #也可以不指定确切的返回码,由重定向后实际处理的真实结果决定</span><br><span class="line">        #如果不行修改URI,只是将错误请求重定向到另一个location处理,可以如下配置,将错误请求代理到http://test.casezheng.date/test_root上游服务器处理</span><br><span class="line">        location /test_error_fallback &#123;</span><br><span class="line">            error_page 404 @fallback;</span><br><span class="line">        &#125;</span><br><span class="line">        location @fallback &#123;</span><br><span class="line">            proxy_pass http://test.casezheng.date;</span><br><span class="line">        &#125;</span><br><span class="line">        #递归使用error_page  recursive_error_pages [on|off]</span><br><span class="line">        recursive_error_pages off;  #默认不允许递归定义error_page</span><br><span class="line"></span><br><span class="line">        # redirect server error pages to the static page /50x.html</span><br><span class="line">        #</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   /data/nginx;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location ^~ /test_try_files &#123;</span><br><span class="line">            #try_files后跟若干路径,最后必须有uri参数. nginx尝试按顺序访问每个路径,如果可以有效访问则返回,否则继续读取下一个.如果所有路径都读取不到则重定向到最后的参数uri上.因此最后的uri参数必须存在而且是可以重定向的.</span><br><span class="line">            #try_files适用于server,location配置块</span><br><span class="line">            try_files /test_try1 /test_try2 /test_try3 @fallback;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    root           html;</span><br><span class="line">        #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        #    fastcgi_index  index.php;</span><br><span class="line">        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class="line">        #    include        fastcgi_params;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # deny access to .htaccess files, if Apache&apos;s document root</span><br><span class="line">        # concurs with nginx&apos;s one</span><br><span class="line">        #</span><br><span class="line">        #location ~ /\.ht &#123;</span><br><span class="line">        #    deny  all;</span><br><span class="line">        #&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # HTTPS server</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       443 ssl;</span><br><span class="line">    #    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    #    ssl_certificate      cert.pem;</span><br><span class="line">    #    ssl_certificate_key  cert.key;</span><br><span class="line"></span><br><span class="line">    #    ssl_session_cache    shared:SSL:1m;</span><br><span class="line">    #    ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">    #    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">    #    ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="nginx配置反向代理服务器"><a href="#nginx配置反向代理服务器" class="headerlink" title="nginx配置反向代理服务器"></a>nginx配置反向代理服务器</h2><p>反向代理(reverse proxy)方式指用代理服务器接受Internet上的连接请求,然后将请求转发给内部网络中的上游服务器,并将从上游服务器得到的结果返回给Internet上请求连接的客户端.反向代理服务器必须能够能支持大量并发请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">                                      Nginx</span><br><span class="line">            ---静态文件请求---&gt;</span><br><span class="line">                                  静态Web服务器</span><br><span class="line">            &lt;---文件内容-------    </span><br><span class="line">Web浏览器                                 </span><br><span class="line">            ---静态文件请求---&gt;                   ---转发动态请求---&gt;</span><br><span class="line">                                  反向代理服务器                      处理复杂业务的动态Web服务器</span><br><span class="line">            &lt;---转发动态应答---                   &lt;----动态应答------</span><br></pre></td></tr></table></figure>
<p>nginx的反向代理特点</p>
<ul>
<li>2 用户发来的请求将会完整地缓存到nginx代理服务器,之后才会向后端服务器转发</li>
<li>3 nginx反向代理服务器可以按照多种方案从上游服务器的集群中选择一台.负载均衡方案包括按IP地址做散列等</li>
<li>5 如果上游服务器返回内容,则不会先完整缓存到nginx代理服务器再发给客户端,而是边接收边转发到客户端</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">                                    2----&gt; 缓存的HTTP包体                   上游服务器</span><br><span class="line">                                    |</span><br><span class="line">            --------1------&gt;        |               ---------3---------&gt; </span><br><span class="line">客户端                         nginx反向代理服务器                              上游服务器</span><br><span class="line">            &lt;-------5-------                        &lt;--------4----------</span><br><span class="line"></span><br><span class="line">                                                                            上游服务器</span><br></pre></td></tr></table></figure>
<p>nginx的反向代理方案主要是为了降低上游服务器的并发压力.缺点是:延长了一个请求的处理时间,并增加了用于缓存请求内容的内存和磁盘空间,增加了nginx的压力.</p>
<h2 id="负载均衡和反向代理的基本配置"><a href="#负载均衡和反向代理的基本配置" class="headerlink" title="负载均衡和反向代理的基本配置"></a>负载均衡和反向代理的基本配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">... ...</span><br><span class="line">http &#123;</span><br><span class="line">	... ...</span><br><span class="line">    #upstream name &#123;...&#125; 配置块:http upstream块定义一个上游服务器的集群,便于反向代理中proxy_pass使用.</span><br><span class="line">    #server name [parameters]; 配置块:upstream server配置项指定了一个上游服务器的名字,可以是域名,IP地址端口,UNIX句柄等,其后可跟如下参数</span><br><span class="line">    #1. weight=number:设置向这台上游服务器转发的权重,默认为1</span><br><span class="line">    #2. max_fails=number:与fail_timeout配合使用,指在fail_timeout时间段内,如果向当前的上游服务器转发失败次数超过number,则认为在当前的fail_timeout时间段内这台上游服务器不可用,max_fails默认为1,设置为0表示不检查失败次数</span><br><span class="line">    #3. fail_timeout:表示该时间段内转发失败多少次后就认为上游服务器暂时不可用,用于优化反向代理功能.该值与向上游服务器建立连接的超时时间,读取上游服务器的响应超时时间等完全无关.fail_timeout默认为10s</span><br><span class="line">    #4. down:表示所在的上游服务器永久下线,只在使用ip_hash配置项时才有用</span><br><span class="line">    #5. backup:在使用ip_hash配置时无效,表示所在的上游服务器只是备份服务器,当所有非备份上游服务器都失效后,才会向所在的上游服务器转发请求</span><br><span class="line">    #ip_hash; 配置块:upstream 按ip hash转发,确保同一个客户端的请求只转发到指定的上游服务器, ip_hash不可与weight配置同时使用. 当upstream集群有一台上游服务器不可用时不可直接删除该配置,而是用down参数标识,确保转发的一致性.</span><br><span class="line">    upstream backend1 &#123;</span><br><span class="line">        server example1.casezheng.date weight=5;</span><br><span class="line">        server example2.casezheng.date max_fails=2 fail_timeout=30s;</span><br><span class="line">        server example3.casezheng.date down;</span><br><span class="line">        server example4.casezheng.date;</span><br><span class="line">    &#125;</span><br><span class="line">    upstream backend2 &#123;</span><br><span class="line">        ip_hash;    </span><br><span class="line">        server example1.casezheng.date;</span><br><span class="line">        server example2.casezheng.date;</span><br><span class="line">        server example3.casezheng.date down;</span><br><span class="line">        server example4.casezheng.date;</span><br><span class="line">    &#125;</span><br><span class="line">    #proxy_pass URL; 配置块:location, if 将当前请求反向代理到URL参数指定的服务器上,URL可以是主机名或IP加端口或直接使用upstream块 默认情况下反向代理不转发请求中的Host头部,如果需要转发,需要加上 proxy_set_header Host $host;</span><br><span class="line">    #proxy_method method; 配置块:http,server,location 表示转发时的协议方法名</span><br><span class="line">    #proxy_hide_header the_header; 配置块:http,server,location nginx将上游服务器的响应转发给客户端,但默认不转发以下HTTP头部字段:Data,Server,X-Pad和X-Accel-*.使用proxy_hide_header后k而已任意指定哪些HTTP头部字段不能被转发</span><br><span class="line">    #proxy_pass_header the_header; 配置块:http,server,location 与proxy_hide_header相反,将原本被禁止的header设置为允许转发.</span><br><span class="line">    #proxy_pass_request_body on|off; 配置块:http,server,location 向上游服务器发送HTTP包体</span><br><span class="line">    #proxy_pass_request_headers on|off; 配置块:http,server,location 向上游服务器发送HTTP包头</span><br><span class="line">    #proxy_redirect [default|off|redirect reqlacement]; 配置块:http,server,location</span><br><span class="line">    #proxy_next_upstream [error|timeout|invalid_header|http_500|http_502|http_503|http_504|http_404|off]; 配置块:http,server,location  表示当向一台上游服务器转发请求错误时,继续换一台上游服务器处理这个请求</span><br><span class="line">    server  &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name exampel.casezheng.date;</span><br><span class="line"></span><br><span class="line">        proxy_method POST;</span><br><span class="line">        proxy_pass_request_body on;</span><br><span class="line">        proxy_pass_request_headers on;</span><br><span class="line">        #proxy_redirect default;</span><br><span class="line">        proxy_next_upstream error timeout;</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://backend2;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="nginx-http模块调用的简化流程"><a href="#nginx-http模块调用的简化流程" class="headerlink" title="nginx http模块调用的简化流程"></a>nginx http模块调用的简化流程</h1><p><img src="/Picture/simplified_flow_of_nginx_http_module_calls.svg" alt="nginx http模块调用的简化流程"></p>
<h1 id="nginx基础架构"><a href="#nginx基础架构" class="headerlink" title="nginx基础架构"></a>nginx基础架构</h1><h1 id="nginx数据结构"><a href="#nginx数据结构" class="headerlink" title="nginx数据结构"></a>nginx数据结构</h1><h2 id="ngx-list-t"><a href="#ngx-list-t" class="headerlink" title="ngx_list_t"></a>ngx_list_t</h2><p><img src="/Picture/nginx_ngx_list_t.png" alt="nginx ngx_list_t链表结构内存分布"></p>
<h1 id="nginx源码阅读"><a href="#nginx源码阅读" class="headerlink" title="nginx源码阅读"></a>nginx源码阅读</h1><p><a href="https://github.com/CaseZheng/nginx" target="_blank" rel="noopener">nginx-1.15.6源码阅读注释</a></p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li>深入理解Nginx模块开发与架构解析第2版</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/linux/" rel="tag"># linux</a>
              <a href="/tags/nginx/" rel="tag"># nginx</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2018/11/16/centos-multiple-gcc-version/" rel="prev" title="centos安装多个gcc版本">
      <i class="fa fa-chevron-left"></i> centos安装多个gcc版本
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/12/08/linux-performance-optimization/" rel="next" title="linux性能优化">
      linux性能优化 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#nginx介绍"><span class="nav-number">1.</span> <span class="nav-text">nginx介绍</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#nginx特性"><span class="nav-number">2.</span> <span class="nav-text">nginx特性</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#nginx编译安装"><span class="nav-number">3.</span> <span class="nav-text">nginx编译安装</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#源码获取"><span class="nav-number">3.1.</span> <span class="nav-text">源码获取</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编译安装"><span class="nav-number">3.2.</span> <span class="nav-text">编译安装</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#nginx命令"><span class="nav-number">4.</span> <span class="nav-text">nginx命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#启动"><span class="nav-number">4.1.</span> <span class="nav-text">启动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#测试配置文件信息是否有错误"><span class="nav-number">4.2.</span> <span class="nav-text">测试配置文件信息是否有错误</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#停止服务"><span class="nav-number">4.3.</span> <span class="nav-text">停止服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#重读配置并生效"><span class="nav-number">4.4.</span> <span class="nav-text">重读配置并生效</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#日志文件回滚"><span class="nav-number">4.5.</span> <span class="nav-text">日志文件回滚</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#nginx配置"><span class="nav-number">5.</span> <span class="nav-text">nginx配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#nginx进程"><span class="nav-number">5.1.</span> <span class="nav-text">nginx进程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#nginx配置-1"><span class="nav-number">5.2.</span> <span class="nav-text">nginx配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#nginx配置反向代理服务器"><span class="nav-number">5.3.</span> <span class="nav-text">nginx配置反向代理服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#负载均衡和反向代理的基本配置"><span class="nav-number">5.4.</span> <span class="nav-text">负载均衡和反向代理的基本配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#nginx-http模块调用的简化流程"><span class="nav-number">6.</span> <span class="nav-text">nginx http模块调用的简化流程</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#nginx基础架构"><span class="nav-number">7.</span> <span class="nav-text">nginx基础架构</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#nginx数据结构"><span class="nav-number">8.</span> <span class="nav-text">nginx数据结构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ngx-list-t"><span class="nav-number">8.1.</span> <span class="nav-text">ngx_list_t</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#nginx源码阅读"><span class="nav-number">9.</span> <span class="nav-text">nginx源码阅读</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考资料"><span class="nav-number">10.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="CaseZheng"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">CaseZheng</p>
  <div class="site-description" itemprop="description">CaseZheng的博客网站</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">130</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/CaseZheng" title="GitHub → https://github.com/CaseZheng" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:764307915@qq.com" title="E-Mail → mailto:764307915@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2017 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CaseZheng</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">717k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">10:52</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  <script src="/js/local-search.js"></script>












  

  

</body>
</html>
