<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="msvalidate.01" content="F14AAB2D4C842CB9F200D0A80DA8CB2F">
  <meta name="baidu-site-verification" content="GNlbaIvRtqlfiBfg">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.casezheng.date","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="CaseZheng的博客网站">
<meta property="og:type" content="website">
<meta property="og:title" content="CaseZheng">
<meta property="og:url" content="http://www.casezheng.date/page/4/index.html">
<meta property="og:site_name" content="CaseZheng">
<meta property="og:description" content="CaseZheng的博客网站">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CaseZheng">
<meta name="twitter:description" content="CaseZheng的博客网站">

<link rel="canonical" href="http://www.casezheng.date/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>CaseZheng</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?4f1686055a927fa7bf1a09bc1143b57c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">CaseZheng</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">CaseZheng Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.casezheng.date/2018/04/27/boost-log/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CaseZheng">
      <meta itemprop="description" content="CaseZheng的博客网站">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CaseZheng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/27/boost-log/" class="post-title-link" itemprop="url">boost-log日志组件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-27 23:25:30" itemprop="dateCreated datePublished" datetime="2018-04-27T23:25:30+08:00">2018-04-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/cpp/" itemprop="url" rel="index"><span itemprop="name">cpp</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="boost-log"><a href="#boost-log" class="headerlink" title="boost-log"></a>boost-log</h1><h2 id="常用简写"><a href="#常用简写" class="headerlink" title="常用简写"></a>常用简写</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> logging  = boost::<span class="built_in">log</span>;</span><br><span class="line"><span class="keyword">namespace</span> src      = boost::<span class="built_in">log</span>::sources;</span><br><span class="line"><span class="keyword">namespace</span> expr     = boost::<span class="built_in">log</span>::expressions;</span><br><span class="line"><span class="keyword">namespace</span> sinks    = boost::<span class="built_in">log</span>::sinks;</span><br><span class="line"><span class="keyword">namespace</span> attrs    = boost::<span class="built_in">log</span>::attributes;</span><br><span class="line"><span class="keyword">namespace</span> keywords = boost::<span class="built_in">log</span>::keywords;</span><br></pre></td></tr></table></figure>
<h2 id="boost-log的结构图"><a href="#boost-log的结构图" class="headerlink" title="boost-log的结构图"></a>boost-log的结构图</h2><p><img src="/Picture/boost-log.png" alt><br>boost::log 的设计主要有日志器(Logger)、日志核心(Logging core)、Sink 前后端(frontend, backend)组成.日志文本以及日志环境由日志器(Logger)负责搜集，日志核心负责处理日志数据(例如全局过滤、将日志记录传递给 Sink ),Sink前端分为同步、异步以及不考虑线程同步问题的版本,它们负责将日志记录传递给 Sink 后端处理.Sink后端负责把日志记录格式化并输出到不同的介质中(例如日志文件、报警以及统计源中).</p>
<h2 id="Logging-core的获取"><a href="#Logging-core的获取" class="headerlink" title="Logging core的获取"></a>Logging core的获取</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;boost/log/core.hpp&gt;</span></span></span><br><span class="line">boost::<span class="built_in">shared_ptr</span>&lt;logging::core&gt; core = logging::core::get();</span><br></pre></td></tr></table></figure>
<h2 id="sink对象创建"><a href="#sink对象创建" class="headerlink" title="sink对象创建"></a>sink对象创建</h2><p>需要先创建一个backend对象，然后在创建sink对象的时候，将backend对象传递给它<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> sinks::synchronous_sink&lt;sinks::text_file_backend&gt; TextSink;</span><br><span class="line"><span class="comment">// init sink</span></span><br><span class="line">boost::<span class="built_in">shared_ptr</span>&lt;sinks::text_file_backend&gt; backend = boost::make_shared&lt;sinks::text_file_backend&gt;(</span><br><span class="line">    keywords::file_name = <span class="string">"sign_%Y-%m-%d_%H-%M-%S.%N.log"</span>,</span><br><span class="line">    keywords::rotation_size = <span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>,</span><br><span class="line">    keywords::time_based_rotation = sinks::file::rotation_at_time_point(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">    keywords::min_free_space = <span class="number">30</span> * <span class="number">1024</span> * <span class="number">1024</span>);</span><br><span class="line"><span class="function">boost::<span class="built_in">shared_ptr</span>&lt;TextSink&gt; <span class="title">sink</span><span class="params">(<span class="keyword">new</span> TextSink(backend))</span></span>;</span><br></pre></td></tr></table></figure></p>
<h2 id="backend创建"><a href="#backend创建" class="headerlink" title="backend创建"></a>backend创建</h2><h3 id="指定frontend类型"><a href="#指定frontend类型" class="headerlink" title="指定frontend类型"></a>指定frontend类型</h3><p>backend的类型需要一个frontend类型作为其模版类,当创建一个backend对象时,已经确定了frontend.<br>frontend模版可以使用synchronous_sink类或者asynchronous_sink类,后者不会阻塞调用程序,会创建额外线程处理log,不过会慢点,内存消耗大点.一般推荐使用后者.</p>
<h3 id="用keywords构造参数"><a href="#用keywords构造参数" class="headerlink" title="用keywords构造参数"></a>用keywords构造参数</h3><p>boost/log/keywords目录下hpp文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[CaseZheng@VM_187_252_centos keywords]$ ls</span><br><span class="line">auto_flush.hpp  channel.hpp    empty_marker.hpp           file_name.hpp  ident.hpp              iteration.hpp   max_files.hpp     min_free_space.hpp  order.hpp            permissions.hpp    scan_method.hpp   target.hpp</span><br><span class="line">block_size.hpp  delimiter.hpp  enable_final_rotation.hpp  filter.hpp     incomplete_marker.hpp  log_name.hpp    max_size.hpp      name.hpp            ordering_window.hpp  registration.hpp   severity.hpp      time_based_rotation.hpp</span><br><span class="line">capacity.hpp    depth.hpp      facility.hpp               format.hpp     ip_version.hpp         log_source.hpp  message_file.hpp  open_mode.hpp       overflow_policy.hpp  rotation_size.hpp  start_thread.hpp  use_impl.hpp</span><br></pre></td></tr></table></figure></p>
<p>keywords是boost库的基本概念，设计到一个宏BOOST_PARAMETER_KEYWORD，定义在boost/parameter/keywords.hpp文件中， 主要作用就是在指定的namespace中创建一个singleton的对象。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keywords::file_name = <span class="string">"sign_%Y-%m-%d_%H-%M-%S.%N.log"</span>,</span><br></pre></td></tr></table></figure></p>
<p>上述代码:给keywords namespace下的singleton对象file_name赋值.<br>text_file_backend的构造函数语法上支持变参，但是语义上只支持有限的keywords</p>
<h2 id="sink指定格式"><a href="#sink指定格式" class="headerlink" title="sink指定格式"></a>sink指定格式</h2><p>指定日志格式,在sink中指定<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sink-&gt;set_formatter (</span><br><span class="line">    expr::format(<span class="string">"[%1%]&lt;%2%&gt;(%3%): %4%"</span>)</span><br><span class="line">    % expr::format_date_time&lt; boost::posix_time::ptime&gt;(<span class="string">"TimeStamp"</span>, <span class="string">"%Y-%m-%d %H:%M:%S"</span>)</span><br><span class="line">    % expr::attr&lt;sign_severity_level&gt;(<span class="string">"Severity"</span>)</span><br><span class="line">    % expr::attr&lt;attrs::current_thread_id::value_type&gt;(<span class="string">"ThreadID"</span>)</span><br><span class="line">    % expr::smessage</span><br><span class="line">    );</span><br></pre></td></tr></table></figure></p>
<h2 id="Boost-Format风格"><a href="#Boost-Format风格" class="headerlink" title="Boost::Format风格"></a>Boost::Format风格</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">logging::formatter fmt = expr::stream</span><br><span class="line">    &lt;&lt; <span class="built_in">std</span>::setw(<span class="number">6</span>) &lt;&lt; <span class="built_in">std</span>::setfill(<span class="string">'0'</span>) &lt;&lt; line_id &lt;&lt; <span class="built_in">std</span>::setfill(<span class="string">' '</span>)</span><br><span class="line">    &lt;&lt; <span class="string">": &lt;"</span> &lt;&lt; severity &lt;&lt; <span class="string">"&gt;\t"</span></span><br><span class="line">    &lt;&lt; expr::if_(expr::has_attr(tag_attr))</span><br><span class="line">        [</span><br><span class="line">            expr::stream &lt;&lt; <span class="string">"["</span> &lt;&lt; tag_attr &lt;&lt; <span class="string">"] "</span></span><br><span class="line">        ]</span><br><span class="line">    &lt;&lt; expr::smessage;</span><br></pre></td></tr></table></figure>
<h2 id="sink对象安装"><a href="#sink对象安装" class="headerlink" title="sink对象安装"></a>sink对象安装</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">core-&gt;add_sink(sink);</span><br></pre></td></tr></table></figure>
<h2 id="attributes"><a href="#attributes" class="headerlink" title="attributes"></a>attributes</h2><p>根据设计，日志记录是由attributes组成的，所以打印内容必须以attribute的方式传给sink对象<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sink-&gt;set_formatter (</span><br><span class="line">    expr::format(<span class="string">"[%1%]&lt;%2%&gt;(%3%)(%4%): %5%"</span>)</span><br><span class="line">    % expr::attr&lt;<span class="keyword">unsigned</span> <span class="keyword">int</span>&gt;(<span class="string">"LineID"</span>)</span><br><span class="line">    % expr::format_date_time&lt; boost::posix_time::ptime &gt;(<span class="string">"TimeStamp"</span>, <span class="string">"%Y-%m-%d %H:%M:%S"</span>)</span><br><span class="line">    % expr::attr&lt;sign_severity_level&gt;(<span class="string">"Severity"</span>)</span><br><span class="line">    % expr::attr&lt;attrs::current_thread_id::value_type &gt;(<span class="string">"ThreadID"</span>)</span><br><span class="line">    % expr::smessage</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>不要忘记添加commont attributes<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging::add_common_attributes();</span><br></pre></td></tr></table></figure></p>
<h2 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h2><p><a href="https://github.com/CaseZheng/SimpleServerFramework/blob/master/comm/log.cpp" target="_blank" rel="noopener">boost log封装示例代码 log.cpp</a><br><a href="https://github.com/CaseZheng/SimpleServerFramework/blob/master/comm/log.h" target="_blank" rel="noopener">boost log封装示例代码 log.h</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.casezheng.date/2018/04/09/mysql-10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CaseZheng">
      <meta itemprop="description" content="CaseZheng的博客网站">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CaseZheng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/09/mysql-10/" class="post-title-link" itemprop="url">MySQL数据导出、导入</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-09 21:14:17" itemprop="dateCreated datePublished" datetime="2018-04-09T21:14:17+08:00">2018-04-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MySQL数据导出工具mysqldump"><a href="#MySQL数据导出工具mysqldump" class="headerlink" title="MySQL数据导出工具mysqldump"></a>MySQL数据导出工具mysqldump</h1><p>mysqldump客户端工具是MySQL最常用的备份工具.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysqldump [option] db_name [tables]         # 备份单个数据库或者库中部分数据表</span><br><span class="line">mysqldump [option] --database DB1 [DB2 DB3] # 备份指定的一个或者多个数据库</span><br><span class="line">mysqldump [option] --all --database         # 备份所有数据库</span><br></pre></td></tr></table></figure></p>
<h2 id="连接选项"><a href="#连接选项" class="headerlink" title="连接选项"></a>连接选项</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-u, --user=name 指定用户名</span><br><span class="line">-p, --password[=name] 指定密码</span><br><span class="line">-h, --host=name 指定服务器IP或者域名</span><br><span class="line">-p, --port=# 指定连接端口</span><br></pre></td></tr></table></figure>
<h2 id="数据内容选项"><a href="#数据内容选项" class="headerlink" title="数据内容选项"></a>数据内容选项</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--add-drop-database 每个数据库创建语句前加上DROP DATABASE语句</span><br><span class="line">--add-drop-table 在每个表创建语句前加上DROP TABLE语句</span><br></pre></td></tr></table></figure>
<p>默认情况下这两个选项自动添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-n, --no-create-db 不包含数据库的创建语句</span><br><span class="line">-t, --no-create-info 不包含数据表的创建语句</span><br><span class="line">-d, --no-data 不包含数据</span><br></pre></td></tr></table></figure>
<h2 id="输出格式选项"><a href="#输出格式选项" class="headerlink" title="输出格式选项"></a>输出格式选项</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--compact 选项使数据结果更简洁,不包括默认选项中的各种注释</span><br><span class="line">-c, --complete-insert 使输出文件的insert语句包括字段名称</span><br><span class="line">-T 将指定数据表中的数据备份为单纯的数据文本和建表SQL两个文件</span><br></pre></td></tr></table></figure>
<h2 id="字符集选项"><a href="#字符集选项" class="headerlink" title="字符集选项"></a>字符集选项</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--default-character-set=name 选型设置导出的客户端字符集</span><br></pre></td></tr></table></figure>
<h2 id="其它常用选项"><a href="#其它常用选项" class="headerlink" title="其它常用选项"></a>其它常用选项</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-F, --flush-logs 备份前刷新日志</span><br><span class="line">-l, --lock-tables 给所有表加读锁 默认开启</span><br><span class="line">--where=condition 导出数据的条件</span><br><span class="line">--skip-lock-table 导出数据时不锁表</span><br></pre></td></tr></table></figure>
<h1 id="MySQL数据导入工具mysqlimport"><a href="#MySQL数据导入工具mysqlimport" class="headerlink" title="MySQL数据导入工具mysqlimport"></a>MySQL数据导入工具mysqlimport</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlimport [options] db_name textfile1 [textfile2...]</span><br></pre></td></tr></table></figure>
<p>也可以进入数据库使用sourece命令直接执行sql文件</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.casezheng.date/2018/04/01/mysql-9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CaseZheng">
      <meta itemprop="description" content="CaseZheng的博客网站">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CaseZheng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/01/mysql-9/" class="post-title-link" itemprop="url">MySQL 优化</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-01 00:01:39" itemprop="dateCreated datePublished" datetime="2018-04-01T00:01:39+08:00">2018-04-01</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="优化SQL步骤"><a href="#优化SQL步骤" class="headerlink" title="优化SQL步骤"></a>优化SQL步骤</h1><h2 id="了解SQL的执行频率"><a href="#了解SQL的执行频率" class="headerlink" title="了解SQL的执行频率"></a>了解SQL的执行频率</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> [<span class="keyword">session</span>|<span class="keyword">global</span>] <span class="keyword">status</span>;</span><br></pre></td></tr></table></figure>
<p>执行命令提供服务器状态信息，session表示显示session(当前连接)级别的统计结果，global表示显示global(从服务器启动至今)级别的统计结果，默认为session级别。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; show global status like 'Com_%';</span><br><span class="line">+<span class="comment">----------------------------+-------+</span></span><br><span class="line">| Variable_name              | Value |</span><br><span class="line">+<span class="comment">----------------------------+-------+</span></span><br><span class="line">| Com_admin_commands         | 1     |</span><br><span class="line">| Com_alter_db               | 0     |</span><br><span class="line">| Com_alter_db_upgrade       | 0     |</span><br><span class="line">| Com_alter_event            | 0     |</span><br><span class="line">| Com_alter_function         | 0     |</span><br><span class="line">| Com_alter_procedure        | 0     |</span><br><span class="line">... ...</span><br></pre></td></tr></table></figure></p>
<p>Com_xxx表示每个xxx语句执行的次数：</p>
<ul>
<li>Com_select:执行select操作的次数，一次查询只累加1</li>
<li>Com_insert:执行insert操作的次数，对于批量插入的insert操作，只累计一次</li>
<li>Com_update:执行update操作的次数</li>
<li>Com_delete:执行delete操作的次数</li>
</ul>
<p>Com_select、Com_insert、Com_update、Com_delete对所有存储引擎都进行累计。</p>
<p>只准对InnoDB存储引擎：</p>
<ul>
<li>Innodb_rows_read:select查询返回的行数</li>
<li>Innodb_rows_inserted:执行insert操作插入的行数</li>
<li>Innodb_rows_updated:执行update操作插入的行数</li>
<li>Innodb_rows_deleted:执行delete操作删除的行数</li>
</ul>
<p>对于更新操作的计数，是对执行次数的计数，不论提交还是回滚都会进行累计</p>
<p>Com_commit和Com_rollback可以了解事物提交和回滚的情况，对于回滚操作非常频繁的数据库，意味着程序编写存在问题。</p>
<p>了解数据库基本情况:</p>
<ul>
<li>Connections:试图连接MySQL服务器的次数</li>
<li>Uptime:服务器工作时间</li>
<li>Slow_queries:慢查询的次数</li>
</ul>
<h2 id="定位执行效率较低的SQL语句"><a href="#定位执行效率较低的SQL语句" class="headerlink" title="定位执行效率较低的SQL语句"></a>定位执行效率较低的SQL语句</h2><ol>
<li>通过慢查询日志定位</li>
<li>show processlist命令查看当前MySQL在进行的线程,包括线程的状态、是否锁表等,可以实时地查看SQL的执行情况,通过对一些锁表操作优化</li>
</ol>
<h2 id="通过EXPLAIN分析低效SQL的执行计划"><a href="#通过EXPLAIN分析低效SQL的执行计划" class="headerlink" title="通过EXPLAIN分析低效SQL的执行计划"></a>通过EXPLAIN分析低效SQL的执行计划</h2><p>查询到低效的SQL语句后,通过EXPLAIN或者DESC命令获取MySQL如何执行SELECT语句的信息,包括在SELECT语句执行过程中表如何连接和连接的顺序.<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; desc select * from test_int;</span><br><span class="line">+<span class="comment">------+-------------+----------+------+---------------+------+---------+------+------+-------+</span></span><br><span class="line">| id   | select_type | table    | type | possible_keys | key  | key_len | ref  | rows | Extra |</span><br><span class="line">+<span class="comment">------+-------------+----------+------+---------------+------+---------+------+------+-------+</span></span><br><span class="line">|    1 | SIMPLE      | test_int | ALL  | NULL          | NULL | NULL    | NULL |    4 |       |</span><br><span class="line">+<span class="comment">------+-------------+----------+------+---------------+------+---------+------+------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="keyword">test</span>]&gt; <span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> test_int;</span><br><span class="line">+<span class="comment">------+-------------+----------+------+---------------+------+---------+------+------+-------+</span></span><br><span class="line">| id   | select_type | table    | type | possible_keys | key  | key_len | ref  | rows | Extra |</span><br><span class="line">+<span class="comment">------+-------------+----------+------+---------------+------+---------+------+------+-------+</span></span><br><span class="line">|    1 | SIMPLE      | test_int | ALL  | NULL          | NULL | NULL    | NULL |    4 |       |</span><br><span class="line">+<span class="comment">------+-------------+----------+------+---------------+------+---------+------+------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>select_type:表示select查询的类型,常见的取值有SIMPLE(简单表,即不使用表连接或子查询)、PRIMARY(主查询,即外层的查询)、UNION(UNION中的第二个或后面的查询语句)、SUBQUERY(子查询中的第一个SELECT)等</li>
<li>table:数据结果集的表</li>
<li>type:表示MySQL在表中找到所需行的方式,或者叫访问类型.</li>
<li>possible_keys:表示查询时可能使用的索引</li>
<li>key:表示实际使用的索引</li>
<li>key_len:使用到索引字段的长度</li>
<li>rows:扫描行的数量</li>
<li>Extra:执行情况的说明和描述,包括不适合在其他列中显示但是对执行计划非常重要的额外信息</li>
</ul>
<p>type类型,从左至右,性能由最差到最好<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+<span class="comment">-----+-------+-------+-----+--------+--------------+------+</span></span><br><span class="line">| ALL | index | range | ref | eq_ref | const,system | NULL |</span><br><span class="line">+<span class="comment">-----+-------+-------+-----+--------+--------------+------+</span></span><br></pre></td></tr></table></figure></p>
<ol>
<li>ALL 全表扫描,MySQL遍历全表来找到匹配的行</li>
<li>index 索引全扫描,MySQL遍历整个索引来查询匹配的行</li>
<li>range 索引范围扫描,常见于\&lt;、\&lt;=、&gt;、&gt;=、between等操作符</li>
<li>ref 使用非唯一索引扫描或唯一索引的前缀扫描,返回匹配某个单独值的记录行</li>
<li>eq_ref 类似ref,区别就在使用的索引是唯一索引,对于每个索引键值,表中只有一条记录记录匹配;简单说,多表连接中使用primary key或者unique index作为关联条件</li>
<li>const/system 单表中最多有一个匹配行,查询起来非常迅速,所以这个匹配行中的其他列的值可以被优化器在当前查询中当错常量来处理</li>
<li>NULL MySQL不用访问表或索引,直接就能够得到结果</li>
</ol>
<p>通过explain extended命令和show warnings可以看到SQL真正被执行之前优化器做了哪些SQL改写.<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; explain extended select * from test_int;</span><br><span class="line">+<span class="comment">------+-------------+----------+------+---------------+------+---------+------+------+----------+-------+</span></span><br><span class="line">| id   | select_type | table    | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra |</span><br><span class="line">+<span class="comment">------+-------------+----------+------+---------------+------+---------+------+------+----------+-------+</span></span><br><span class="line">|    1 | SIMPLE      | test_int | ALL  | NULL          | NULL | NULL    | NULL |    4 |   100.00 |       |</span><br><span class="line">+<span class="comment">------+-------------+----------+------+---------------+------+---------+------+------+----------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="keyword">test</span>]&gt; <span class="keyword">show</span> <span class="keyword">warnings</span>;</span><br><span class="line">+<span class="comment">-------+------+-----------------------------------------------------------------------------------------+</span></span><br><span class="line">| Level | Code | Message                                                                                 |</span><br><span class="line">+<span class="comment">-------+------+-----------------------------------------------------------------------------------------+</span></span><br><span class="line">| Note  | 1003 | <span class="keyword">select</span> <span class="string">`test`</span>.<span class="string">`test_int`</span>.<span class="string">`a`</span> <span class="keyword">AS</span> <span class="string">`a`</span>,<span class="string">`test`</span>.<span class="string">`test_int`</span>.<span class="string">`b`</span> <span class="keyword">AS</span> <span class="string">`b`</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`test_int`</span> |</span><br><span class="line">+<span class="comment">-------+------+-----------------------------------------------------------------------------------------+</span></span><br></pre></td></tr></table></figure></p>
<p>filtered<br>通过warning的message字段可以看到优化器优化后的SQL. 碰到复杂SQL时,可以利用explain extended的结果迅速获取更清晰易读的SQL</p>
<h2 id="通过show-profile分析SQL"><a href="#通过show-profile分析SQL" class="headerlink" title="通过show profile分析SQL"></a>通过show profile分析SQL</h2><p>通过have_profiling参数可以看到当前MySQL是否支持profile:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select @@have_profiling;</span><br><span class="line">+<span class="comment">------------------+</span></span><br><span class="line">| @@have_profiling |</span><br><span class="line">+<span class="comment">------------------+</span></span><br><span class="line">| YES              |</span><br><span class="line">+<span class="comment">------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>通过profiling参数可以看到当前profiling是否打开<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select @@profiling;</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">| @@profiling |</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">|           0 |</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>通过set语句在session级别开启profiling<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; set profiling=1;</span><br><span class="line">Query OK, 0 rows affected (0.04 sec)</span><br></pre></td></tr></table></figure></p>
<p>通过profile可以清楚地了解SQL执行的过程.<br>在执行完SQL后,使用show profiles.查看执行SQL的Query_ID,再使用show profile for query查看执行过程中线程的每个状态和消耗时间.<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; show profiles;</span><br><span class="line">+<span class="comment">----------+------------+------------------------+</span></span><br><span class="line">| Query_ID | Duration   | Query                  |</span><br><span class="line">+<span class="comment">----------+------------+------------------------+</span></span><br><span class="line">|        1 | 0.00007221 | <span class="keyword">select</span> * <span class="keyword">from</span> test_int |</span><br><span class="line">|        <span class="number">2</span> | <span class="number">0.00012501</span> | <span class="keyword">SELECT</span> <span class="keyword">DATABASE</span>()      |</span><br><span class="line">|        <span class="number">3</span> | <span class="number">0.00029614</span> | <span class="keyword">show</span> <span class="keyword">databases</span>         |</span><br><span class="line">|        <span class="number">4</span> | <span class="number">0.00014315</span> | <span class="keyword">show</span> <span class="keyword">tables</span>            |</span><br><span class="line">|        <span class="number">5</span> | <span class="number">0.00038331</span> | <span class="keyword">select</span> * <span class="keyword">from</span> test_int |</span><br><span class="line">+<span class="comment">----------+------------+------------------------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="keyword">test</span>]&gt; <span class="keyword">show</span> profile <span class="keyword">for</span> <span class="keyword">query</span> <span class="number">5</span>;</span><br><span class="line">+<span class="comment">----------------------+----------+</span></span><br><span class="line">| Status               | Duration |</span><br><span class="line">+<span class="comment">----------------------+----------+</span></span><br><span class="line">| starting             | 0.000058 |</span><br><span class="line">| checking permissions | 0.000011 |</span><br><span class="line">| Opening tables       | 0.000026 |</span><br><span class="line">| After opening tables | 0.000023 |</span><br><span class="line">| System <span class="keyword">lock</span>          | <span class="number">0.000006</span> |</span><br><span class="line">| <span class="keyword">Table</span> <span class="keyword">lock</span>           | <span class="number">0.000043</span> |</span><br><span class="line">| <span class="keyword">After</span> <span class="keyword">table</span> <span class="keyword">lock</span>     | <span class="number">0.000009</span> |</span><br><span class="line">| init                 | <span class="number">0.000021</span> |</span><br><span class="line">| optimizing           | <span class="number">0.000011</span> |</span><br><span class="line">| <span class="keyword">statistics</span>           | <span class="number">0.000025</span> |</span><br><span class="line">| preparing            | <span class="number">0.000015</span> |</span><br><span class="line">| executing            | <span class="number">0.000005</span> |</span><br><span class="line">| Sending <span class="keyword">data</span>         | <span class="number">0.000083</span> |</span><br><span class="line">| <span class="keyword">end</span>                  | <span class="number">0.000006</span> |</span><br><span class="line">| <span class="keyword">query</span> <span class="keyword">end</span>            | <span class="number">0.000007</span> |</span><br><span class="line">| closing <span class="keyword">tables</span>       | <span class="number">0.000010</span> |</span><br><span class="line">| freeing items        | <span class="number">0.000012</span> |</span><br><span class="line">| updating <span class="keyword">status</span>      | <span class="number">0.000010</span> |</span><br><span class="line">| cleaning up          | <span class="number">0.000005</span> |</span><br><span class="line">+<span class="comment">----------------------+----------+</span></span><br><span class="line"><span class="number">19</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>Sending data状态表示MySQL线程开始访问数据行并把结果返回给客户端,而不仅仅是返回结果给客户端.在Sending data状态下,MySQL线程往往需要做大量的磁盘读取操作,所以经常是整个查询中耗时最长的状态.<br>可以使用show profile查看更加详细的资源消耗情况,可选择all、cpu、block io、context switch、page faults等<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; show profile all for query 5;</span><br><span class="line">+<span class="comment">----------------------+----------+----------+------------+-------------------+---------------------+--------------+---------------+---------------+-------------------+-------------------+-------------------+-------+-----------------------+---------------+-------------+</span></span><br><span class="line">| Status               | Duration | CPU_user | CPU_system | Context_voluntary | Context_involuntary | Block_ops_in | Block_ops_out | Messages_sent | Messages_received | Page_faults_major | Page_faults_minor | Swaps | Source_function       | Source_file   | Source_line |</span><br><span class="line">+<span class="comment">----------------------+----------+----------+------------+-------------------+---------------------+--------------+---------------+---------------+-------------------+-------------------+-------------------+-------+-----------------------+---------------+-------------+</span></span><br><span class="line">| starting             | 0.000058 | 0.000034 |   0.000018 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | NULL                  | NULL          |        NULL |</span><br><span class="line">| checking permissions | 0.000011 | 0.000006 |   0.000003 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | check_access          | sql_parse.cc  |        4911 |</span><br><span class="line">| Opening tables       | 0.000026 | 0.000017 |   0.000009 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | open_tables           | sql_base.cc   |        5048 |</span><br><span class="line">| After opening tables | 0.000023 | 0.000015 |   0.000008 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | open_tables           | sql_base.cc   |        5240 |</span><br><span class="line">| System <span class="keyword">lock</span>          | <span class="number">0.000006</span> | <span class="number">0.000004</span> |   <span class="number">0.000002</span> |                 <span class="number">0</span> |                   <span class="number">0</span> |            <span class="number">0</span> |             <span class="number">0</span> |             <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |     <span class="number">0</span> | mysql_lock_tables     | lock.cc       |         <span class="number">307</span> |</span><br><span class="line">| <span class="keyword">Table</span> <span class="keyword">lock</span>           | <span class="number">0.000043</span> | <span class="number">0.000028</span> |   <span class="number">0.000015</span> |                 <span class="number">0</span> |                   <span class="number">0</span> |            <span class="number">0</span> |             <span class="number">0</span> |             <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |     <span class="number">0</span> | mysql_lock_tables     | lock.cc       |         <span class="number">312</span> |</span><br><span class="line">| <span class="keyword">After</span> <span class="keyword">table</span> <span class="keyword">lock</span>     | <span class="number">0.000009</span> | <span class="number">0.000006</span> |   <span class="number">0.000003</span> |                 <span class="number">0</span> |                   <span class="number">0</span> |            <span class="number">0</span> |             <span class="number">0</span> |             <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |     <span class="number">0</span> | mysql_lock_tables     | lock.cc       |         <span class="number">326</span> |</span><br><span class="line">| init                 | <span class="number">0.000021</span> | <span class="number">0.000014</span> |   <span class="number">0.000007</span> |                 <span class="number">0</span> |                   <span class="number">0</span> |            <span class="number">0</span> |             <span class="number">0</span> |             <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |     <span class="number">0</span> | mysql_select          | sql_select.cc |        <span class="number">3075</span> |</span><br><span class="line">| optimizing           | <span class="number">0.000011</span> | <span class="number">0.000007</span> |   <span class="number">0.000004</span> |                 <span class="number">0</span> |                   <span class="number">0</span> |            <span class="number">0</span> |             <span class="number">0</span> |             <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |     <span class="number">0</span> | <span class="keyword">optimize</span>              | sql_select.cc |         <span class="number">990</span> |</span><br><span class="line">| <span class="keyword">statistics</span>           | <span class="number">0.000025</span> | <span class="number">0.000016</span> |   <span class="number">0.000008</span> |                 <span class="number">0</span> |                   <span class="number">0</span> |            <span class="number">0</span> |             <span class="number">0</span> |             <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |     <span class="number">0</span> | <span class="keyword">optimize</span>              | sql_select.cc |        <span class="number">1233</span> |</span><br><span class="line">| preparing            | <span class="number">0.000015</span> | <span class="number">0.000010</span> |   <span class="number">0.000005</span> |                 <span class="number">0</span> |                   <span class="number">0</span> |            <span class="number">0</span> |             <span class="number">0</span> |             <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |     <span class="number">0</span> | <span class="keyword">optimize</span>              | sql_select.cc |        <span class="number">1258</span> |</span><br><span class="line">| executing            | <span class="number">0.000005</span> | <span class="number">0.000003</span> |   <span class="number">0.000002</span> |                 <span class="number">0</span> |                   <span class="number">0</span> |            <span class="number">0</span> |             <span class="number">0</span> |             <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |     <span class="number">0</span> | exec                  | sql_select.cc |        <span class="number">2242</span> |</span><br><span class="line">| Sending <span class="keyword">data</span>         | <span class="number">0.000083</span> | <span class="number">0.000054</span> |   <span class="number">0.000029</span> |                 <span class="number">0</span> |                   <span class="number">0</span> |            <span class="number">0</span> |             <span class="number">0</span> |             <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |     <span class="number">0</span> | exec                  | sql_select.cc |        <span class="number">2873</span> |</span><br><span class="line">| <span class="keyword">end</span>                  | <span class="number">0.000006</span> | <span class="number">0.000004</span> |   <span class="number">0.000002</span> |                 <span class="number">0</span> |                   <span class="number">0</span> |            <span class="number">0</span> |             <span class="number">0</span> |             <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |     <span class="number">0</span> | mysql_select          | sql_select.cc |        <span class="number">3110</span> |</span><br><span class="line">| <span class="keyword">query</span> <span class="keyword">end</span>            | <span class="number">0.000007</span> | <span class="number">0.000004</span> |   <span class="number">0.000002</span> |                 <span class="number">0</span> |                   <span class="number">0</span> |            <span class="number">0</span> |             <span class="number">0</span> |             <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |     <span class="number">0</span> | mysql_execute_command | sql_parse.cc  |        <span class="number">4520</span> |</span><br><span class="line">| closing <span class="keyword">tables</span>       | <span class="number">0.000010</span> | <span class="number">0.000007</span> |   <span class="number">0.000003</span> |                 <span class="number">0</span> |                   <span class="number">0</span> |            <span class="number">0</span> |             <span class="number">0</span> |             <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |     <span class="number">0</span> | close_thread_tables   | sql_base.cc   |        <span class="number">1466</span> |</span><br><span class="line">| freeing items        | <span class="number">0.000012</span> | <span class="number">0.000008</span> |   <span class="number">0.000004</span> |                 <span class="number">0</span> |                   <span class="number">0</span> |            <span class="number">0</span> |             <span class="number">0</span> |             <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |     <span class="number">0</span> | mysql_parse           | sql_parse.cc  |        <span class="number">5944</span> |</span><br><span class="line">| updating <span class="keyword">status</span>      | <span class="number">0.000010</span> | <span class="number">0.000006</span> |   <span class="number">0.000004</span> |                 <span class="number">0</span> |                   <span class="number">0</span> |            <span class="number">0</span> |             <span class="number">0</span> |             <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |     <span class="number">0</span> | dispatch_command      | sql_parse.cc  |        <span class="number">1469</span> |</span><br><span class="line">| cleaning up          | <span class="number">0.000005</span> | <span class="number">0.000003</span> |   <span class="number">0.000001</span> |                 <span class="number">0</span> |                   <span class="number">0</span> |            <span class="number">0</span> |             <span class="number">0</span> |             <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |                 <span class="number">0</span> |     <span class="number">0</span> | dispatch_command      | sql_parse.cc  |        <span class="number">1486</span> |</span><br><span class="line">+<span class="comment">----------------------+----------+----------+------------+-------------------+---------------------+--------------+---------------+---------------+-------------------+-------------------+-------------------+-------+-----------------------+---------------+-------------+</span></span><br><span class="line"><span class="number">19</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="keyword">test</span>]&gt; <span class="keyword">show</span> profile cpu <span class="keyword">for</span> <span class="keyword">query</span> <span class="number">5</span>;</span><br><span class="line">+<span class="comment">----------------------+----------+----------+------------+</span></span><br><span class="line">| Status               | Duration | CPU_user | CPU_system |</span><br><span class="line">+<span class="comment">----------------------+----------+----------+------------+</span></span><br><span class="line">| starting             | 0.000058 | 0.000034 |   0.000018 |</span><br><span class="line">| checking permissions | 0.000011 | 0.000006 |   0.000003 |</span><br><span class="line">| Opening tables       | 0.000026 | 0.000017 |   0.000009 |</span><br><span class="line">| After opening tables | 0.000023 | 0.000015 |   0.000008 |</span><br><span class="line">| System <span class="keyword">lock</span>          | <span class="number">0.000006</span> | <span class="number">0.000004</span> |   <span class="number">0.000002</span> |</span><br><span class="line">| <span class="keyword">Table</span> <span class="keyword">lock</span>           | <span class="number">0.000043</span> | <span class="number">0.000028</span> |   <span class="number">0.000015</span> |</span><br><span class="line">| <span class="keyword">After</span> <span class="keyword">table</span> <span class="keyword">lock</span>     | <span class="number">0.000009</span> | <span class="number">0.000006</span> |   <span class="number">0.000003</span> |</span><br><span class="line">| init                 | <span class="number">0.000021</span> | <span class="number">0.000014</span> |   <span class="number">0.000007</span> |</span><br><span class="line">| optimizing           | <span class="number">0.000011</span> | <span class="number">0.000007</span> |   <span class="number">0.000004</span> |</span><br><span class="line">| <span class="keyword">statistics</span>           | <span class="number">0.000025</span> | <span class="number">0.000016</span> |   <span class="number">0.000008</span> |</span><br><span class="line">| preparing            | <span class="number">0.000015</span> | <span class="number">0.000010</span> |   <span class="number">0.000005</span> |</span><br><span class="line">| executing            | <span class="number">0.000005</span> | <span class="number">0.000003</span> |   <span class="number">0.000002</span> |</span><br><span class="line">| Sending <span class="keyword">data</span>         | <span class="number">0.000083</span> | <span class="number">0.000054</span> |   <span class="number">0.000029</span> |</span><br><span class="line">| <span class="keyword">end</span>                  | <span class="number">0.000006</span> | <span class="number">0.000004</span> |   <span class="number">0.000002</span> |</span><br><span class="line">| <span class="keyword">query</span> <span class="keyword">end</span>            | <span class="number">0.000007</span> | <span class="number">0.000004</span> |   <span class="number">0.000002</span> |</span><br><span class="line">| closing <span class="keyword">tables</span>       | <span class="number">0.000010</span> | <span class="number">0.000007</span> |   <span class="number">0.000003</span> |</span><br><span class="line">| freeing items        | <span class="number">0.000012</span> | <span class="number">0.000008</span> |   <span class="number">0.000004</span> |</span><br><span class="line">| updating <span class="keyword">status</span>      | <span class="number">0.000010</span> | <span class="number">0.000006</span> |   <span class="number">0.000004</span> |</span><br><span class="line">| cleaning up          | <span class="number">0.000005</span> | <span class="number">0.000003</span> |   <span class="number">0.000001</span> |</span><br><span class="line">+<span class="comment">----------------------+----------+----------+------------+</span></span><br><span class="line"><span class="number">19</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<h2 id="通过trace分析优化器如何选择执行计划"><a href="#通过trace分析优化器如何选择执行计划" class="headerlink" title="通过trace分析优化器如何选择执行计划"></a>通过trace分析优化器如何选择执行计划</h2><ol>
<li>打开trace,设置格式为JSON,设置trace最大能够使用的内存大小,避免解析过程中因为默认内存过小而不能完整显示.</li>
<li>执行想要trace的SQL语句</li>
<li>检查INFORMATION_SCHEMA.OPTIMIZER_TRACE<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SET OPTIMIZER_TRACE=&quot;enabled=on&quot;,END_MARKERS_IN_JSON=on;</span><br><span class="line">SET OPTIMIZER_TRACE_MAX_MEM_SIZE=1000000;</span><br><span class="line">SELECT * FROM INFORMATION_SCHEMA.OPTIMIZER_TRACE\G</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="确认问题并采取相应的优化措施"><a href="#确认问题并采取相应的优化措施" class="headerlink" title="确认问题并采取相应的优化措施"></a>确认问题并采取相应的优化措施</h2><h1 id="简单使用的优化方法"><a href="#简单使用的优化方法" class="headerlink" title="简单使用的优化方法"></a>简单使用的优化方法</h1><h2 id="定期分析表和检查表"><a href="#定期分析表和检查表" class="headerlink" title="定期分析表和检查表"></a>定期分析表和检查表</h2><p>分析表<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ANALYZE</span> [<span class="keyword">LOCAL</span>|<span class="keyword">NO_WRITE_TO_BINLOG</span>] <span class="keyword">TABLE</span> tbl_name[, tbl_name]...</span><br></pre></td></tr></table></figure></p>
<p>本语句用于分析和存储表的关键字分布,分析的结果将可以使得系统得到准确的统计信息,使得SQL能够生成正确的执行计划</p>
<p>检查表<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CHECK</span> <span class="keyword">TABLE</span> tbl_name[, tbl_name]...[<span class="keyword">option</span>]...option=&#123;<span class="keyword">QUICK</span>|<span class="keyword">FAST</span>|<span class="keyword">MEDIUM</span>|<span class="keyword">EXTENDED</span>|<span class="keyword">CHANGED</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>检查表的作用是检查一个或多个表是否有错误.<br>CHECK TABLE也可以检查是否是否有错误.</p>
<h2 id="定期优化表"><a href="#定期优化表" class="headerlink" title="定期优化表"></a>定期优化表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OPTIONMIZE [LOCAL|NO_WRITE_TO_BINLOG] TABLE tbl_name [,tbl_name]...</span><br></pre></td></tr></table></figure>
<p>优化表可以对表中的空间碎片进行合并.<br>InnoDB引擎的表可以设置innodb_file_per_table参数,设置InnoDB为独立表空间模式,每个数据库的每个表都会生成单独的ibd文件,用于存储表的数据和索引,减轻InnoDB表的控件回收问题.<br>删除大量数据后,InnoDB表可以通过alter table但不修改引擎的方式回收不用的空间<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tbl_name <span class="keyword">engine</span>=<span class="keyword">innodb</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong>ANLYZE、CHECK、OPTIMIZE、ALTER TABLE执行期间将对表进行锁定,因此一定注意在数据库不繁忙时执行相关操作</strong></p>
<h1 id="常用SQL的优化"><a href="#常用SQL的优化" class="headerlink" title="常用SQL的优化"></a>常用SQL的优化</h1><h2 id="大批量插入数据"><a href="#大批量插入数据" class="headerlink" title="大批量插入数据"></a>大批量插入数据</h2><p>使用load命令导入数据,可以通过适当的设置提高导入速度.<br>对于MyISAM存储引擎的表,可以使用DISABLE KEYS关闭MyISAM表非唯一索引的更新,读入完成后,使用ENABLE KEYS打开MyISAM表非唯一索引的更新.<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tbl_name <span class="keyword">disable</span> <span class="keyword">keys</span>;</span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> infole <span class="string">'/filepath'</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tbl_name <span class="keyword">enable</span> <span class="keyword">keys</span>;</span><br></pre></td></tr></table></figure></p>
<p>对于InnoDB存储引擎的表:</p>
<ol>
<li>将导入的数据按照主键的顺序排序</li>
<li>导入数据前执行SET UNIQUE_CHECKS=0关闭唯一性校验,导入结束再执行SET UNIQUE_CHECKS=1,恢复唯一性校验</li>
<li>关闭自动提交,等导入完成再打开(SET AUTOCOMMINT=0)</li>
</ol>
<h2 id="优化INSERT语句"><a href="#优化INSERT语句" class="headerlink" title="优化INSERT语句"></a>优化INSERT语句</h2><ol>
<li>同一客户端同时插入很多行,应尽量使用一条语句,减少客户端与数据库之间的连接、关闭等消耗</li>
<li>不同客户端插入很多行,使用INSERT DELAYED语句让INSERT语句马上执行,实际数据都被放在内存队列中,并没有真正写入磁盘</li>
<li>将索引文件和数据文件分在不同的磁盘上存放</li>
<li>批量插入可以通过增加bulk_insert_buffer_size变量值的方法提高速度,只对MyISAM表有用</li>
<li>当从文本文件装载一个表时,使用LOAD DATA INFILE,比使用INSERT语句快</li>
</ol>
<h2 id="优化ORDER-BY语句"><a href="#优化ORDER-BY语句" class="headerlink" title="优化ORDER BY语句"></a>优化ORDER BY语句</h2><h3 id="MySQL两种排序方式"><a href="#MySQL两种排序方式" class="headerlink" title="MySQL两种排序方式"></a>MySQL两种排序方式</h3><ol>
<li>通过使用有序索引顺序扫描直接返回有序数据,在使用explain分析查询语句时显示为Using Index,不需要额外排序操作效率较高</li>
<li>通过对返回数据进行排序(Filesort排序),所有不是通过索引直接返回排序结果的排序都叫Filesort排序.</li>
</ol>
<p>ORDER BY语句优化目标:尽量减少额外的排序,通过索引直接返回有序数据.</p>
<h3 id="Filesort优化"><a href="#Filesort优化" class="headerlink" title="Filesort优化"></a>Filesort优化</h3><p>通过建立合适的索引能减少Filesort的出现.如果条件限制导致Filesort不能消失,则需要加快Filesort的操作<br>对Filesort,MySQL的两种排序算法:</p>
<ol>
<li>两次扫描算法:根据条件取出排序字段和行指针信息,然后在排序区sort buffer中排序,如果sort buffer不足,则在临时表Temporary Table中存储排序结果.完成排序后再根据行指针回表读取记录.优点是排序的时候内存开销少,缺点是第二次读取记录会有大量随机I/O操作,MySQL4.1以前使用此方法</li>
<li>一次扫描算法:一次性取出所有满足条件行的所有字段,然后排序,优点是速度快,缺点是内存开销大</li>
</ol>
<p>MySQL通过比较系统变量max_length_for_sort_data的大小和Query语句取出的字段总大小判断使用那种排序算法.如果max_length_for_sort_data更大,则使用一次扫描算法,否则使用二次扫描算法<br>适当加大max_length_for_sort_data可以让MySQL选择一次扫描算法,提高效率,设置max_length_for_sort_data过大,会造成CPU利用率过低和磁盘I/O过高,CPU和I/O利用平衡即可.<br>尽量使用必要的字段,SELECT具体的字段名称,减少排序区的使用,提高SQL性能.</p>
<h2 id="优化GROUP-BY语句"><a href="#优化GROUP-BY语句" class="headerlink" title="优化GROUP BY语句"></a>优化GROUP BY语句</h2><p>如果查询包括GROUP BY但用户想避免排序结果的消耗,则可以指定ORDER BY NULL禁止排序.</p>
<h2 id="优化嵌套查询"><a href="#优化嵌套查询" class="headerlink" title="优化嵌套查询"></a>优化嵌套查询</h2><p>使用连接JOIN替代子查询,因为JOIN不需要在内存中创建临时表</p>
<h2 id="MySQL优化OR条件"><a href="#MySQL优化OR条件" class="headerlink" title="MySQL优化OR条件"></a>MySQL优化OR条件</h2><p>对于含有OR条件的查询子句,如果想利用索引,则OR之间的每个条件列都必须使用索引,如果没有索引则应该考虑增加索引.</p>
<h2 id="分页查询优化"><a href="#分页查询优化" class="headerlink" title="分页查询优化"></a>分页查询优化</h2><ol>
<li>在索引上完成排序分页操作,最后根据主键关联回原表查询所需额其他列内容</li>
<li>将LIMIT查询转化为某个位置的查询(将LIMIT m,n转化为LIMIT n的查询)</li>
</ol>
<h2 id="使用SQL提示"><a href="#使用SQL提示" class="headerlink" title="使用SQL提示"></a>使用SQL提示</h2><h3 id="USE-INDEX"><a href="#USE-INDEX" class="headerlink" title="USE INDEX"></a>USE INDEX</h3><p>在查询语句中表名的后面,添加USE INDEX来提供希望MySQL去参考的索引列表,让MySQL不再考虑其它可以索引</p>
<h3 id="IGNORE-INDEX"><a href="#IGNORE-INDEX" class="headerlink" title="IGNORE INDEX"></a>IGNORE INDEX</h3><p>让MySQL忽略一个或多个索引</p>
<h3 id="FORCE-INDEX"><a href="#FORCE-INDEX" class="headerlink" title="FORCE INDEX"></a>FORCE INDEX</h3><p>强制MySQL使用一个特定的索引</p>
<h1 id="常用SQL技巧"><a href="#常用SQL技巧" class="headerlink" title="常用SQL技巧"></a>常用SQL技巧</h1><h2 id="正则表达式的使用"><a href="#正则表达式的使用" class="headerlink" title="正则表达式的使用"></a>正则表达式的使用</h2><p>MySQL利用REGEXP命令提供给用户扩展的正则表达式功能.REGEXP在进行模式匹配时区分大小写.</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">序列</th>
<th style="text-align:center">序列说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">^</td>
<td style="text-align:center">在字符串的开始处进行匹配</td>
</tr>
<tr>
<td style="text-align:center">$</td>
<td style="text-align:center">在字符串的末尾处进行匹配</td>
</tr>
<tr>
<td style="text-align:center">.</td>
<td style="text-align:center">匹配任意单个字符，包括换行符</td>
</tr>
<tr>
<td style="text-align:center">[…]</td>
<td style="text-align:center">匹配出括号内的任意字符</td>
</tr>
<tr>
<td style="text-align:center"><sup><a href="#fn_..." id="reffn_...">...</a></sup></td>
<td style="text-align:center">匹配不出括号内的任意字符</td>
</tr>
<tr>
<td style="text-align:center">a*</td>
<td style="text-align:center">匹配零个或多个a（包括空串）</td>
</tr>
<tr>
<td style="text-align:center">a+</td>
<td style="text-align:center">匹配1个或多个a（不包括空串）</td>
</tr>
<tr>
<td style="text-align:center">a？</td>
<td style="text-align:center">匹配1个或零个a</td>
</tr>
<tr>
<td style="text-align:center">a1 &#124; a2</td>
<td style="text-align:center">匹配a1或a2</td>
</tr>
<tr>
<td style="text-align:center">a(m)</td>
<td style="text-align:center">匹配m个a</td>
</tr>
<tr>
<td style="text-align:center">a(m,)</td>
<td style="text-align:center">匹配m个或更多个a</td>
</tr>
<tr>
<td style="text-align:center">a(m,n)</td>
<td style="text-align:center">匹配m到n个a</td>
</tr>
<tr>
<td style="text-align:center">a(,n)</td>
<td style="text-align:center">匹配0到n个a</td>
</tr>
<tr>
<td style="text-align:center">(…)</td>
<td style="text-align:center">将模式元素组成单一元素</td>
</tr>
</tbody>
</table>
</div>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.casezheng.date/2018/03/30/mysql-8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CaseZheng">
      <meta itemprop="description" content="CaseZheng的博客网站">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CaseZheng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/30/mysql-8/" class="post-title-link" itemprop="url">MySQL 存储过程和函数 触发器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-30 20:18:02" itemprop="dateCreated datePublished" datetime="2018-03-30T20:18:02+08:00">2018-03-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-12 12:56:36" itemprop="dateModified" datetime="2020-04-12T12:56:36+08:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="存储过程和函数"><a href="#存储过程和函数" class="headerlink" title="存储过程和函数"></a>存储过程和函数</h1><p>存储过程和函数是事先经过编译并存储在数据库的一段SQL语句的集合，调用存储过程和函数可以简化应用开发人员的工作，减少数据在数据库和应用服务器之间的传输，对提高数据处理的效率有好处。<br>存储过程和函数的区别：</p>
<ol>
<li>函数必须有返回值，存储过程没有。</li>
<li>存储过程的参数使用IN、OUT、INOUT类型，而函数参数只能是IN类型。</li>
</ol>
<h1 id="存储过程和函数的相关操作"><a href="#存储过程和函数的相关操作" class="headerlink" title="存储过程和函数的相关操作"></a>存储过程和函数的相关操作</h1><h2 id="创建、修改存储过程或函数"><a href="#创建、修改存储过程或函数" class="headerlink" title="创建、修改存储过程或函数"></a>创建、修改存储过程或函数</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> sp_name ([proc_parameter[,...]])</span><br><span class="line">    [characteristic ...] routine_body</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> sp_name ([func_parameter[,...]])</span><br><span class="line">    <span class="keyword">RETURNS</span> <span class="keyword">type</span></span><br><span class="line">    [characteristic ...] routine_body</span><br><span class="line"></span><br><span class="line">    proc_parameter:</span><br><span class="line">    [ <span class="keyword">IN</span> | <span class="keyword">OUT</span> | INOUT ] param_name <span class="keyword">type</span></span><br><span class="line"></span><br><span class="line">    func_parameter:</span><br><span class="line">        param_name <span class="keyword">type</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span>:</span><br><span class="line">    <span class="keyword">Any</span> valid MySQL <span class="keyword">data</span> <span class="keyword">type</span></span><br><span class="line"></span><br><span class="line">characteristic:</span><br><span class="line">        <span class="keyword">LANGUAGE</span> <span class="keyword">SQL</span></span><br><span class="line">    | [<span class="keyword">NOT</span>] <span class="keyword">DETERMINISTIC</span></span><br><span class="line">    | &#123; CONTAINS <span class="keyword">SQL</span> | <span class="keyword">NO</span> <span class="keyword">SQL</span> | <span class="keyword">READS</span> <span class="keyword">SQL</span> <span class="keyword">DATA</span> | MODIFIES <span class="keyword">SQL</span> <span class="keyword">DATA</span> &#125;</span><br><span class="line">    | <span class="keyword">SQL</span> <span class="keyword">SECURITY</span> &#123; DEFINER | INVOKER &#125;</span><br><span class="line">    | <span class="keyword">COMMENT</span> <span class="string">'string'</span></span><br><span class="line"></span><br><span class="line">routine_body:</span><br><span class="line">    Valid <span class="keyword">SQL</span> <span class="keyword">procedure</span> <span class="keyword">statement</span> <span class="keyword">or</span> statements</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> &#123;<span class="keyword">PROCEDURE</span> | <span class="keyword">FUNCTION</span>&#125; sp_name [characteristic ...]</span><br><span class="line"></span><br><span class="line">characteristic:</span><br><span class="line">        &#123; CONTAINS <span class="keyword">SQL</span> | <span class="keyword">NO</span> <span class="keyword">SQL</span> | <span class="keyword">READS</span> <span class="keyword">SQL</span> <span class="keyword">DATA</span> | MODIFIES <span class="keyword">SQL</span> <span class="keyword">DATA</span> &#125;</span><br><span class="line">    | <span class="keyword">SQL</span> <span class="keyword">SECURITY</span> &#123; DEFINER | INVOKER &#125;</span><br><span class="line">    | <span class="keyword">COMMENT</span> <span class="string">'string</span></span><br></pre></td></tr></table></figure>
<p>调用过程：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CALL</span> sp_name([parameter[,......]])</span><br></pre></td></tr></table></figure></p>
<p>MySQL存储过程和函数允许包含DDL语句，允许在存储过程中执行提交或回滚，但存储过程和函数中不允许执行LOAD DATA INFILE语句。存储过程和函数可以调用其他的过程或函数。<br>在执行创建过程和函数之前，通过DELIMITER语句将语句的结束符从”;”修改成其他符号。在创建过程和函数后通过”DELIMITER ;”语句再将结束符改回”;”<br>存储过程的好处在于处理逻辑封装在数据库端，调用者不需要了解中间的处理逻辑，一旦处理逻辑发生变化，只需要修改存储过程即可，而对调用者的程序完全没有影响。</p>
<p>存储过程和函数的 CREATE 语法不支持使用 CREATE OR REPLACE 对存储过程和函数进行修改，如果需要对已有的存储过程或者函数进行修改，需要执行 ALTER 语法。</p>
<p>characteristic特征值部分：</p>
<ol>
<li>LANGUAGE SQL：说明下面过程的 BODY 是使用 SQL 语言编写，这条是系统默认的，为今后 MySQL 会支持的除 SQL 外的其他语言支持的存储过程而准备。</li>
<li>[NOT] DETERMINISTIC：DETERMINISTIC 确定的，即每次输入一样输出也一样的程序，NOT DETERMINISTIC 非确定的，默认是非确定的。当前，这个特征值还没有被优化程序使用。</li>
<li>{ CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA }：这些特征值提供子程序使用数据的内在信息，这些特征值目前只是提供给服务器，并没有根据这些特征值来约束过程实际使用数据的情况。如果这些特征没有明确给定，默认使用的值是 CONTAINS SQL。<ol>
<li>CONTAINS SQL 表示子程序不包含读或写数据的语句。</li>
<li>NO SQL 表示子程序不包含 SQL 语句。</li>
<li>READS SQL DATA 表示子程序包含读数据的语句，但不包含写数据的语句。</li>
<li>MODIFIES SQL DATA 表示子程序包含写数据的语句。</li>
</ol>
</li>
<li>SQL SECURITY { DEFINER | INVOKER }：可以用来指定子程序该用创建子程序者的许可来执行，还是使用调用者的许可来执行。默认值是 DEFINER。</li>
<li>COMMENT ‘string’：存储过程或者函数的注释信息</li>
</ol>
<h2 id="删除存储过程或者函数"><a href="#删除存储过程或者函数" class="headerlink" title="删除存储过程或者函数"></a>删除存储过程或者函数</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> &#123;<span class="keyword">PROCEDURE</span> | <span class="keyword">FUNCTION</span>&#125; [<span class="keyword">IF</span> <span class="keyword">EXISTS</span>] sp_name</span><br></pre></td></tr></table></figure>
<h2 id="查看存储过程或函数"><a href="#查看存储过程或函数" class="headerlink" title="查看存储过程或函数"></a>查看存储过程或函数</h2><h3 id="查看存储过程或函数的状态"><a href="#查看存储过程或函数的状态" class="headerlink" title="查看存储过程或函数的状态"></a>查看存储过程或函数的状态</h3><p>SHOW {PROCEDURE|FUNCTION} STATUS [LIKE ‘pattern’];</p>
<h3 id="查看存储过程或函数的定义"><a href="#查看存储过程或函数的定义" class="headerlink" title="查看存储过程或函数的定义"></a>查看存储过程或函数的定义</h3><p>SHOW CREATE {PROCEDURE|FUNCTION} sp_name;</p>
<h3 id="通过系统表查看存储过程或函数信息"><a href="#通过系统表查看存储过程或函数信息" class="headerlink" title="通过系统表查看存储过程或函数信息"></a>通过系统表查看存储过程或函数信息</h3><p>查看information_schema.routines表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; DELIMITER $$</span><br><span class="line">MariaDB [test]&gt; CREATE PROCEDURE select_test_int (IN p_a INT, IN p_b INT)</span><br><span class="line">    -&gt; READS SQL DATA</span><br><span class="line">    -&gt; BEGIN</span><br><span class="line">    -&gt;     SELECT a, b from test_int</span><br><span class="line">    -&gt;         WHERE a&lt;p_a or b&gt;p_b;</span><br><span class="line">    -&gt; END $$</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; DELIMITER ;</span><br><span class="line">MariaDB [test]&gt; call select_test_int(1, 10);</span><br><span class="line">+<span class="comment">----------+-------------+</span></span><br><span class="line">| a        | b           |</span><br><span class="line">+<span class="comment">----------+-------------+</span></span><br><span class="line">| 56457789 | 04294967295 |</span><br><span class="line">| 56457789 | 04294967295 |</span><br><span class="line">+<span class="comment">----------+-------------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">Query</span> OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="keyword">test</span>]&gt; <span class="keyword">call</span> select_test_int(<span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">+<span class="comment">----------+-------------+</span></span><br><span class="line">| a        | b           |</span><br><span class="line">+<span class="comment">----------+-------------+</span></span><br><span class="line">|    00001 | 00000000001 |</span><br><span class="line">| 56457789 | 04294967295 |</span><br><span class="line">|    00001 | 00000000001 |</span><br><span class="line">| 56457789 | 04294967295 |</span><br><span class="line">+<span class="comment">----------+-------------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">Query</span> OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="keyword">test</span>]&gt; <span class="keyword">SHOW</span> <span class="keyword">PROCEDURE</span> <span class="keyword">STATUS</span>;</span><br><span class="line">+<span class="comment">------+-----------------+-----------+----------------+---------------------+---------------------+---------------+---------+----------------------+----------------------+--------------------+</span></span><br><span class="line">| Db   | Name            | Type      | Definer        | Modified            | Created             | Security_type | <span class="keyword">Comment</span> | character_set_client | collation_connection | <span class="keyword">Database</span> <span class="keyword">Collation</span> |</span><br><span class="line">+<span class="comment">------+-----------------+-----------+----------------+---------------------+---------------------+---------------+---------+----------------------+----------------------+--------------------+</span></span><br><span class="line">| <span class="keyword">test</span> | select_test_int | <span class="keyword">PROCEDURE</span> | root@localhost | <span class="number">2018</span><span class="number">-03</span><span class="number">-30</span> <span class="number">22</span>:<span class="number">58</span>:<span class="number">38</span> | <span class="number">2018</span><span class="number">-03</span><span class="number">-30</span> <span class="number">22</span>:<span class="number">58</span>:<span class="number">38</span> | DEFINER       |         | utf8                 | utf8_general_ci      | latin1_swedish_ci  |</span><br><span class="line">+<span class="comment">------+-----------------+-----------+----------------+---------------------+---------------------+---------------+---------+----------------------+----------------------+--------------------+</span></span><br><span class="line"></span><br><span class="line">MariaDB [<span class="keyword">test</span>]&gt; <span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> select_test_int\G</span><br><span class="line">*************************** <span class="number">1.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">           <span class="keyword">Procedure</span>: select_test_int</span><br><span class="line">            sql_mode:</span><br><span class="line">    <span class="keyword">Create</span> <span class="keyword">Procedure</span>: <span class="keyword">CREATE</span> DEFINER=<span class="string">`root`</span>@<span class="string">`localhost`</span> <span class="keyword">PROCEDURE</span> <span class="string">`select_test_int`</span>(<span class="keyword">IN</span> p_a <span class="built_in">INT</span>, <span class="keyword">IN</span> p_b <span class="built_in">INT</span>)</span><br><span class="line">    <span class="keyword">READS</span> <span class="keyword">SQL</span> <span class="keyword">DATA</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SELECT</span> a, b <span class="keyword">from</span> test_int</span><br><span class="line">        <span class="keyword">WHERE</span> a&lt;p_a <span class="keyword">or</span> b&gt;p_b;</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line">character_set_client: utf8</span><br><span class="line">collation_connection: utf8_general_ci</span><br><span class="line">  <span class="keyword">Database</span> <span class="keyword">Collation</span>: latin1_swedish_ci</span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="keyword">test</span>]&gt; <span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> select_test_int\G</span><br><span class="line"><span class="keyword">Query</span> OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="keyword">test</span>]&gt; DELIMITER $$</span><br><span class="line">MariaDB [<span class="keyword">test</span>]&gt; <span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> select_test_int_f (p_a <span class="built_in">INT</span>, p_b <span class="built_in">INT</span>)</span><br><span class="line">    -&gt; <span class="keyword">RETURNS</span> <span class="built_in">INT</span></span><br><span class="line">    -&gt; <span class="keyword">BEGIN</span></span><br><span class="line">    -&gt;     <span class="keyword">DECLARE</span> p_c <span class="built_in">INT</span>;</span><br><span class="line">    -&gt;     SELECT count(1) INTO p_c from test_int</span><br><span class="line">    -&gt;         WHERE a&lt;p_a or b&gt;p_b;</span><br><span class="line">    -&gt;     RETURN(p_c);</span><br><span class="line">    -&gt; END $$</span><br><span class="line">Query OK, 0 rows affected (0.05 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; DELIMITER ;</span><br><span class="line">MariaDB [test]&gt; select select_test_int_f(1, 2);</span><br><span class="line">+<span class="comment">-------------------------+</span></span><br><span class="line">| select_test_int_f(1, 2) |</span><br><span class="line">+<span class="comment">-------------------------+</span></span><br><span class="line">|                       2 |</span><br><span class="line">+<span class="comment">-------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="keyword">test</span>]&gt; <span class="keyword">SHOW</span> <span class="keyword">FUNCTION</span> <span class="keyword">STATUS</span>;</span><br><span class="line">+<span class="comment">------+-------------------+----------+----------------+---------------------+---------------------+---------------+---------+----------------------+----------------------+--------------------+</span></span><br><span class="line">| Db   | Name              | Type     | Definer        | Modified            | Created             | Security_type | <span class="keyword">Comment</span> | character_set_client | collation_connection | <span class="keyword">Database</span> <span class="keyword">Collation</span> |</span><br><span class="line">+<span class="comment">------+-------------------+----------+----------------+---------------------+---------------------+---------------+---------+----------------------+----------------------+--------------------+</span></span><br><span class="line">| <span class="keyword">test</span> | select_test_int_f | <span class="keyword">FUNCTION</span> | root@localhost | <span class="number">2018</span><span class="number">-03</span><span class="number">-30</span> <span class="number">23</span>:<span class="number">14</span>:<span class="number">19</span> | <span class="number">2018</span><span class="number">-03</span><span class="number">-30</span> <span class="number">23</span>:<span class="number">14</span>:<span class="number">19</span> | DEFINER       |         | utf8                 | utf8_general_ci      | latin1_swedish_ci  |</span><br><span class="line">+<span class="comment">------+-------------------+----------+----------------+---------------------+---------------------+---------------+---------+----------------------+----------------------+--------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="keyword">test</span>]&gt; <span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> select_test_int_f\G</span><br><span class="line">*************************** <span class="number">1.</span> <span class="keyword">row</span> ***************************</span><br><span class="line"><span class="keyword">Function</span>: select_test_int_f</span><br><span class="line">            sql_mode:</span><br><span class="line">     <span class="keyword">Create</span> <span class="keyword">Function</span>: <span class="keyword">CREATE</span> DEFINER=<span class="string">`root`</span>@<span class="string">`localhost`</span> <span class="keyword">FUNCTION</span> <span class="string">`select_test_int_f`</span>(p_a <span class="built_in">INT</span>, p_b <span class="built_in">INT</span>) <span class="keyword">RETURNS</span> <span class="built_in">int</span>(<span class="number">11</span>)</span><br><span class="line">        <span class="keyword">BEGIN</span></span><br><span class="line">        <span class="keyword">DECLARE</span> p_c <span class="built_in">INT</span>;</span><br><span class="line">            <span class="keyword">SELECT</span> <span class="keyword">count</span>(<span class="number">1</span>) <span class="keyword">INTO</span> p_c <span class="keyword">from</span> test_int</span><br><span class="line">                <span class="keyword">WHERE</span> a&lt;p_a <span class="keyword">or</span> b&gt;p_b;</span><br><span class="line">            RETURN(p_c);</span><br><span class="line">        <span class="keyword">END</span></span><br><span class="line">character_set_client: utf8</span><br><span class="line">collation_connection: utf8_general_ci</span><br><span class="line"><span class="keyword">Database</span> <span class="keyword">Collation</span>: latin1_swedish_ci</span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="keyword">test</span>]&gt; <span class="keyword">select</span> * <span class="keyword">from</span> information_schema.routines <span class="keyword">where</span> SPECIFIC_NAME=<span class="string">'select_test_int_f'</span>\G</span><br><span class="line">*************************** <span class="number">1.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">           SPECIFIC_NAME: select_test_int_f</span><br><span class="line">         ROUTINE_CATALOG: <span class="keyword">def</span></span><br><span class="line">          ROUTINE_SCHEMA: <span class="keyword">test</span></span><br><span class="line">            ROUTINE_NAME: select_test_int_f</span><br><span class="line">            ROUTINE_TYPE: <span class="keyword">FUNCTION</span></span><br><span class="line">               DATA_TYPE: <span class="built_in">int</span></span><br><span class="line">CHARACTER_MAXIMUM_LENGTH: <span class="literal">NULL</span></span><br><span class="line">  CHARACTER_OCTET_LENGTH: <span class="literal">NULL</span></span><br><span class="line">       NUMERIC_PRECISION: <span class="number">10</span></span><br><span class="line">           NUMERIC_SCALE: <span class="number">0</span></span><br><span class="line">      DATETIME_PRECISION: <span class="literal">NULL</span></span><br><span class="line">      CHARACTER_SET_NAME: <span class="literal">NULL</span></span><br><span class="line">          COLLATION_NAME: <span class="literal">NULL</span></span><br><span class="line">          DTD_IDENTIFIER: <span class="built_in">int</span>(<span class="number">11</span>)</span><br><span class="line">            ROUTINE_BODY: <span class="keyword">SQL</span></span><br><span class="line">      ROUTINE_DEFINITION: <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> p_c <span class="built_in">INT</span>;</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">count</span>(<span class="number">1</span>) <span class="keyword">INTO</span> p_c <span class="keyword">from</span> test_int</span><br><span class="line">        <span class="keyword">WHERE</span> a&lt;p_a <span class="keyword">or</span> b&gt;p_b;</span><br><span class="line">    RETURN(p_c);</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line">           EXTERNAL_NAME: <span class="literal">NULL</span></span><br><span class="line">       EXTERNAL_LANGUAGE: <span class="literal">NULL</span></span><br><span class="line">         PARAMETER_STYLE: <span class="keyword">SQL</span></span><br><span class="line">        IS_DETERMINISTIC: <span class="keyword">NO</span></span><br><span class="line">         SQL_DATA_ACCESS: CONTAINS <span class="keyword">SQL</span></span><br><span class="line">                SQL_PATH: <span class="literal">NULL</span></span><br><span class="line">           SECURITY_TYPE: DEFINER</span><br><span class="line">                 CREATED: <span class="number">2018</span><span class="number">-03</span><span class="number">-30</span> <span class="number">23</span>:<span class="number">14</span>:<span class="number">19</span></span><br><span class="line">            LAST_ALTERED: <span class="number">2018</span><span class="number">-03</span><span class="number">-30</span> <span class="number">23</span>:<span class="number">14</span>:<span class="number">19</span></span><br><span class="line">                SQL_MODE:</span><br><span class="line">         ROUTINE_COMMENT:</span><br><span class="line">                 DEFINER: root@localhost</span><br><span class="line">    CHARACTER_SET_CLIENT: utf8</span><br><span class="line">    COLLATION_CONNECTION: utf8_general_ci</span><br><span class="line">      DATABASE_COLLATION: latin1_swedish_ci</span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="keyword">test</span>]&gt; <span class="keyword">drop</span> <span class="keyword">function</span> <span class="keyword">if</span> <span class="keyword">exists</span> select_test_int_f;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>
<h1 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h1><p>存储过程和函数都可以使用变量，变量不区分大小写。</p>
<h2 id="变量定义"><a href="#变量定义" class="headerlink" title="变量定义"></a>变量定义</h2><p>通过 DECLARE 可以定义一个局部变量，该变量的作用范围只能在 BEGIN……END 块中，可以用在嵌套的块中。变量的定义必须写在复合语句的开头，并且在任何其他语句的前面。可以一次声明多个相同类型的变量。如果需要，可以使用 DEFAULT 赋默认值。<br>定义一个变量的语法如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> var_name[,...] <span class="keyword">type</span> [<span class="keyword">DEFAULT</span> <span class="keyword">value</span>]</span><br></pre></td></tr></table></figure></p>
<h2 id="变量赋值"><a href="#变量赋值" class="headerlink" title="变量赋值"></a>变量赋值</h2><p>变量可以直接赋值，或者通过查询赋值。<br>直接赋值使用 SET，可以赋常量或者赋表达式，具体语法如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> var_name = expr [, var_name = expr] ...</span><br></pre></td></tr></table></figure></p>
<p>通过查询赋值：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> col_name[,...] <span class="keyword">INTO</span> var_name[,...] table_expr</span><br></pre></td></tr></table></figure></p>
<h1 id="定义条件和处理"><a href="#定义条件和处理" class="headerlink" title="定义条件和处理"></a>定义条件和处理</h1><h2 id="条件定义"><a href="#条件定义" class="headerlink" title="条件定义"></a>条件定义</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> condition_name CONDITION <span class="keyword">FOR</span> condition_value</span><br><span class="line"></span><br><span class="line">condition_value:</span><br><span class="line">        <span class="keyword">SQLSTATE</span> [<span class="keyword">VALUE</span>] sqlstate_value</span><br><span class="line">    | mysql_error_code</span><br></pre></td></tr></table></figure>
<h2 id="条件处理"><a href="#条件处理" class="headerlink" title="条件处理"></a>条件处理</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> handler_type <span class="keyword">HANDLER</span> <span class="keyword">FOR</span> condition_value[,...] sp_statement</span><br><span class="line"></span><br><span class="line">handler_type:</span><br><span class="line">        CONTINUE</span><br><span class="line">    | <span class="keyword">EXIT</span></span><br><span class="line">    | <span class="keyword">UNDO</span></span><br><span class="line"></span><br><span class="line">condition_value:</span><br><span class="line">        <span class="keyword">SQLSTATE</span> [<span class="keyword">VALUE</span>] sqlstate_value</span><br><span class="line">    | condition_name</span><br><span class="line">    | SQLWARNING</span><br><span class="line">    | <span class="keyword">NOT</span> <span class="keyword">FOUND</span></span><br><span class="line">    | SQLEXCEPTION</span><br><span class="line">    | mysql_error_code</span><br></pre></td></tr></table></figure>
<h1 id="光标的使用"><a href="#光标的使用" class="headerlink" title="光标的使用"></a>光标的使用</h1><p>在存储过程和函数中可以使用光标对结果集进行循环的处理。光标的使用包括光标的声明、<br>OPEN、FETCH 和 CLOSE，其语法分别如下。</p>
<p>声明光标：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> cursor_name <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> select_statement</span><br></pre></td></tr></table></figure></p>
<p>OPEN 光标：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OPEN cursor_name</span><br></pre></td></tr></table></figure></p>
<p>FETCH 光标：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FETCH cursor_name INTO var_name [, var_name] ...</span><br></pre></td></tr></table></figure></p>
<p>CLOSE 光标：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CLOSE cursor_name</span><br></pre></td></tr></table></figure></p>
<p><strong>变量、条件、处理程序、光标都是通过 DECLARE 定义的，它们之间是有先后顺序的要求的。变量和条件必须在最前面声明，然后才能是光标的声明，最后才可以是处理程序的声明</strong></p>
<h1 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h1><h2 id="IF语句"><a href="#IF语句" class="headerlink" title="IF语句"></a>IF语句</h2><p>IF 实现条件判断，满足不同的条件执行不同的语句列表，具体语法如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">IF search_condition THEN statement_list</span><br><span class="line">    [ELSEIF search_condition THEN statement_list] ...</span><br><span class="line">    [ELSE statement_list]</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">IF</span></span><br></pre></td></tr></table></figure></p>
<h2 id="CASE语句"><a href="#CASE语句" class="headerlink" title="CASE语句"></a>CASE语句</h2><p>CASE 实现比 IF 更复杂一些的条件构造，具体语法如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CASE case_value</span><br><span class="line">    WHEN when_value THEN statement_list</span><br><span class="line">    [WHEN when_value THEN statement_list] ...</span><br><span class="line">    [ELSE statement_list]</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">CASE</span></span><br><span class="line"><span class="keyword">Or</span>:</span><br><span class="line"><span class="keyword">CASE</span></span><br><span class="line">    <span class="keyword">WHEN</span> search_condition <span class="keyword">THEN</span> statement_list</span><br><span class="line">    [<span class="keyword">WHEN</span> search_condition <span class="keyword">THEN</span> statement_list] ...</span><br><span class="line">    [<span class="keyword">ELSE</span> statement_list]</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">CASE</span></span><br></pre></td></tr></table></figure></p>
<h2 id="LOOP语句"><a href="#LOOP语句" class="headerlink" title="LOOP语句"></a>LOOP语句</h2><p>LOOP 实现简单的循环，退出循环的条件需要使用其他的语句定义，通常可以使用 LEAVE 语句实现，具体语法如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[begin_label:] LOOP</span><br><span class="line">    statement_list</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">LOOP</span> [end_label]</span><br></pre></td></tr></table></figure></p>
<p>如果不在 statement_list 中增加退出循环的语句，那么 LOOP 语句可以用来实现简单的死循环</p>
<h2 id="LEAVE语句"><a href="#LEAVE语句" class="headerlink" title="LEAVE语句"></a>LEAVE语句</h2><p>用来从标注的流程构造中退出，通常和 BEGIN … END 或者循环一起使用。</p>
<h2 id="INTRATE语句"><a href="#INTRATE语句" class="headerlink" title="INTRATE语句"></a>INTRATE语句</h2><p>ITERATE 语句必须用在循环中，作用是跳过当前循环的剩下的语句，直接进入下一轮循环</p>
<h2 id="REPEAT语句"><a href="#REPEAT语句" class="headerlink" title="REPEAT语句"></a>REPEAT语句</h2><p>有条件的循环控制语句，当满足条件的时候退出循环，具体语法如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[begin_label:] REPEAT</span><br><span class="line">    statement_list</span><br><span class="line">UNTIL search_condition</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">REPEAT</span> [end_label]</span><br></pre></td></tr></table></figure></p>
<h2 id="WHERE-语句"><a href="#WHERE-语句" class="headerlink" title="WHERE 语句"></a>WHERE 语句</h2><p>WHILE 语句实现的也是有条件的循环控制语句，即当满足条件时执行循环的内容，具体语法如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[begin_label:] WHILE search_condition <span class="keyword">DO</span></span><br><span class="line">    statement_list</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">WHILE</span> [end_label]</span><br></pre></td></tr></table></figure></p>
<p>WHILE 循环和 REPEAT 循环的区别在于：WHILE 是满足条件才执行循环，REPEAT 是满足条件退出循环；WHILE 在首次循环执行之前就判断条件，所以循环最少执行 0 次，而 REPEAT 是在首次执行循环之后才判断条件，所以循环最少执行 1 次。</p>
<p>存储过程和函数的优势是可以将数据的处理放在数据库服务器上进行，避免将大量的结果集传输给客户端，减少数据的传输，但是在数据库服务器上进行大量的复杂运算也会占用服务器的 CPU，造成数据库服务器的压力，所以不要在存储过程和函数中进行大量的复杂运算，应尽量将这些运算操作分摊到应用服务器上执行</p>
<h1 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h1><h2 id="触发器创建"><a href="#触发器创建" class="headerlink" title="触发器创建"></a>触发器创建</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> trigger_name trigger_time trigger_event <span class="keyword">ON</span> tbl_name <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span> trigger_stmt</span><br></pre></td></tr></table></figure>
<p>触发器只能创建在永久表上，不能对临时表创建触发器。<br>trigger_time触发器的触发时间，可以是BEFORE或AFTER，BEFORE的含义指在检查约束前出发，而AFTER在检查约束后触发。<br>trigger_event触发器触发的事件，INSERT、UPDATE或者DELETE。<br>对同一个表相同触发时间的相同触发事件，只能定义一个触发器。<br>使用别名OLD和NEW来引用触发器中发生变化的记录内容。</p>
<h2 id="删除触发器"><a href="#删除触发器" class="headerlink" title="删除触发器"></a>删除触发器</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> [schema_name.]trigger_name;</span><br></pre></td></tr></table></figure>
<h2 id="查看触发器"><a href="#查看触发器" class="headerlink" title="查看触发器"></a>查看触发器</h2><h3 id="SHOW-TRIGGERS"><a href="#SHOW-TRIGGERS" class="headerlink" title="SHOW TRIGGERS"></a>SHOW TRIGGERS</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TRIGGERS</span>;</span><br></pre></td></tr></table></figure>
<h3 id="系统triggers表"><a href="#系统triggers表" class="headerlink" title="系统triggers表"></a>系统triggers表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> information_schema.triggers;</span><br></pre></td></tr></table></figure>
<h2 id="触发器使用"><a href="#触发器使用" class="headerlink" title="触发器使用"></a>触发器使用</h2><p>触发器执行的语句的限制：</p>
<ol>
<li>触发程序不能调用将数据返回客户端的存储程序，也不能使用采用 CALL 语句的动态 SQL 语句，但是允许存储程序通过参数将数据返回触发程序。也就是存储过程或者函数通过 OUT 或者 INOUT 类型的参数将数据返回触发器是可以的，但是不能调用直接返回数据的过程。</li>
<li>不能在触发器中使用以显式或隐式方式开始或结束事务的语句，如 START TRANSACTION、COMMIT 或 ROLLBACK。</li>
</ol>
<p>MySQL 的触发器是按照 BEFORE 触发器、行操作、AFTER 触发器的顺序执行的，其中任何一步操作发生错误都不会继续执行剩下的操作。如果是对事务表进行的操作，那么会整个作为一个事务被回滚（Rollback），但是如果是对非事务表进行的操作，那么已经更新的记录将无法回滚，这也是设计触发器的时候需要注意的问题.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.casezheng.date/2018/03/27/mysql-7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CaseZheng">
      <meta itemprop="description" content="CaseZheng的博客网站">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CaseZheng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/27/mysql-7/" class="post-title-link" itemprop="url">MySQL 字符集、索引、视图</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-27 23:54:51" itemprop="dateCreated datePublished" datetime="2018-03-27T23:54:51+08:00">2018-03-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-12 12:56:36" itemprop="dateModified" datetime="2020-04-12T12:56:36+08:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="字符集"><a href="#字符集" class="headerlink" title="字符集"></a>字符集</h1><h2 id="查看MySQL支持的字符集"><a href="#查看MySQL支持的字符集" class="headerlink" title="查看MySQL支持的字符集"></a>查看MySQL支持的字符集</h2><ol>
<li>show character set;</li>
<li>查看information_schema.character_set</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [information_schema]&gt; show character set;</span><br><span class="line">+<span class="comment">----------+-----------------------------+---------------------+--------+</span></span><br><span class="line">| Charset  | Description                 | Default collation   | Maxlen |</span><br><span class="line">+<span class="comment">----------+-----------------------------+---------------------+--------+</span></span><br><span class="line">| big5     | Big5 Traditional Chinese    | big5_chinese_ci     |      2 |</span><br><span class="line">| dec8     | DEC West European           | dec8_swedish_ci     |      1 |</span><br><span class="line">| cp850    | DOS West European           | cp850_general_ci    |      1 |</span><br><span class="line">| hp8      | HP West European            | hp8_english_ci      |      1 |</span><br><span class="line">| koi8r    | KOI8-R Relcom Russian       | koi8r_general_ci    |      1 |</span><br><span class="line">... ...</span><br><span class="line"></span><br><span class="line">MariaDB [information_schema]&gt; select * from information_schema.character_sets;</span><br><span class="line">+<span class="comment">--------------------+----------------------+-----------------------------+--------+</span></span><br><span class="line">| CHARACTER_SET_NAME | DEFAULT_COLLATE_NAME | DESCRIPTION                 | MAXLEN |</span><br><span class="line">+<span class="comment">--------------------+----------------------+-----------------------------+--------+</span></span><br><span class="line">| big5               | big5_chinese_ci      | Big5 Traditional Chinese    |      2 |</span><br><span class="line">| dec8               | dec8_swedish_ci      | DEC West European           |      1 |</span><br><span class="line">| cp850              | cp850_general_ci     | DOS West European           |      1 |</span><br><span class="line">| hp8                | hp8_english_ci       | HP West European            |      1 |</span><br><span class="line">| koi8r              | koi8r_general_ci     | KOI8-R Relcom Russian       |      1 |</span><br><span class="line">... ...</span><br></pre></td></tr></table></figure>
<p>MySQL字符集包括字符集(CHARACTER)和校对规则(COLLATION)两个概念。 字符集定义MySQL存储字符串的方式。 校对规则定义比较字符串的方式。字符串和校对规则一对多，每个字符集至少对应一个校对规则。<br>使用SHOW COLLATION; 或查看那information_schema.COLLATIONS表查看所有校对规则<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [information_schema]&gt; show COLLATION;</span><br><span class="line">+<span class="comment">--------------------------+----------+-----+---------+----------+---------+</span></span><br><span class="line">| Collation                | Charset  | Id  | Default | Compiled | Sortlen |</span><br><span class="line">+<span class="comment">--------------------------+----------+-----+---------+----------+---------+</span></span><br><span class="line">| big5_chinese_ci          | big5     |   1 | Yes     | Yes      |       1 |</span><br><span class="line">| big5_bin                 | big5     |  84 |         | Yes      |       1 |</span><br><span class="line">| dec8_swedish_ci          | dec8     |   3 | Yes     | Yes      |       1 |</span><br><span class="line">| dec8_bin                 | dec8     |  69 |         | Yes      |       1 |</span><br><span class="line">... ...</span><br><span class="line"></span><br><span class="line">MariaDB [information_schema]&gt; select * from information_schema.COLLATIONS;</span><br><span class="line">+<span class="comment">--------------------------+--------------------+-----+------------+-------------+---------+</span></span><br><span class="line">| COLLATION_NAME           | CHARACTER_SET_NAME | ID  | IS_DEFAULT | IS_COMPILED | SORTLEN |</span><br><span class="line">+<span class="comment">--------------------------+--------------------+-----+------------+-------------+---------+</span></span><br><span class="line">| big5_chinese_ci          | big5               |   1 | Yes        | Yes         |       1 |</span><br><span class="line">| big5_bin                 | big5               |  84 |            | Yes         |       1 |</span><br><span class="line">| dec8_swedish_ci          | dec8               |   3 | Yes        | Yes         |       1 |</span><br><span class="line">| dec8_bin                 | dec8               |  69 |            | Yes         |       1 |</span><br><span class="line">| cp850_general_ci         | cp850              |   4 | Yes        | Yes         |       1 |</span><br><span class="line">| cp850_bin                | cp850              |  80 |            | Yes         |       1 |</span><br><span class="line">... ...</span><br></pre></td></tr></table></figure></p>
<p>校对规则命名约定:以与其相关的字符集名开始，包含语言名，并且以_ci(大小写不敏感)、_cs(大小写敏感)或_bin(二元，即比较基于字符编码的值而与language无关)结束。</p>
<h2 id="字符集设置"><a href="#字符集设置" class="headerlink" title="字符集设置"></a>字符集设置</h2><p>MySQL的字符集和校对规则有4个默认级别：服务器级、数据库级、表级、字段级。</p>
<h3 id="服务器字符集和校对规则"><a href="#服务器字符集和校对规则" class="headerlink" title="服务器字符集和校对规则"></a>服务器字符集和校对规则</h3><p>服务器字符集和校对规则在MySQL服务启动的时候确定。</p>
<ol>
<li><p>my.cnf中设置</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">default-character-<span class="keyword">set</span>=gbk</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动选项中指定</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld <span class="comment">--default-character_set=gdk</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编译时指定</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --with-charset=gbk</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>如果没有特别指定服务器字符集，默认使用latin1作为服务器字符集。如未指定校对规则，则使用字符集默认的校对规则。<br>使用show variables like ‘character_set_server’查看服务器字符集<br>使用show variables like ‘collation_server’查看服务器校对规则<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; show variables like 'character_set_server';</span><br><span class="line">+<span class="comment">----------------------+--------+</span></span><br><span class="line">| Variable_name        | Value  |</span><br><span class="line">+<span class="comment">----------------------+--------+</span></span><br><span class="line">| character_set_server | latin1 |</span><br><span class="line">+<span class="comment">----------------------+--------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(<span class="keyword">none</span>)]&gt; <span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'collation_server'</span>;</span><br><span class="line">+<span class="comment">------------------+-------------------+</span></span><br><span class="line">| Variable_name    | Value             |</span><br><span class="line">+<span class="comment">------------------+-------------------+</span></span><br><span class="line">| collation_server | latin1_swedish_ci |</span><br><span class="line">+<span class="comment">------------------+-------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<h3 id="数据库字符集和校对规则"><a href="#数据库字符集和校对规则" class="headerlink" title="数据库字符集和校对规则"></a>数据库字符集和校对规则</h3><p>数据库字符集和校对规则在创建数据库时指定，也可通过alter database命令修改。如果数据库中已存在数据，修改字符集并不能将已有数据按照新的字符集存储<br>设置数据库字符集的规则：</p>
<ul>
<li>如果指定了字符集和校对规则，则使用指定的字符集和校对规则；</li>
<li>如果指定了字符集没有指定校对规则，则使用指定字符集的默认校对规则；</li>
<li>如果没有指定字符集和校对规则，则使用服务器字符集和校对规则作为数据库的字符集和校对规则<br>使用show variables like ‘character_set_database’查看数据库字符集<br>使用show variables like ‘collation_database’查看数据库校对规则<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; show variables like 'character_set_database';</span><br><span class="line">+<span class="comment">------------------------+--------+</span></span><br><span class="line">| Variable_name          | Value  |</span><br><span class="line">+<span class="comment">------------------------+--------+</span></span><br><span class="line">| character_set_database | latin1 |</span><br><span class="line">+<span class="comment">------------------------+--------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="keyword">test</span>]&gt; <span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'collation_database'</span>;</span><br><span class="line">+<span class="comment">--------------------+-------------------+</span></span><br><span class="line">| Variable_name      | Value             |</span><br><span class="line">+<span class="comment">--------------------+-------------------+</span></span><br><span class="line">| collation_database | latin1_swedish_ci |</span><br><span class="line">+<span class="comment">--------------------+-------------------+</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="表字符集和校对规则"><a href="#表字符集和校对规则" class="headerlink" title="表字符集和校对规则"></a>表字符集和校对规则</h3><p>表的字符集和校对规则在创建表的时候指定，可以通过 alter table 命令进行修改。如果表中已有记录，修改字符集对原有的记录并没有影响，不会按照新的字符集进行存放。表的字段仍然使用原来的字符集。<br>设置表字符集的规则：</p>
<ol>
<li>如果指定了字符集和校对规则，使用指定的字符集和校对规则；</li>
<li>如果指定了字符集没有指定校对规则，使用指定字符集的默认校对规则；</li>
<li>如果没有指定字符集和校对规则，使用数据库字符集和校对规则作为表的字符集和校对规则。<br>推荐在创建表的时候明确指定字符集和校对规则，避免受到默认值的影响。要显示表的字符集和校对规则，可以使用 show create table 命令查看</li>
</ol>
<h3 id="列字符集和校对规则"><a href="#列字符集和校对规则" class="headerlink" title="列字符集和校对规则"></a>列字符集和校对规则</h3><p>列字符集和校对规则的定义可以在创建表时指定，或者在修改表时调整，如果在创建表的时候没有特别指定字符集和校对规则，则默认使用表的字符集和校对规则。</p>
<h2 id="连接字符集和校对规则"><a href="#连接字符集和校对规则" class="headerlink" title="连接字符集和校对规则"></a>连接字符集和校对规则</h2><p>MySQL提供三个参数：character_set_client、character_set_connection 和 character_set_results，分别代表客户端、连接和返回结果的字符集。通常3个字符集都是相同的，保证用户写入数据正确读出。</p>
<h2 id="字符集修改步骤"><a href="#字符集修改步骤" class="headerlink" title="字符集修改步骤"></a>字符集修改步骤</h2><ol>
<li>导出表结构。mysqldump</li>
<li>修改表结构中字符集。</li>
<li>确保数据不再更新，导出所有记录。mysqlduump</li>
<li>修改导入SQL文件中的字符集。SET NAMES。</li>
<li>使用新字符集创建数据库。</li>
<li>创建表。</li>
<li>导入数据。</li>
</ol>
<h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h1><p>索引是数据库中用来提高性能的最常用工具。</p>
<h2 id="索引概述"><a href="#索引概述" class="headerlink" title="索引概述"></a>索引概述</h2><p>所用MySQL列类型都可以被索引, 对相关列使用索引是提高select操作性能的最佳途径。</p>
<h3 id="索引创建"><a href="#索引创建" class="headerlink" title="索引创建"></a>索引创建</h3><ol>
<li><p>直接创建索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">ONLINE</span>|<span class="keyword">OFFLINE</span>] [<span class="keyword">UNIQUE</span>|FULLTEXT|SPATIAL] <span class="keyword">INDEX</span> index_name</span><br><span class="line">    [index_type]</span><br><span class="line">    <span class="keyword">ON</span> tbl_name (index_col_name,...)</span><br><span class="line">    [index_option] ...</span><br><span class="line"></span><br><span class="line">index_col_name:</span><br><span class="line">    col_name [(<span class="keyword">length</span>)] [<span class="keyword">ASC</span> | <span class="keyword">DESC</span>]</span><br><span class="line"></span><br><span class="line">index_option:</span><br><span class="line">    KEY_BLOCK_SIZE [=] <span class="keyword">value</span></span><br><span class="line">    | index_type</span><br><span class="line">    | <span class="keyword">WITH</span> PARSER parser_name</span><br><span class="line">    | <span class="keyword">COMMENT</span> <span class="string">'string'</span></span><br><span class="line"></span><br><span class="line">index_type:</span><br><span class="line">    <span class="keyword">USING</span> &#123;BTREE | <span class="keyword">HASH</span>&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建/修改表创建索引</p>
</li>
</ol>
<h3 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h3><p>DROP INDEX index_name on tbl_name;</p>
<h3 id="显示索引"><a href="#显示索引" class="headerlink" title="显示索引"></a>显示索引</h3><ol>
<li>show create table tbl_name查看表结构，查看概况</li>
<li>show index from tbl_name只查看索引，查看详情</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; show create table student\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: student</span><br><span class="line"><span class="keyword">Create</span> <span class="keyword">Table</span>: <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`student`</span> (</span><br><span class="line">    <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`age`</span> <span class="built_in">int</span>(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=latin1</span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="keyword">test</span>]&gt; <span class="keyword">create</span> <span class="keyword">index</span> name_index <span class="keyword">on</span> student (<span class="keyword">name</span>(<span class="number">20</span>)) <span class="keyword">comment</span> <span class="string">"名称索引"</span>;</span><br><span class="line">Query OK, 0 rows affected (0.11 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; show create table student\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: student</span><br><span class="line"><span class="keyword">Create</span> <span class="keyword">Table</span>: <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`student`</span> (</span><br><span class="line">    <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`age`</span> <span class="built_in">int</span>(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">     <span class="keyword">KEY</span> <span class="string">`name_index`</span> (<span class="string">`name`</span>(<span class="number">20</span>)) <span class="keyword">COMMENT</span> <span class="string">'名称索引'</span></span><br><span class="line"> ) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=latin1</span><br><span class="line"> <span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="keyword">test</span>]&gt; <span class="keyword">show</span> <span class="keyword">index</span> <span class="keyword">from</span> student;</span><br><span class="line">+<span class="comment">---------+------------+------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span></span><br><span class="line">| Table   | Non_unique | Key_name   | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | <span class="keyword">Comment</span> | Index_comment |</span><br><span class="line">+<span class="comment">---------+------------+------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span></span><br><span class="line">| student |          <span class="number">1</span> | name_index |            <span class="number">1</span> | <span class="keyword">name</span>        | A         |           <span class="number">7</span> |       <span class="number">20</span> | <span class="literal">NULL</span>   | YES  | BTREE      |         | 名称索引      |</span><br><span class="line">+<span class="comment">---------+------------+------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h2 id="设计索引原则"><a href="#设计索引原则" class="headerlink" title="设计索引原则"></a>设计索引原则</h2><ol>
<li>搜索的列不一定是所要选择的列。(对where子语句或连接子句中指定的列添加索引，而不是select关键字后的列添加索引)</li>
<li>使用唯一索引。(考虑某列中值的分布。索引的列的基数越大，索引的效果越好。)</li>
<li>使用短索引。对字符串索引，应指定前缀长度。</li>
<li>利用最左前缀。</li>
<li>不要过度使用索引。(索引占用额外空间、降低写操作性能)</li>
<li>对于InnoDB存储引擎的表，系统会按照一定顺序保存，如果有明确定义的主键，则按照主键顺序保存。如果没有主键，但是有唯一索引，那么就是按照唯一索引的顺序保存。如果既没有主键又没有唯一索引，那么表中会自动生成一个内部列，按照这个列的顺序保存。按照主键或者内部列进行的访问是最快的，所以 InnoDB 表尽量自己指定主键，当表中同时有几个列都是唯一的，都可以作为主键的时候，要选择最常作为访问条件的列作为主键，提高查询的效率。另外，还需要注意，InnoDB 表的普通索引都会保存主键的键值，所以主键要尽可能选择较短的数据类型，可以有效地减少索引的磁盘占用，提高索引的缓存效果。</li>
</ol>
<h2 id="索引存储分类"><a href="#索引存储分类" class="headerlink" title="索引存储分类"></a>索引存储分类</h2><p>索引在MySQL的存储引擎层实现,而不是在服务器层实现,所以每种存储引擎的索引不一定完全相同,也不是所有的存储引擎支持所有的索引类型.<br>MySQL支持的索引:</p>
<ol>
<li>B-Tree索引:最常见的索引类型,大部分引擎都支持B数索引</li>
<li>HASH索引:只有Memory/Heap引擎支持,使用场景简单</li>
<li>R-Tree索引(空间索引):空间索引是MyISAM的一个特殊索引类型,主要用于地理空间数据类型,通常使用较少</li>
<li>Full-text(全文索引):全文索引也是MyISAM的一个特殊索引类型,主要用于全文索引,InnoDB从MySQL5.6版本开始提供对全文索引的支持</li>
</ol>
<p>MySQL目前不支持函数索引,但能对列的前面某一部分进行索引,可以大大缩小索引文件的大小,但在排序和分组操作的时候无法使用</p>
<p>HASH 索引有一些重要的特征需要在使用的时候特别注意:</p>
<ol>
<li>只用于使用=或&lt;=&gt;操作符的等式比较。</li>
<li>优化器不能使用 HASH 索引来加速 ORDER BY 操作。</li>
<li>MySQL 不能确定在两个值之间大约有多少行。如果将一个 MyISAM 表改为 HASH 索引的 MEMORY 表，会影响一些查询的执行效率。</li>
<li>只能使用整个关键字来搜索一行。</li>
</ol>
<p>对于 BTREE 索引，当使用&gt;、&lt;、>=、&lt;=、BETWEEN、!=或者&lt;>，或者 LIKE ‘pattern’(其中’pattern’不以通配符开始)操作符时，都可以使用相关列上的索引<br><strong>当对索引字段进行范围查询的时候，只有BTREE索引可以通过索引访问，而HASH索引实际上是全表扫描的</strong>。</p>
<h2 id="MySQL如何使用索引"><a href="#MySQL如何使用索引" class="headerlink" title="MySQL如何使用索引"></a>MySQL如何使用索引</h2><h3 id="MySQL中能够使用索引的经典场景"><a href="#MySQL中能够使用索引的经典场景" class="headerlink" title="MySQL中能够使用索引的经典场景"></a>MySQL中能够使用索引的经典场景</h3><ol>
<li>匹配全值,对索引中所有列都指定具体值,即是对索引中的所有列都有等值匹配的条件</li>
<li>匹配值的范围查询,对索引的值能够进行范围查找</li>
<li>匹配最左前缀,仅仅使用索引中的最左边列进行查找</li>
<li>仅仅对索引进行查询,当查询的列都在索引的字段中时,查询的效率更高</li>
<li>匹配列前缀,仅仅使用索引中的第一列,并且只包含索引第一列的开头一部分进行查询</li>
<li>能够实现索引匹配部分精确而其他部分进行范围索引</li>
<li>如果列名是索引,使用column_name is null就会使用索引</li>
<li>MySQL5.6引入Index Condition Pushdown(ICP)特性,进一步优化查询,Pushdown表示操作下放,某些情况下的条件过滤操作下放到存储引擎</li>
</ol>
<h3 id="MySQL存在索引但不能使用索引的经典场景"><a href="#MySQL存在索引但不能使用索引的经典场景" class="headerlink" title="MySQL存在索引但不能使用索引的经典场景"></a>MySQL存在索引但不能使用索引的经典场景</h3><ol>
<li>以%开头的LIKE查询不能够利用B-Tree索引,执行计划中key的值为NULL表示没有使用索引</li>
<li>数据类型中出现隐式转换的时候也不能使用索引,特别是当列类型是字符串</li>
<li>复合索引的情况下,假如查询条件不包含索引列最左部分,即不满足最左原则Leftmost,是不会使用复合索引的</li>
<li>如果MySQL估计使用索引比全表扫描慢,则不使用索引</li>
<li>用or分割的条件,如果or前面的条件中的列有索引,而后面的列中没有索引,则涉及的列都不会被使用(因为or后面的条件列中没有索引,那么后面的查询走全表扫描,在存在全表扫描的情况下,没必要多一次索引扫描增加I/O访问,一次全表扫描过滤条件就足够了)</li>
</ol>
<h2 id="查看索引使用情况"><a href="#查看索引使用情况" class="headerlink" title="查看索引使用情况"></a>查看索引使用情况</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; show status like 'Handler_read%';</span><br><span class="line">+<span class="comment">--------------------------+-------+</span></span><br><span class="line">| Variable_name            | Value |</span><br><span class="line">+<span class="comment">--------------------------+-------+</span></span><br><span class="line">| Handler_read_first       | 0     |</span><br><span class="line">| Handler_read_key         | 0     |</span><br><span class="line">| Handler_read_last        | 0     |</span><br><span class="line">| Handler_read_next        | 0     |</span><br><span class="line">| Handler_read_prev        | 0     |</span><br><span class="line">| Handler_read_rnd         | 0     |</span><br><span class="line">| Handler_read_rnd_deleted | 0     |</span><br><span class="line">| Handler_read_rnd_next    | 0     |</span><br><span class="line">+<span class="comment">--------------------------+-------+</span></span><br><span class="line">8 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>索引正在工作则Handler_read_key的值将很高,该值表示一个行被索引值读的次数,值很低表明增加索引得到的性能改善不高,因为索引并不经常使用.<br>Handler_read_rnd_next的值很高则意味着查询运行进行低效,并且应该建立索引补救.</p>
<h1 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h1><h2 id="视图简介"><a href="#视图简介" class="headerlink" title="视图简介"></a>视图简介</h2><p>视图是虚拟存在的表，对于使用视图的用户来说基本上是透明的。视图并不在数据库中实际存在，行和列数据来自定义视图的查询中使用的表，并且是在使用视图时动态生成的。<br>视图相对普通表优势：</p>
<ol>
<li>简单，使用视图的用户完全不用关心后面对应的表的结构、关联条件和筛选条件，对用户来说是已经是过滤好的符合条件的结果集。</li>
<li>安全，使用视图的用户只能访问被允许查询的结果集，对表的权限管理并不能限制到某个行某个列，但是通过视图就可以简单地实现。</li>
<li>数据独立，视图的结构确定了，可以屏蔽表结构变化对用户的影响，源表增加列对视图无影响；源表修改列名，则可以通过修改视图来解决，不会造成对访问者的影响。</li>
</ol>
<h2 id="视图操作"><a href="#视图操作" class="headerlink" title="视图操作"></a>视图操作</h2><h3 id="创建、修改视图"><a href="#创建、修改视图" class="headerlink" title="创建、修改视图"></a>创建、修改视图</h3><p>创建视图需要有CREATE VIEW的权限，对查询涉及的列有SELECT权限。<br>使用CREATE OR REPLACE 或 ALTER修改视图，需要该视图的DROP权限。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span></span><br><span class="line">    [<span class="keyword">OR</span> <span class="keyword">REPLACE</span>]</span><br><span class="line">    [ALGORITHM = &#123;UNDEFINED | <span class="keyword">MERGE</span> | TEMPTABLE&#125;]</span><br><span class="line">    [DEFINER = &#123; <span class="keyword">user</span> | <span class="keyword">CURRENT_USER</span> &#125;]</span><br><span class="line">    [<span class="keyword">SQL</span> <span class="keyword">SECURITY</span> &#123; DEFINER | INVOKER &#125;]</span><br><span class="line">    <span class="keyword">VIEW</span> view_name [(column_list)]</span><br><span class="line">    <span class="keyword">AS</span> select_statement</span><br><span class="line">    [<span class="keyword">WITH</span> [<span class="keyword">CASCADED</span> | <span class="keyword">LOCAL</span>] <span class="keyword">CHECK</span> <span class="keyword">OPTION</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span></span><br><span class="line">    [ALGORITHM = &#123;UNDEFINED | <span class="keyword">MERGE</span> | TEMPTABLE&#125;]</span><br><span class="line">    [DEFINER = &#123; <span class="keyword">user</span> | <span class="keyword">CURRENT_USER</span> &#125;]</span><br><span class="line">    [<span class="keyword">SQL</span> <span class="keyword">SECURITY</span> &#123; DEFINER | INVOKER &#125;]</span><br><span class="line">    <span class="keyword">VIEW</span> view_name [(column_list)]</span><br><span class="line">    <span class="keyword">AS</span> select_statement</span><br><span class="line">    [<span class="keyword">WITH</span> [<span class="keyword">CASCADED</span> | <span class="keyword">LOCAL</span>] <span class="keyword">CHECK</span> <span class="keyword">OPTION</span>]</span><br></pre></td></tr></table></figure>
<p>视图的可更新性和视图的定义有关系，以下类型视图是不可更新的：</p>
<ol>
<li>包含一下关键字的SQL语句：聚合函数(SUM、MIN、MAX、COUNT等)、DISTINCT、GROUP BY、HAVING、UNION或者UNION NULL</li>
<li>常量视图</li>
<li>SELECT中包含子查询</li>
<li>JION</li>
<li>FROM一个不能更新的视图</li>
<li>WHERE子句的子查询引用了FROM子句中的表</li>
</ol>
<p>[WITH [CASCADED | LOCAL] CHECK OPTION] 决定是否允许更新数据使记录不再满足视图的条件。<br>LOCAL只要满足本视图的条件就可更新。<br>CASCADED必须满足所有针对该视图的所有视图的条件才尅更新。<br>如果没有明确指定LOCAL或者CASCADED则默认为CASCADED</p>
<h3 id="删除视图"><a href="#删除视图" class="headerlink" title="删除视图"></a>删除视图</h3><p>有视图的DROP权限可一次删除一个或多个视图<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> [<span class="keyword">IF</span> <span class="keyword">EXISTS</span>] view_name [, view_name] ... [RESTRICT|<span class="keyword">CASCADE</span>];</span><br></pre></td></tr></table></figure></p>
<h3 id="查看视图定义"><a href="#查看视图定义" class="headerlink" title="查看视图定义"></a>查看视图定义</h3><ol>
<li>show tables; 查看表名也会展示视图名</li>
<li>show table status [from db_name][like ‘pattern’]; 查看表状态也会展示视图状态</li>
<li>show create iew view_name; 查看视图定义</li>
<li>select * from information_schema.views where table_name=view_name; 通过系统表information_schema.views查看视图相关信息</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.casezheng.date/2018/03/26/mysql-6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CaseZheng">
      <meta itemprop="description" content="CaseZheng的博客网站">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CaseZheng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/26/mysql-6/" class="post-title-link" itemprop="url">MySQL 存储引擎</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-26 21:45:55" itemprop="dateCreated datePublished" datetime="2018-03-26T21:45:55+08:00">2018-03-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-12 12:56:36" itemprop="dateModified" datetime="2020-04-12T12:56:36+08:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MySQL存储引擎概述"><a href="#MySQL存储引擎概述" class="headerlink" title="MySQL存储引擎概述"></a>MySQL存储引擎概述</h1><p>插入式存储引擎是MySQL数据库最重要的特性之一，用户可根据应用的需要选择如何存储和索引数据、是否使用事物等。<br>MySQL支持的引擎包括：MyISAM、InnoDB、BDB、MEMORY、MERGE、EXAMPLE、NDB Cluster、ARCHIVE、CSV、BLACKHOLE、FEDERATED等。<br>InnoDB和BDB提供事物安全表，其它引擎都是非事物安全的。</p>
<h2 id="默认存储引擎"><a href="#默认存储引擎" class="headerlink" title="默认存储引擎"></a>默认存储引擎</h2><p>默认情况下创建新表不指定表的存储引擎，则新表是默认存储引擎，设置默认存储引擎在配置文件中设置default-storage-engine<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">default-storage-engine=INNODB</span><br></pre></td></tr></table></figure></p>
<p>查看当前默认存储引擎<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; show variables like '%storage_engine%';</span><br><span class="line">+<span class="comment">------------------------+--------+</span></span><br><span class="line">| Variable_name          | Value  |</span><br><span class="line">+<span class="comment">------------------------+--------+</span></span><br><span class="line">| default_storage_engine | InnoDB |</span><br><span class="line">| storage_engine         | InnoDB |</span><br><span class="line">+<span class="comment">------------------------+--------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>查看支持的存储引擎<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ariaDB [test]&gt; show engines;</span><br><span class="line">+<span class="comment">--------------------+---------+----------------------------------------------------------------------------+--------------+------+------------+</span></span><br><span class="line">| Engine             | Support | <span class="keyword">Comment</span>                                                                    | Transactions | XA   | Savepoints |</span><br><span class="line">+<span class="comment">--------------------+---------+----------------------------------------------------------------------------+--------------+------+------------+</span></span><br><span class="line">| CSV                | YES     | CSV <span class="keyword">storage</span> <span class="keyword">engine</span>                                                         | <span class="keyword">NO</span>           | <span class="keyword">NO</span>   | <span class="keyword">NO</span>         |</span><br><span class="line">| MRG_MYISAM         | YES     | Collection <span class="keyword">of</span> identical MyISAM <span class="keyword">tables</span>                                      | <span class="keyword">NO</span>           | <span class="keyword">NO</span>   | <span class="keyword">NO</span>         |</span><br><span class="line">| <span class="keyword">MEMORY</span>             | YES     | <span class="keyword">Hash</span> based, <span class="keyword">stored</span> <span class="keyword">in</span> <span class="keyword">memory</span>, useful <span class="keyword">for</span> <span class="keyword">temporary</span> <span class="keyword">tables</span>                  | <span class="keyword">NO</span>           | <span class="keyword">NO</span>   | <span class="keyword">NO</span>         |</span><br><span class="line">| BLACKHOLE          | YES     | /dev/<span class="literal">null</span> <span class="keyword">storage</span> <span class="keyword">engine</span> (anything you write <span class="keyword">to</span> it disappears)             | <span class="keyword">NO</span>           | <span class="keyword">NO</span>   | <span class="keyword">NO</span>         |</span><br><span class="line">| MyISAM             | YES     | MyISAM <span class="keyword">storage</span> <span class="keyword">engine</span>                                                      | <span class="keyword">NO</span>           | <span class="keyword">NO</span>   | <span class="keyword">NO</span>         |</span><br><span class="line">| <span class="keyword">InnoDB</span>             | <span class="keyword">DEFAULT</span> | Percona-XtraDB, Supports transactions, <span class="keyword">row</span>-<span class="keyword">level</span> locking, <span class="keyword">and</span> <span class="keyword">foreign</span> <span class="keyword">keys</span> | YES          | YES  | YES        |</span><br><span class="line">| <span class="keyword">ARCHIVE</span>            | YES     | <span class="keyword">Archive</span> <span class="keyword">storage</span> <span class="keyword">engine</span>                                                     | <span class="keyword">NO</span>           | <span class="keyword">NO</span>   | <span class="keyword">NO</span>         |</span><br><span class="line">| FEDERATED          | YES     | FederatedX <span class="keyword">pluggable</span> <span class="keyword">storage</span> <span class="keyword">engine</span>                                        | YES          | <span class="keyword">NO</span>   | YES        |</span><br><span class="line">| PERFORMANCE_SCHEMA | YES     | <span class="keyword">Performance</span> <span class="keyword">Schema</span>                                                         | <span class="keyword">NO</span>           | <span class="keyword">NO</span>   | <span class="keyword">NO</span>         |</span><br><span class="line">| Aria               | YES     | Crash-<span class="keyword">safe</span> <span class="keyword">tables</span> <span class="keyword">with</span> MyISAM heritage                                     | <span class="keyword">NO</span>           | <span class="keyword">NO</span>   | <span class="keyword">NO</span>         |</span><br><span class="line">+<span class="comment">--------------------+---------+----------------------------------------------------------------------------+--------------+------+------------+</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<h2 id="指定存储引擎"><a href="#指定存储引擎" class="headerlink" title="指定存储引擎"></a>指定存储引擎</h2><p>创建表使用engine关键字设置新表存储引擎<br>使用alter table可以修改表的存储结构<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; create table test1(a int(10), b varchar(10));</span><br><span class="line">Query OK, 0 rows affected (0.05 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; show create table test1\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: test1</span><br><span class="line"><span class="keyword">Create</span> <span class="keyword">Table</span>: <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`test1`</span> (</span><br><span class="line">  <span class="string">`a`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`b`</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=latin1</span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="keyword">test</span>]&gt; <span class="keyword">drop</span> <span class="keyword">table</span> test1;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; create table test1(a int(10), b varchar(10))engine=MyISAM;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; show create table test1\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: test1</span><br><span class="line"><span class="keyword">Create</span> <span class="keyword">Table</span>: <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`test1`</span> (</span><br><span class="line">  <span class="string">`a`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`b`</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=MyISAM <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=latin1</span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="keyword">test</span>]&gt; <span class="keyword">alter</span> <span class="keyword">table</span> test1 <span class="keyword">engine</span>=<span class="keyword">innodb</span>;</span><br><span class="line">Query OK, 0 rows affected (0.06 sec)               </span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; show create table test1\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: test1</span><br><span class="line"><span class="keyword">Create</span> <span class="keyword">Table</span>: <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`test1`</span> (</span><br><span class="line">  <span class="string">`a`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`b`</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=latin1</span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<h1 id="各种存储引擎特性"><a href="#各种存储引擎特性" class="headerlink" title="各种存储引擎特性"></a>各种存储引擎特性</h1><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">特点</th>
<th style="text-align:center">MyISAM</th>
<th style="text-align:center">InnoDB</th>
<th style="text-align:center">MEMORY</th>
<th style="text-align:center">MERGE</th>
<th style="text-align:center">NDB</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">存储限制</td>
<td style="text-align:center">有</td>
<td style="text-align:center">64TB</td>
<td style="text-align:center">有</td>
<td style="text-align:center">没有</td>
<td style="text-align:center">有</td>
</tr>
<tr>
<td style="text-align:center">事务安全</td>
<td style="text-align:center"></td>
<td style="text-align:center">支持</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">锁机制</td>
<td style="text-align:center">表锁</td>
<td style="text-align:center">行锁</td>
<td style="text-align:center">表锁</td>
<td style="text-align:center">表锁</td>
<td style="text-align:center">行锁</td>
</tr>
<tr>
<td style="text-align:center">B树索引</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td style="text-align:center">哈希索引</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">支持</td>
<td style="text-align:center"></td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td style="text-align:center">全文索引</td>
<td style="text-align:center">支持</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">集群索引</td>
<td style="text-align:center"></td>
<td style="text-align:center">支持</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">数据缓存</td>
<td style="text-align:center"></td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center"></td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td style="text-align:center">索引缓存</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td style="text-align:center">数据可压缩</td>
<td style="text-align:center">支持</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">空间使用</td>
<td style="text-align:center">低</td>
<td style="text-align:center">高</td>
<td style="text-align:center">N/A</td>
<td style="text-align:center">低</td>
<td style="text-align:center">低</td>
</tr>
<tr>
<td style="text-align:center">内存使用</td>
<td style="text-align:center">低</td>
<td style="text-align:center">高</td>
<td style="text-align:center">中等</td>
<td style="text-align:center">低</td>
<td style="text-align:center">高</td>
</tr>
<tr>
<td style="text-align:center">批量插入的速度</td>
<td style="text-align:center">高</td>
<td style="text-align:center">低</td>
<td style="text-align:center">高</td>
<td style="text-align:center">高</td>
<td style="text-align:center">高</td>
</tr>
<tr>
<td style="text-align:center">支持外键</td>
<td style="text-align:center"></td>
<td style="text-align:center">支持</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
</div>
<h2 id="MyISAM"><a href="#MyISAM" class="headerlink" title="MyISAM"></a>MyISAM</h2><p><strong>不支持事物、不支持外键,访问速度快，对事物完整性没有要求或者以SELECT、INSERT为主的应用基本上都可以使用MyISAM引擎。</strong><br>每个MyISAM在磁盘上存储为3个文件，文件名与表名相同，扩展名不同：</p>
<ul>
<li>.frm(存储表定义)</li>
<li>.MYD(MyData,存储数据)</li>
<li>.MYI(MYIndex,存储索引)<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_187_252_centos test]<span class="comment"># cat /etc/my.cnf | grep datadir</span></span><br><span class="line">datadir=/var/lib/mysql</span><br><span class="line">[root@VM_187_252_centos test]<span class="comment"># ls /var/lib/mysql/test/ | grep test_myisam</span></span><br><span class="line">test_myisam.frm</span><br><span class="line">test_myisam.MYD</span><br><span class="line">test_myisam.MYI</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>数据文件和索引文件可以放置在不同目录，平均分布IO，获得更快速度。创建表时可通过DATA DIRECTORY和INDEX DIRECTORY指定数据文件路径和索引文件路径，文件路径使用绝对路径，且有访问权限。<br>MyISAM类型的表可能会损坏，损坏后的表可能不能访问，会提示修复或返回错误数据。<br>使用CHECK TABLE语句可以检查MyISAM表的健康，使用REPAIR TABLE可以修复损坏的MyISAM表。<br>MyISAM表支持三种不同存储格式：</p>
<ul>
<li>静态(固定长度)表 默认存储格式。静态表字段非变长字段，每个记录固定长度，<strong>存储迅速，容易缓存，出现故障容易恢复，占用空间比动态表多</strong>。静态表数据存储时按列宽补总空格，但应用访问时并不返回空格，会自动去掉。</li>
<li>动态表 包含变长字段，记录不是固定长度。占用空间少，频繁更新删除字段会产生碎片，需要定期执行OPTIMIZE TABLE或myisamchk -r命令改善性能，出现故障恢复比较困难。</li>
<li>压缩表 压缩表用myisampack工具创建，占用非常小的磁盘空间。每个记录都被单独压缩，只有非常小的访问开支。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; create table test_myisam(a char(64), b varchar(64)) engine=myisam;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; insert into test_myisam values(" abc", " abc"), ("abc ", "abc ");</span><br><span class="line">Query OK, 2 rows affected (0.00 sec)</span><br><span class="line">Records: 2  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select concat(a, "+"), concat(b, "+") from test_myisam;</span><br><span class="line">+<span class="comment">----------------+----------------+</span></span><br><span class="line">| concat(a, "+") | concat(b, "+") |</span><br><span class="line">+<span class="comment">----------------+----------------+</span></span><br><span class="line">|  abc+          |  abc+          |</span><br><span class="line">| abc+           | abc +          |</span><br><span class="line">+<span class="comment">----------------+----------------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h2><p>InnoDB存储引擎提供具有<strong>提交、回滚、崩溃恢复能力的事物安全</strong>。对比MyISAM，InnoDB写的<strong>处理效率差一点，并且会占用更多的磁盘控件保存数据和索引</strong>。</p>
<h3 id="自动增长列"><a href="#自动增长列" class="headerlink" title="自动增长列"></a>自动增长列</h3><ol>
<li>自动增长列不论插入0或NULL实际插入的都是自动增长的值。</li>
<li>可以使用ALTER TABLE ** AUTO_INCREMENT=n语句强制设置自动增长列的初始值（该强制值保存在内存中，若使用前数据库重启，该强制值会丢失，需重新设置）。</li>
<li>可使用LAST_INSERT_ID()查看当前线程最后插入记录使用的值，一次插入多条，返回第一条记录使用的自动增长列。</li>
<li>InnoDB自动增长列必须是索引。如果是组合索引，必须是组合索引第一列，对MyISAM，自动增长列可以是组合索引的其它列。</li>
</ol>
<h3 id="外键约束"><a href="#外键约束" class="headerlink" title="外键约束"></a>外键约束</h3><p>MySQL只有InnoDB支持外键约束，在创建外键时，要求父表必须有对应的索引，子表在创建外键时也会自动创建对应的索引。<br>在创建索引的时候，可以指定在删除、更新父表时，对子表进行的相应操作，包括 RESTRICT、 CASCADE、SET NULL 和 NO ACTION。<br>RESTRICT 和 NO ACTION 相同，是指限制在子表有关联记录的情况下父表不能更新；<br>CASCADE 表示父表在更新或者删除时，更新或者删除子表对应记录；<br>SET NULL 则表示父表在更新或者删除的时候，子表的对应字段被 SET NULL。<br>选择CASCADE和SET NULL两种方式的时候要谨慎，可能会因为错误的操作导致数据的丢失。<br>当某个表被其他表创建了外键参照，那么该表的对应索引或者主键禁止被删除。<br>在导入多个表的数据时，如果需要忽略表之前的导入顺序，可以暂时关闭外键的检查； 同样，在执行 LOAD DATA 和 ALTER TABLE 操作的时候，可以通过暂时关闭外键约束来加快处理的速度，关闭的命令是“SET FOREIGN_KEY_CHECKS = 0;”，执行完成之后，通过执行“SET FOREIGN_KEY_CHECKS = 1;”语句改回原状态。<br>对于 InnoDB 类型的表，外键的信息通过使用 show create table 或者 show table status 命令都可以显示。</p>
<h3 id="存储方式"><a href="#存储方式" class="headerlink" title="存储方式"></a>存储方式</h3><p>InnoDB 存储表和索引有以下两种方式。</p>
<ul>
<li>使用共享表空间存储，这种方式创建的表的表结构保存在.frm 文件中，数据和索引保存在 innodb_data_home_dir 和 innodb_data_file_path 定义的表空间中，可以是多个文件。</li>
<li>使用多表空间存储，这种方式创建的表的表结构仍然保存在.frm 文件中，但是每个表的数据和索引单独保存在.ibd 中。如果是个分区表，则每个分区对应单独的.ibd文件，文件名是“表名+分区名”，可以在创建分区的时候指定每个分区的数据文件的位置，以此来将表的 IO 均匀分布在多个磁盘上。</li>
</ul>
<p>多表空间的数据文件没有大小限制，不需要设置初始大小，也不需要设置文件的最大限制、扩展大小等参数。</p>
<h2 id="MEMORY"><a href="#MEMORY" class="headerlink" title="MEMORY"></a>MEMORY</h2><p>MEMORY 存储引擎使用存在内存中的内容来创建表。每个 MEMORY 表只实际对应一个磁盘文件，格式是.frm。MEMORY 类型的表访问非常得快，因为它的数据是放在内存中的，并且默认使用 HASH 索引，但是一旦服务关闭，表中的数据就会丢失掉。<br>给 MEMORY 表创建索引的时候，可以指定使用 HASH 索引还是 BTREE 索引。</p>
<h2 id="MERGE"><a href="#MERGE" class="headerlink" title="MERGE"></a>MERGE</h2><p>MERGE 存储引擎是一组 MyISAM 表的组合，这些 MyISAM 表必须结构完全相同，MERGE 表本身并没有数据，对 MERGE 类型的表可以进行查询、更新、删除的操作，这些操作实际上是对内部的实际的 MyISAM 表进行的。对于 MERGE 类型表的插入操作，是通过 INSERT_METHOD 子句定义插入的表，可以有 3 个不同的值，使用 FIRST 或 LAST 值使得插入操作被相应地作用在第一或最后一个表上，不定义这个子句或者定义为 NO，表示不能对这个 MERGE 表执行插入操作。<br>可以对 MERGE 表进行 DROP 操作，这个操作只是删除 MERGE 的定义，对内部的表没有任何的影响。<br>MERGE 表在磁盘上保留两个文件，文件名以表的名字开始，一个.frm 文件存储表定义，另一个.MRG 文件包含组合表的信息，包括 MERGE 表由哪些表组成、插入新的数据时的依据。<br>可以通过修改.MRG 文件来修改 MERGE 表，但是修改后要通过 FLUSH TABLES 刷新。</p>
<h1 id="合适存储引擎的选择"><a href="#合适存储引擎的选择" class="headerlink" title="合适存储引擎的选择"></a>合适存储引擎的选择</h1><ul>
<li>MyISAM：如果应用是以读操作和插入操作为主，只有很少的更新和删除操作，并且对事务的完整性、并发性要求不是很高，那么选择这个存储引擎是非常适合的。MyISAM 是在 Web、数据仓储和其他应用环境下最常使用的存储引擎<br>之一。</li>
<li>InnoDB：用于事务处理应用程序，支持外键。如果应用对事务的完整性有比较高的要求，在并发条件下要求数据的一致性，数据操作除了插入和查询以外，还包括很多的更新、删除操作，那么 InnoDB 存储引擎应该是比较合适的选择。InnoDB 存储引擎除了有效地降低由于删除和更新导致的锁定，还可以确保事务的完整提交（Commit）和回滚（Rollback），对于类似计费系统或者财务系统等对数据准确性要求比较高的系统，InnoDB 都是合适的选择。</li>
<li>MEMORY：将所有数据保存在 RAM 中，在需要快速定位记录和其他类似数据的环境下，可提供极快的访问。MEMORY 的缺陷是对表的大小有限制，太大的表无法 CACHE 在内存中，其次是要确保表的数据可以恢复，数据库异常终止后表中的数据是可以恢复的。MEMORY 表通常用于更新不太频繁的小表，用以快速得到访问结果。</li>
<li>MERGE：用于将一系列等同的 MyISAM 表以逻辑方式组合在一起，并作为一个对象引用它们。MERGE 表的优点在于可以突破对单个 MyISAM 表大小的限制，并且通过将不同的表分布在多个磁盘上，可以有效地改善MERGE表的访问效率。这对于诸如数据仓储等VLDB环境十分适合。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.casezheng.date/2018/03/24/markdown/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CaseZheng">
      <meta itemprop="description" content="CaseZheng的博客网站">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CaseZheng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/24/markdown/" class="post-title-link" itemprop="url">markdown小知识</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-24 17:24:03" itemprop="dateCreated datePublished" datetime="2018-03-24T17:24:03+08:00">2018-03-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-12 12:56:36" itemprop="dateModified" datetime="2020-04-12T12:56:36+08:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/other/" itemprop="url" rel="index"><span itemprop="name">other</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="markdown表格中显示"><a href="#markdown表格中显示" class="headerlink" title="markdown表格中显示|"></a>markdown表格中显示|</h1><p>可以使用<code>&amp;#124;</code>代替，注意某些markdown渲染器可能不支持</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.casezheng.date/2018/03/24/mysql-5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CaseZheng">
      <meta itemprop="description" content="CaseZheng的博客网站">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CaseZheng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/24/mysql-5/" class="post-title-link" itemprop="url">MySQL 运算符 常用函数</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-24 16:48:05" itemprop="dateCreated datePublished" datetime="2018-03-24T16:48:05+08:00">2018-03-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-12 12:56:36" itemprop="dateModified" datetime="2020-04-12T12:56:36+08:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h1><h2 id="算数运算符"><a href="#算数运算符" class="headerlink" title="算数运算符"></a>算数运算符</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">运算符</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">+</td>
<td style="text-align:center">加法</td>
</tr>
<tr>
<td style="text-align:center">-</td>
<td style="text-align:center">减法</td>
</tr>
<tr>
<td style="text-align:center">*</td>
<td style="text-align:center">乘法</td>
</tr>
<tr>
<td style="text-align:center">/，DIV</td>
<td style="text-align:center">除法，返回商</td>
</tr>
<tr>
<td style="text-align:center">%，MOD</td>
<td style="text-align:center">除法，返回余数</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select 1/0, 100%0, 1 div 0, MOD(100, 0), 3/2, 3 DIV 2, 3%2, mod(3, 2), 5.3/2, 5.3 DIV 2, 5.3%2, mod(5.3, 2), 5.3 mod 2;</span><br><span class="line">+------+-------+---------+-------------+--------+---------+------+-----------+---------+-----------+-------+-------------+-----------+</span><br><span class="line">| 1/0  | 100%0 | 1 div 0 | MOD(100, 0) | 3/2    | 3 DIV 2 | 3%2  | mod(3, 2) | 5.3/2   | 5.3 DIV 2 | 5.3%2 | mod(5.3, 2) | 5.3 mod 2 |</span><br><span class="line">+------+-------+---------+-------------+--------+---------+------+-----------+---------+-----------+-------+-------------+-----------+</span><br><span class="line">| NULL |  NULL |    NULL |        NULL | 1.5000 |       1 |    1 |         1 | 2.65000 |         2 |   1.3 |         1.3 |       1.3 |</span><br><span class="line">+------+-------+---------+-------------+--------+---------+------+-----------+---------+-----------+-------+-------------+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h2 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">运算符</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">=</td>
<td style="text-align:center">等于</td>
</tr>
<tr>
<td style="text-align:center"><code>&lt;&gt;</code>或!=</td>
<td style="text-align:center">不等于</td>
</tr>
<tr>
<td style="text-align:center"><code>&lt;=&gt;</code></td>
<td style="text-align:center">NULL 安全的等于(NULL-safe)</td>
</tr>
<tr>
<td style="text-align:center"><code>&lt;</code></td>
<td style="text-align:center">小于</td>
</tr>
<tr>
<td style="text-align:center"><code>&lt;=</code></td>
<td style="text-align:center">小于等于</td>
</tr>
<tr>
<td style="text-align:center">&gt;</td>
<td style="text-align:center">大于</td>
</tr>
<tr>
<td style="text-align:center">&gt;=</td>
<td style="text-align:center">大于等于</td>
</tr>
<tr>
<td style="text-align:center">BETWEEN</td>
<td style="text-align:center">存在与指定范围</td>
</tr>
<tr>
<td style="text-align:center">IN</td>
<td style="text-align:center">存在于指定集合</td>
</tr>
<tr>
<td style="text-align:center">IS NULL</td>
<td style="text-align:center">为 NULL</td>
</tr>
<tr>
<td style="text-align:center">IS NOT NULL</td>
<td style="text-align:center">不为 NULL</td>
</tr>
<tr>
<td style="text-align:center">LIKE</td>
<td style="text-align:center">通配符匹配</td>
</tr>
<tr>
<td style="text-align:center">REGEXP 或 RLIKE</td>
<td style="text-align:center">正则表达式</td>
</tr>
</tbody>
</table>
</div>
<ol>
<li>=、<code>&lt;&gt;</code>、!=不能用于NULL比较</li>
<li><code>&lt;=&gt;</code>安全的等于运算符，即使操作数为NULL也可以正确比较</li>
<li><code>BETWEEN</code>运算符的使用格式为”a BETWEEN min AND max”，当 a 大于等于 min 并且小于等于 max，则返回值为 1，否则返回 0;当操作数 a、min、max 类型相同时，此表达式等价于（<code>a&gt;=min and a&lt;=max</code>），当操作数类型不同时，比较时会遵循类型转换原则进行转换后，再进行比较运算。</li>
<li>“IN”运算符的使用格式为”a IN (value1, value2, … …)”,当 a 的值存在于列表中时，则整个比较表达式返回的值为 1，否则返回 0。</li>
<li>“IS NULL”运算符的使用格式为”a IS NULL”,当 a 的值为 NULL，则返回值为 1，否则返回 0。</li>
<li>“IS NOT NULL”运算符的使用格式为”a IS NOT NULL”。和”IS NULL”相反，当 a 的值不为 NULL，则返回值为 1，否则返回 0。 </li>
<li><strong>“LIKE”运算符的使用格式为”a LIKE %123%”,当 a 中含有字符串”123”时，则返回值为 1，否则返回 0。</strong> </li>
<li><strong>“REGEXP”运算符的使用格式为”str REGEXP str-pat”,当 str 字符串中含有 str-pat 相匹配的字符串时，则返回值为 1，否则返回 0。</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select 1=0, 1=1, NULL=NULL, 1&lt;&gt;0, 1&lt;&gt;1, NULL&lt;&gt;NULL, 1&lt;=&gt;1, 2&lt;=&gt;0, NULL&lt;=&gt;NULL;</span><br><span class="line">+<span class="comment">-----+-----+-----------+------+------+------------+-------+-------+-------------+</span></span><br><span class="line">| 1=0 | 1=1 | NULL=NULL | 1&lt;&gt;0 | 1&lt;&gt;1 | NULL&lt;&gt;NULL | 1&lt;=&gt;1 | 2&lt;=&gt;0 | NULL&lt;=&gt;NULL |</span><br><span class="line">+<span class="comment">-----+-----+-----------+------+------+------------+-------+-------+-------------+</span></span><br><span class="line">|   0 |   1 |      NULL |    1 |    0 |       NULL |     1 |     0 |           1 |</span><br><span class="line">+<span class="comment">-----+-----+-----------+------+------+------------+-------+-------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="keyword">test</span>]&gt; <span class="keyword">select</span> <span class="string">'123'</span> <span class="keyword">like</span> <span class="string">'%123%'</span>, <span class="string">'123456'</span> <span class="keyword">like</span> <span class="string">'%123%'</span>, <span class="string">'0123123'</span> <span class="keyword">like</span> <span class="string">'%123%'</span>, <span class="string">'01 23'</span> <span class="keyword">like</span> <span class="string">'%123%'</span>;</span><br><span class="line">+<span class="comment">--------------------+-----------------------+------------------------+----------------------+</span></span><br><span class="line">| '123' like '%123%' | '123456' like '%123%' | '0123123' like '%123%' | '01 23' like '%123%' |</span><br><span class="line">+<span class="comment">--------------------+-----------------------+------------------------+----------------------+</span></span><br><span class="line">|                  1 |                     1 |                      1 |                    0 |</span><br><span class="line">+<span class="comment">--------------------+-----------------------+------------------------+----------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="keyword">test</span>]&gt; <span class="keyword">select</span> <span class="string">'abcdef'</span> regexp <span class="string">'ab'</span>, <span class="string">'abcdef'</span> regexp <span class="string">'k'</span>, <span class="string">'a bcdef'</span> regexp <span class="string">'ab'</span>;</span><br><span class="line">+<span class="comment">----------------------+---------------------+-----------------------+</span></span><br><span class="line">| 'abcdef' regexp 'ab' | 'abcdef' regexp 'k' | 'a bcdef' regexp 'ab' |</span><br><span class="line">+<span class="comment">----------------------+---------------------+-----------------------+</span></span><br><span class="line">|                    1 |                   0 |                     0 |</span><br><span class="line">+<span class="comment">----------------------+---------------------+-----------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h2 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">运算符</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">NOT 或 !</td>
<td style="text-align:center">逻辑非</td>
</tr>
<tr>
<td style="text-align:center">AND 或 &amp;&amp;</td>
<td style="text-align:center">逻辑与</td>
</tr>
<tr>
<td style="text-align:center">OR 或  &#124;&#124;</td>
<td style="text-align:center">逻辑或</td>
</tr>
<tr>
<td style="text-align:center">XOR</td>
<td style="text-align:center">逻辑异或</td>
</tr>
</tbody>
</table>
</div>
<h2 id="位运算符"><a href="#位运算符" class="headerlink" title="位运算符"></a>位运算符</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">运算符</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">&amp;</td>
<td style="text-align:center">位与（位 AND）</td>
</tr>
<tr>
<td style="text-align:center">&#124;</td>
<td style="text-align:center">位或 （位 OR ）</td>
</tr>
<tr>
<td style="text-align:center">^</td>
<td style="text-align:center">位异或（位 XOR）</td>
</tr>
<tr>
<td style="text-align:center">~</td>
<td style="text-align:center">位取反</td>
</tr>
<tr>
<td style="text-align:center">&gt;&gt;</td>
<td style="text-align:center">位右移</td>
</tr>
<tr>
<td style="text-align:center">&lt;&lt;</td>
<td style="text-align:center">位左移</td>
</tr>
</tbody>
</table>
</div>
<h2 id="运算符优先级"><a href="#运算符优先级" class="headerlink" title="运算符优先级"></a>运算符优先级</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">优先级顺序</th>
<th style="text-align:center">运算符</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">:=</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">&#124;&#124; , OR, XOR</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">&amp;&amp;, AND</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">NOT</td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">BETWEEN, CASE, WHEN, THEN, ELSE</td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td style="text-align:center">=, &lt;=&gt;, &gt;=, &gt;, &lt;=, &lt;, &lt;&gt;, !=, IS, LIKE, REGEXP, IN</td>
</tr>
<tr>
<td style="text-align:center">7</td>
<td style="text-align:center">&#124;</td>
</tr>
<tr>
<td style="text-align:center">8</td>
<td style="text-align:center">&amp;</td>
</tr>
<tr>
<td style="text-align:center">9</td>
<td style="text-align:center">&lt;&lt;, &gt;&gt;</td>
</tr>
<tr>
<td style="text-align:center">10</td>
<td style="text-align:center">-, +</td>
</tr>
<tr>
<td style="text-align:center">11</td>
<td style="text-align:center">*, /, DIV, %, MOD</td>
</tr>
<tr>
<td style="text-align:center">12</td>
<td style="text-align:center">^</td>
</tr>
<tr>
<td style="text-align:center">13</td>
<td style="text-align:center">- (一元减号), ~ (一元比特反转)</td>
</tr>
<tr>
<td style="text-align:center">14</td>
<td style="text-align:center">!</td>
</tr>
</tbody>
</table>
</div>
<h1 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h1><h2 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CONCAT(S1,S2,…Sn)</td>
<td style="text-align:center">连接S1,S2,…Sn为一个字符串</td>
</tr>
<tr>
<td style="text-align:center">INSERT(str,x,y,instr)</td>
<td style="text-align:center">将字符串str从第x位置开始，y个字符长的子串替换为字符串instr</td>
</tr>
<tr>
<td style="text-align:center">LOWER(str)</td>
<td style="text-align:center">将字符串str中所有字符变为小写</td>
</tr>
<tr>
<td style="text-align:center">UPPER(str)</td>
<td style="text-align:center">将字符串str中所有字符变为大写</td>
</tr>
<tr>
<td style="text-align:center">LEFT(str,x)</td>
<td style="text-align:center">返回字符串str最左边的x个字符</td>
</tr>
<tr>
<td style="text-align:center">RIGHT(str,x)</td>
<td style="text-align:center">返回字符串str最右边的x个字符</td>
</tr>
<tr>
<td style="text-align:center">LPAD(str,n,pad)</td>
<td style="text-align:center">用字符串pad对str最左边进行填充，直到长度为n个字符长度</td>
</tr>
<tr>
<td style="text-align:center">RPAD(str,n,pad)</td>
<td style="text-align:center">用字符串pad对str最右边进行填充，直到长度为n个字符长度</td>
</tr>
<tr>
<td style="text-align:center">LTRIM(str)</td>
<td style="text-align:center">去掉字符串str左侧的空格</td>
</tr>
<tr>
<td style="text-align:center">RTRIM(str)</td>
<td style="text-align:center">去掉字符串str行尾的空格</td>
</tr>
<tr>
<td style="text-align:center">REPEAT(str,x)</td>
<td style="text-align:center">返回str重复x次的结果</td>
</tr>
<tr>
<td style="text-align:center">REPLACE(str,a,b)</td>
<td style="text-align:center">用字符串b替换字符串str中所有出现的字符串a</td>
</tr>
<tr>
<td style="text-align:center">STRCMP(s1,s2)</td>
<td style="text-align:center">比较字符串s1和s2</td>
</tr>
<tr>
<td style="text-align:center">TRIM(str)</td>
<td style="text-align:center">去掉字符串行尾和行头的空格</td>
</tr>
<tr>
<td style="text-align:center">SUBSTRING(str,x,y)</td>
<td style="text-align:center">返回从字符串strx位置起y个字符长度的字串</td>
</tr>
</tbody>
</table>
</div>
<h2 id="数值函数"><a href="#数值函数" class="headerlink" title="数值函数"></a>数值函数</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">ABS(x)</td>
<td style="text-align:center">返回x的绝对值</td>
</tr>
<tr>
<td style="text-align:center">CEIL(x)</td>
<td style="text-align:center">返回大于x的最大整数值</td>
</tr>
<tr>
<td style="text-align:center">FLOOR(x)</td>
<td style="text-align:center">返回小于x的最大整数值</td>
</tr>
<tr>
<td style="text-align:center">MOD(x，y)</td>
<td style="text-align:center">返回x/y的模</td>
</tr>
<tr>
<td style="text-align:center">RAND()</td>
<td style="text-align:center">返回0到1内的随机值</td>
</tr>
<tr>
<td style="text-align:center">ROUND(x,y)</td>
<td style="text-align:center">返回参数x的四舍五入的有y位小数的值</td>
</tr>
<tr>
<td style="text-align:center">TRUNCATE(x,y)</td>
<td style="text-align:center">返回数字x截断为y位小数的结果</td>
</tr>
</tbody>
</table>
</div>
<h2 id="日期和时间函数"><a href="#日期和时间函数" class="headerlink" title="日期和时间函数"></a>日期和时间函数</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CURDATE()</td>
<td style="text-align:center">返回当前日期</td>
</tr>
<tr>
<td style="text-align:center">CURTIME()</td>
<td style="text-align:center">返回当前时间</td>
</tr>
<tr>
<td style="text-align:center">NOW()</td>
<td style="text-align:center">返回当前的日期和时间</td>
</tr>
<tr>
<td style="text-align:center">UNIX_TIMESTAMP(date)</td>
<td style="text-align:center">返回日期date的UNIX时间戳</td>
</tr>
<tr>
<td style="text-align:center">FROM_UNIXTIME</td>
<td style="text-align:center">返回UNIX时间戳的日期值</td>
</tr>
<tr>
<td style="text-align:center">WEEK(date)</td>
<td style="text-align:center">返回日期date为一年中的第几周</td>
</tr>
<tr>
<td style="text-align:center">YEAR(date)</td>
<td style="text-align:center">返回日期date的年份</td>
</tr>
<tr>
<td style="text-align:center">HOUR(time)</td>
<td style="text-align:center">返回time的小时值</td>
</tr>
<tr>
<td style="text-align:center">MINUTE(time)</td>
<td style="text-align:center">返回time的分钟值</td>
</tr>
<tr>
<td style="text-align:center">MONTHNAME(date)</td>
<td style="text-align:center">返回date的月份名</td>
</tr>
<tr>
<td style="text-align:center">DATE_FORMAT(date,fmt)</td>
<td style="text-align:center">返回按字符串fmt格式化日期date值</td>
</tr>
<tr>
<td style="text-align:center">DATE_ADD(date,INTERVALexprtype)</td>
<td style="text-align:center">返回一个日期或时间值加上一个时间间隔的时间值</td>
</tr>
<tr>
<td style="text-align:center">DATEDIFF(expr,expr2)</td>
<td style="text-align:center">返回起始时间expr和结束时间expr2之间的天数</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; select CURDATE(), CURTIME(), NOW(), UNIX_TIMESTAMP(now()), FROM_UNIXTIME(1521907408),</span><br><span class="line">    -&gt; WEEK(now()), YEAR(now()), HOUR(CURTIME()), MINUTE(CURTIME()),  MONTHNAME(now())\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">                CURDATE(): 2018-03-25</span><br><span class="line">                CURTIME(): 00:13:13</span><br><span class="line">                    NOW(): 2018-03-25 00:13:13</span><br><span class="line">    UNIX_TIMESTAMP(now()): 1521907993</span><br><span class="line">FROM_UNIXTIME(1521907408): 2018-03-25 00:03:28</span><br><span class="line">              WEEK(now()): 12</span><br><span class="line">              YEAR(now()): 2018</span><br><span class="line">          HOUR(CURTIME()): 0</span><br><span class="line">        MINUTE(CURTIME()): 13</span><br><span class="line">         MONTHNAME(now()): March</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select DATE_FORMAT(now(),&apos;%M,%D,%Y&apos;),</span><br><span class="line">    -&gt; now() current,</span><br><span class="line">    -&gt; date_add(now(),INTERVAL 31 day) after31days,</span><br><span class="line">    -&gt; date_add(now(),INTERVAL &apos;1_2&apos; year_month) after_oneyear_twomonth,</span><br><span class="line">    -&gt; date_add(now(),INTERVAL -31 day) before31days,</span><br><span class="line">    -&gt; date_add(now(),INTERVAL &apos;-1_-2&apos; year_month) before_oneyear_twomonth\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">DATE_FORMAT(now(),&apos;%M,%D,%Y&apos;): March,25th,2018</span><br><span class="line">                      current: 2018-03-25 00:36:15</span><br><span class="line">                  after31days: 2018-04-25 00:36:15</span><br><span class="line">       after_oneyear_twomonth: 2019-05-25 00:36:15</span><br><span class="line">                 before31days: 2018-02-22 00:36:15</span><br><span class="line">      before_oneyear_twomonth: 2017-01-25 00:36:15</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h3 id="DATE-FORMAT"><a href="#DATE-FORMAT" class="headerlink" title="DATE_FORMAT"></a>DATE_FORMAT</h3><p>DATE_FORMAT(date,fmt)函数：按字符串fmt格式化日期date值，此函数能够按指定的格式显示日期</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">格式符</th>
<th style="text-align:center">格式说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">%S,%s</td>
<td style="text-align:center">两位数字形式的秒（00,01,…,59）</td>
</tr>
<tr>
<td style="text-align:center">%i</td>
<td style="text-align:center">两位数字形式的分（00,01,…,59）</td>
</tr>
<tr>
<td style="text-align:center">%H</td>
<td style="text-align:center">两位数字形式的小时，24 小时（00,01,…,23）</td>
</tr>
<tr>
<td style="text-align:center">%h,%I</td>
<td style="text-align:center">两位数字形式的小时，12 小时（01,02,…,12）</td>
</tr>
<tr>
<td style="text-align:center">%k</td>
<td style="text-align:center">数字形式的小时，24 小时（0,1,…,23）</td>
</tr>
<tr>
<td style="text-align:center">%l</td>
<td style="text-align:center">数字形式的小时，12 小时（1,2,…,12）</td>
</tr>
<tr>
<td style="text-align:center">%T</td>
<td style="text-align:center">24 小时的时间形式（hh:mm:ss）</td>
</tr>
<tr>
<td style="text-align:center">%r</td>
<td style="text-align:center">12 小时的时间形式（hh:mm:ssAM 或 hh:mm:ssPM）</td>
</tr>
<tr>
<td style="text-align:center">%p</td>
<td style="text-align:center">AM 或 PM</td>
</tr>
<tr>
<td style="text-align:center">%W</td>
<td style="text-align:center">一周中每一天的名称（Sunday,Monday,…,Saturday）</td>
</tr>
<tr>
<td style="text-align:center">%a</td>
<td style="text-align:center">一周中每一天名称的缩写（Sun,Mon,…,Sat）</td>
</tr>
<tr>
<td style="text-align:center">%d</td>
<td style="text-align:center">两位数字表示月中的天数（00,01,…,31）</td>
</tr>
<tr>
<td style="text-align:center">%e</td>
<td style="text-align:center">数字形式表示月中的天数（1,2，…,31）</td>
</tr>
<tr>
<td style="text-align:center">%D</td>
<td style="text-align:center">英文后缀表示月中的天数（1st,2nd,3rd,…）</td>
</tr>
<tr>
<td style="text-align:center">%w</td>
<td style="text-align:center">以数字形式表示周中的天数（0=Sunday,1=Monday,…,6=Saturday）</td>
</tr>
<tr>
<td style="text-align:center">%j</td>
<td style="text-align:center">以 3 位数字表示年中的天数（001,002,…,366）</td>
</tr>
<tr>
<td style="text-align:center">%U</td>
<td style="text-align:center">周（0,1,52），其中 Sunday 为周中的第一天</td>
</tr>
<tr>
<td style="text-align:center">%u</td>
<td style="text-align:center">周（0,1,52），其中 Monday 为周中的第一天</td>
</tr>
<tr>
<td style="text-align:center">%M</td>
<td style="text-align:center">月名（January,February,…,December）</td>
</tr>
<tr>
<td style="text-align:center">%b</td>
<td style="text-align:center">缩写的月名（January,February,…,December）</td>
</tr>
<tr>
<td style="text-align:center">%m</td>
<td style="text-align:center">两位数字表示的月份（01,02,…,12）</td>
</tr>
<tr>
<td style="text-align:center">%c</td>
<td style="text-align:center">数字表示的月份（1,2,…,12）</td>
</tr>
<tr>
<td style="text-align:center">%Y</td>
<td style="text-align:center">4 位数字表示的年份</td>
</tr>
<tr>
<td style="text-align:center">%y</td>
<td style="text-align:center">两位数字表示的年份</td>
</tr>
<tr>
<td style="text-align:center">%%</td>
<td style="text-align:center">直接值“%</td>
</tr>
</tbody>
</table>
</div>
<h3 id="DATE-ADD"><a href="#DATE-ADD" class="headerlink" title="DATE_ADD"></a>DATE_ADD</h3><p>DATE_ADD(date,INTERVAL expr type)函数：返回与所给日期date相差INTERVAL时间段的日期<br>其中INTERVAL是间隔类型关键字，expr是一个表达式，这个表达式对应后面的类型，type是间隔类型</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">表达式类型</th>
<th style="text-align:center">描述</th>
<th style="text-align:center">格式</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">HOUR</td>
<td style="text-align:center">小时</td>
<td style="text-align:center">hh</td>
</tr>
<tr>
<td style="text-align:center">MINUTE</td>
<td style="text-align:center">分</td>
<td style="text-align:center">mm</td>
</tr>
<tr>
<td style="text-align:center">SECOND</td>
<td style="text-align:center">秒</td>
<td style="text-align:center">ss</td>
</tr>
<tr>
<td style="text-align:center">YEAR</td>
<td style="text-align:center">年</td>
<td style="text-align:center">YY</td>
</tr>
<tr>
<td style="text-align:center">MONTH</td>
<td style="text-align:center">月</td>
<td style="text-align:center">MM</td>
</tr>
<tr>
<td style="text-align:center">DAY</td>
<td style="text-align:center">日</td>
<td style="text-align:center">DD</td>
</tr>
<tr>
<td style="text-align:center">YEAR_MONTH</td>
<td style="text-align:center">年和月</td>
<td style="text-align:center">YY-MM</td>
</tr>
<tr>
<td style="text-align:center">DAY_HOUR</td>
<td style="text-align:center">日和小时</td>
<td style="text-align:center">DD hh</td>
</tr>
<tr>
<td style="text-align:center">DAY_MINUTE</td>
<td style="text-align:center">日和分钟</td>
<td style="text-align:center">DD hh:mm</td>
</tr>
<tr>
<td style="text-align:center">DAY_SECOND</td>
<td style="text-align:center">日和秒</td>
<td style="text-align:center">DD hh:mm:ss</td>
</tr>
<tr>
<td style="text-align:center">HOUR_MINUTE</td>
<td style="text-align:center">小时和分</td>
<td style="text-align:center">hh:mm</td>
</tr>
<tr>
<td style="text-align:center">HOUR_SECOND</td>
<td style="text-align:center">小时和秒</td>
<td style="text-align:center">hh:ss</td>
</tr>
<tr>
<td style="text-align:center">MINUTE_SECOND</td>
<td style="text-align:center">分钟和秒</td>
<td style="text-align:center">mm:ss</td>
</tr>
</tbody>
</table>
</div>
<h2 id="流程函数"><a href="#流程函数" class="headerlink" title="流程函数"></a>流程函数</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">IF(value,t f)</td>
<td style="text-align:center">如果 value 是真，返回 t；否则返回 f</td>
</tr>
<tr>
<td style="text-align:center">IFNULL(value1,value2)</td>
<td style="text-align:center">如果 value1 不为空返回 value1，否则返回 value2</td>
</tr>
<tr>
<td style="text-align:center">CASE WHEN [value1] THEN[result1]…ELSE[default]END</td>
<td style="text-align:center">如果 value1 是真，返回 result1，否则返回 default</td>
</tr>
<tr>
<td style="text-align:center">CASE [expr] WHEN [value1] THEN[result1]…ELSE[default]END</td>
<td style="text-align:center">如果 expr 等于 value1，返回 result1，否则返回 default</td>
</tr>
</tbody>
</table>
</div>
<h2 id="其他常用函数"><a href="#其他常用函数" class="headerlink" title="其他常用函数"></a>其他常用函数</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">DATABASE()</td>
<td style="text-align:center">返回当前数据库名</td>
</tr>
<tr>
<td style="text-align:center">VERSION()</td>
<td style="text-align:center">返回当前数据库版本</td>
</tr>
<tr>
<td style="text-align:center">USER()</td>
<td style="text-align:center">返回当前登录用户名</td>
</tr>
<tr>
<td style="text-align:center">INET_ATON(IP)</td>
<td style="text-align:center">返回IP地址的数字表示</td>
</tr>
<tr>
<td style="text-align:center">INET_NTOA(num)</td>
<td style="text-align:center">返回数字代表的IP地址</td>
</tr>
<tr>
<td style="text-align:center">PASSWORD(str)</td>
<td style="text-align:center">返回字符串str的加密版本</td>
</tr>
<tr>
<td style="text-align:center">MD5()</td>
<td style="text-align:center">返回字符串str的MD5值</td>
</tr>
</tbody>
</table>
</div>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.casezheng.date/2018/03/22/mysql-4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CaseZheng">
      <meta itemprop="description" content="CaseZheng的博客网站">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CaseZheng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/22/mysql-4/" class="post-title-link" itemprop="url">MySQL 数据类型</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-22 22:32:57" itemprop="dateCreated datePublished" datetime="2018-03-22T22:32:57+08:00">2018-03-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-12 12:56:36" itemprop="dateModified" datetime="2020-04-12T12:56:36+08:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MySQL支持的数据类型"><a href="#MySQL支持的数据类型" class="headerlink" title="MySQL支持的数据类型"></a>MySQL支持的数据类型</h1><p>MySQL数据类型：数值型、字符串类型、日期和时间类型。</p>
<h2 id="数值类型"><a href="#数值类型" class="headerlink" title="数值类型"></a>数值类型</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">整数类型</th>
<th style="text-align:center">字节</th>
<th style="text-align:center">最小值</th>
<th style="text-align:center">最大值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">TINYINT</td>
<td style="text-align:center">1</td>
<td style="text-align:center">有符号 -128 &lt;/br&gt; 无符号 0</td>
<td style="text-align:center">有符号 127 &lt;/br&gt; 无符号 255</td>
</tr>
<tr>
<td style="text-align:center">SMALLINT</td>
<td style="text-align:center">2</td>
<td style="text-align:center">有符号 -32768 &lt;/br&gt; 无符号 0</td>
<td style="text-align:center">有符号 32767 &lt;/br&gt; 无符号 65535</td>
</tr>
<tr>
<td style="text-align:center">MEDIUMINT</td>
<td style="text-align:center">3</td>
<td style="text-align:center">有符号 -8388608 &lt;/br&gt; 无符号 0</td>
<td style="text-align:center">有符号 8388607 &lt;/br&gt; 无符号 1677215</td>
</tr>
<tr>
<td style="text-align:center">INT、INTEGER</td>
<td style="text-align:center">4</td>
<td style="text-align:center">有符号 -2147483648 &lt;/br&gt; 无符号 0</td>
<td style="text-align:center">有符号 2147483647 &lt;/br&gt; 无符号 4294967295</td>
</tr>
<tr>
<td style="text-align:center">BIGINT</td>
<td style="text-align:center">8</td>
<td style="text-align:center">有符号 -9223372036854775808 &lt;/br&gt; 无符号 0</td>
<td style="text-align:center">有符号 9223372036854775807 &lt;/br&gt; 无符号 18446744073709551615</td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">浮点数类型</th>
<th style="text-align:center">字节</th>
<th style="text-align:center">最小值</th>
<th style="text-align:center">最大值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">FLOAT</td>
<td style="text-align:center">4</td>
<td style="text-align:center">±1.175494351E-38</td>
<td style="text-align:center">±3.402823466E+38</td>
</tr>
<tr>
<td style="text-align:center">DOUBLE</td>
<td style="text-align:center">8</td>
<td style="text-align:center">±2.2250738585072014E-308</td>
<td style="text-align:center">±1.7976931348623157E+308</td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">定点数类型</th>
<th style="text-align:center">字节</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">DEC(M,D) DECIMAL(M,D)</td>
<td style="text-align:center">M+2</td>
<td style="text-align:center">最大取值范围与 DOUBLE 相同，给定 DECIMAL 的有效取值范围由M和D决定</td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">位类型</th>
<th style="text-align:center">字节</th>
<th style="text-align:center">最小值</th>
<th style="text-align:center">最大值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">BIT(M)</td>
<td style="text-align:center">1~8</td>
<td style="text-align:center">BIT(1)</td>
<td style="text-align:center">BIT(64)</td>
</tr>
</tbody>
</table>
</div>
<h3 id="整数"><a href="#整数" class="headerlink" title="整数"></a>整数</h3><p><strong>MySQL支持在类型后面的小括号内指定显示宽度,而不是占用的字节数。</strong><br>使用zerofill关键字在数字位数不够的控件用”0”填充。<br>所有整型类型有一个可选属性UNSIGNED(无符号),在字段中保存非负数或者较大上限值时可以使用此选项，其取值范围是正常值的下限取0，上限取原值的两倍。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; create table test_int(a int(5), b int(11));</span><br><span class="line">Query OK, 0 rows affected (0.09 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; insert into test_int values(1,1), (567789, 134567897531);</span><br><span class="line">Query OK, 2 rows affected, 1 warning (0.01 sec)</span><br><span class="line">Records: 2  Duplicates: 0  Warnings: 1</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from test_int;</span><br><span class="line">+--------+------------+</span><br><span class="line">| a      | b          |</span><br><span class="line">+--------+------------+</span><br><span class="line">|      1 |          1 |</span><br><span class="line">| 567789 | 2147483647 |</span><br><span class="line">+--------+------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; alter table test_int modify a int(5) zerofill;</span><br><span class="line">Query OK, 2 rows affected (0.18 sec)               </span><br><span class="line">Records: 2  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; alter table test_int modify b int zerofill;</span><br><span class="line">Query OK, 2 rows affected (0.08 sec)               </span><br><span class="line">Records: 2  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from test_int;</span><br><span class="line">+----------+------------+</span><br><span class="line">| a        | b          |</span><br><span class="line">+----------+------------+</span><br><span class="line">|    00001 | 0000000001 |</span><br><span class="line">|   567789 | 2147483647 |</span><br><span class="line">+----------+------------+</span><br><span class="line">2 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; alter table test_int modify a int(5) unsigned zerofill;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; alter table test_int modify b int(11) unsigned zerofill;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; insert into test_int values(1,1), (56457789, 1345678972531);</span><br><span class="line">Query OK, 2 rows affected, 1 warning (0.01 sec)</span><br><span class="line">Records: 2  Duplicates: 0  Warnings: 1</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from test_int;</span><br><span class="line">+----------+-------------+</span><br><span class="line">| a        | b           |</span><br><span class="line">+----------+-------------+</span><br><span class="line">|    00001 | 00000000001 |</span><br><span class="line">| 56457789 | 04294967295 |</span><br><span class="line">+----------+-------------+</span><br><span class="line">2 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure></p>
<p><strong>AUTO_INCREMENT属性，可以产生唯一标识符或顺序值, 只能用于整数类型。AUTO_INCREMENT值一般从1开始，每行增加1。一个表中最多只能有一个AUTO_INCREMENT列。对于任何想要使用AUTO_INCREMENT的列，应该定义为NOT NULL，并定义为PRIMARY KEY或定义为UNIQUE键。</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE AI (ID INT AUTO_INCREMENT NOT NULL PRIMARY KEY);</span><br><span class="line">CREATE TABLE AI(ID INT AUTO_INCREMENT NOT NULL ,PRIMARY KEY(ID));</span><br><span class="line">CREATE TABLE AI (ID INT AUTO_INCREMENT NOT NULL ,UNIQUE(ID));</span><br></pre></td></tr></table></figure></p>
<h3 id="浮点数、定点数、BIT"><a href="#浮点数、定点数、BIT" class="headerlink" title="浮点数、定点数、BIT"></a>浮点数、定点数、BIT</h3><p><strong>小数的表示：浮点数和定点数。</strong>浮点数：float、double。定点数：decimal<br><strong>定点数在MySQL内部以字符串形式存放，比浮点数更精确，适合用来存放货比等精度高的数据。</strong><br>浮点数和定点数都可以用类型名称后加”(M,D)”的方式来进行表示，”(M,D)”表示该值一共显示M位数字(整数位+小数位)，其中D位位于小数点后面，M和D又称为精度和标度。浮点数后跟”(M,D)”的方法是非标准用法，如果要用于数据库的迁移，最好不要使用。float和double不指定精度按照实际精度(由实际的硬件和操作系统决定)来表示，而decimal在不指定精度时，默认整数位为10，默认小数位为0。</p>
<ol>
<li>浮点数存在误差</li>
<li>对货币等敏感数据应该采用定点数表示或存储。</li>
<li>编程中，如果用到浮点数，注意误差问题，避免浮点数做比较，浮点数的比较最好使用范围比较，而不使用”=”比较</li>
<li>注意浮点数中一些特殊值的处理</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; show create table test_xiaoshu\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: test_xiaoshu</span><br><span class="line">Create Table: CREATE TABLE `test_xiaoshu` (</span><br><span class="line">  `a` float(5,2) DEFAULT NULL,</span><br><span class="line">  `b` double(5,2) DEFAULT NULL,</span><br><span class="line">  `c` decimal(5,2) DEFAULT NULL,</span><br><span class="line">  `d` float DEFAULT NULL,</span><br><span class="line">  `e` double DEFAULT NULL,</span><br><span class="line">  `f` decimal(10,0) DEFAULT NULL</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=latin1</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; insert into test_xiaoshu value(1.23, 1.23, 1.23, 1.23, 1.23, 1.23);</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from test_xiaoshu;</span><br><span class="line">+------+------+------+------+------+------+</span><br><span class="line">| a    | b    | c    | d    | e    | f    |</span><br><span class="line">+------+------+------+------+------+------+</span><br><span class="line">| 1.23 | 1.23 | 1.23 | 1.23 | 1.23 |    1 |</span><br><span class="line">+------+------+------+------+------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; insert into test_xiaoshu value(1.234, 1.234, 1.234, 1.234, 1.234, 1.234);</span><br><span class="line">Query OK, 1 row affected, 2 warnings (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from test_xiaoshu;</span><br><span class="line">+------+------+------+-------+-------+------+</span><br><span class="line">| a    | b    | c    | d     | e     | f    |</span><br><span class="line">+------+------+------+-------+-------+------+</span><br><span class="line">| 1.23 | 1.23 | 1.23 |  1.23 |  1.23 |    1 |</span><br><span class="line">| 1.23 | 1.23 | 1.23 | 1.234 | 1.234 |    1 |</span><br><span class="line">+------+------+------+-------+-------+------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>BIT(位类型)，用于存放位字段值，BIT(M)可以用来存放多位二进制数，M范围从1~64，如果不写默认1位。对于位类型，直接使用select命令无法看到结果，可以用bin()(二进制格式)或者hex()(十六进制格式)函数进行读取。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">MariaDB [test]&gt; desc test_bit;</span><br><span class="line">+-------+--------+------+-----+---------+-------+</span><br><span class="line">| Field | Type   | Null | Key | Default | Extra |</span><br><span class="line">+-------+--------+------+-----+---------+-------+</span><br><span class="line">| a     | bit(1) | YES  |     | NULL    |       |</span><br><span class="line">| b     | bit(2) | YES  |     | NULL    |       |</span><br><span class="line">| c     | bit(3) | YES  |     | NULL    |       |</span><br><span class="line">+-------+--------+------+-----+---------+-------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; insert into test_bit values(1, 1, 1), (2, 2, 2), (8, 8, 8);</span><br><span class="line">Query OK, 3 rows affected, 4 warnings (0.01 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 4</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select bin(a), bin(b), bin(c), hex(a), hex(b), hex(c) from test_bit;</span><br><span class="line">+--------+--------+--------+--------+--------+--------+</span><br><span class="line">| bin(a) | bin(b) | bin(c) | hex(a) | hex(b) | hex(c) |</span><br><span class="line">+--------+--------+--------+--------+--------+--------+</span><br><span class="line">| 1      | 1      | 1      | 1      | 1      | 1      |</span><br><span class="line">| 1      | 10     | 10     | 1      | 2      | 2      |</span><br><span class="line">| 1      | 11     | 111    | 1      | 3      | 7      |</span><br><span class="line">+--------+--------+--------+--------+--------+--------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<h2 id="日期时间类型"><a href="#日期时间类型" class="headerlink" title="日期时间类型"></a>日期时间类型</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">日期和时间类型</th>
<th style="text-align:center">字节</th>
<th style="text-align:center">最小值</th>
<th style="text-align:center">最大值</th>
<th style="text-align:center">零值表示</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">DATE</td>
<td style="text-align:center">4</td>
<td style="text-align:center">1000-01-01</td>
<td style="text-align:center">9999-12-31</td>
<td style="text-align:center">0000-00-00</td>
</tr>
<tr>
<td style="text-align:center">DATETIME</td>
<td style="text-align:center">8</td>
<td style="text-align:center">1000-01-01 00:00:00</td>
<td style="text-align:center">9999-12-31 23:59:59</td>
<td style="text-align:center">0000-00-00 00:00:00</td>
</tr>
<tr>
<td style="text-align:center">TIMESTAMP</td>
<td style="text-align:center">4</td>
<td style="text-align:center">19700101080001</td>
<td style="text-align:center">2038年某个时刻</td>
<td style="text-align:center">00000000000000</td>
</tr>
<tr>
<td style="text-align:center">TIME</td>
<td style="text-align:center">3</td>
<td style="text-align:center">-838:59:59</td>
<td style="text-align:center">838:59:59</td>
<td style="text-align:center">00:00:00</td>
</tr>
<tr>
<td style="text-align:center">YEAR</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1901</td>
<td style="text-align:center">2155</td>
<td style="text-align:center">0000</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>如果表示年月日，通常用DATE来表示</li>
<li>如果表示年月日时分秒，通常用DATETIME来表示</li>
<li>如果表示时分秒，通常用TIME来表示</li>
<li>如果需要经常插入或者更新日期位当前系统时间，则通常使用TIMESTAMP来表示</li>
<li>如果只表示年份，可以用YEAR来表示。</li>
</ul>
<h2 id="字符串类型"><a href="#字符串类型" class="headerlink" title="字符串类型"></a>字符串类型</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">字符串类型</th>
<th style="text-align:center">字节</th>
<th style="text-align:center">描述及存储需求</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CHAR（M）</td>
<td style="text-align:center">M</td>
<td style="text-align:center">M 为 0～255 之间的整数</td>
</tr>
<tr>
<td style="text-align:center">VARCHAR（M）</td>
<td style="text-align:center"></td>
<td style="text-align:center">M  为 0～65535 之间的整数，值的长度+1 个字节</td>
</tr>
<tr>
<td style="text-align:center">TINYBLOB</td>
<td style="text-align:center"></td>
<td style="text-align:center">允许长度 0～255 字节，值的长度+1 个字节</td>
</tr>
<tr>
<td style="text-align:center">BLOB</td>
<td style="text-align:center"></td>
<td style="text-align:center">允许长度 0～65535 字节，值的长度+2 个字节</td>
</tr>
<tr>
<td style="text-align:center">MEDIUMBLOB</td>
<td style="text-align:center"></td>
<td style="text-align:center">允许长度 0～167772150 字节，值的长度+3 个字节</td>
</tr>
<tr>
<td style="text-align:center">LONGBLOB</td>
<td style="text-align:center"></td>
<td style="text-align:center">允许长度 0～4294967295 字节，值的长度+4 个字节</td>
</tr>
<tr>
<td style="text-align:center">TINYTEXT</td>
<td style="text-align:center"></td>
<td style="text-align:center">允许长度 0～255 字节，值的长度+2 个字节</td>
</tr>
<tr>
<td style="text-align:center">TEXT</td>
<td style="text-align:center"></td>
<td style="text-align:center">允许长度 0～65535 字节，值的长度+2 个字节</td>
</tr>
<tr>
<td style="text-align:center">MEDIUMTEXT</td>
<td style="text-align:center"></td>
<td style="text-align:center">允许长度 0～167772150 字节，值的长度+3 个字节</td>
</tr>
<tr>
<td style="text-align:center">LONGTEXT</td>
<td style="text-align:center"></td>
<td style="text-align:center">允许长度 0～4294967295 字节，值的长度+4 个字节</td>
</tr>
<tr>
<td style="text-align:center">VARBINARY（M）</td>
<td style="text-align:center"></td>
<td style="text-align:center">允许长度 0～M 个字节的变长字节字符串，值的长度+1 个字节</td>
</tr>
<tr>
<td style="text-align:center">BINARY（M）</td>
<td style="text-align:center">M</td>
<td style="text-align:center">允许长度 0～M 个字节的定长字节字符串</td>
</tr>
</tbody>
</table>
</div>
<h3 id="char和varchar"><a href="#char和varchar" class="headerlink" title="char和varchar"></a>char和varchar</h3><p>char和varchar都用来存储较短的字符串。主要区别是存储方式的不同：char列的长度固定为创建表时声明的长度，长度可以为从0~255的任意值；varchar列中的值为可变长字符串。检索时char列删除末尾的空格，而varchar则保留空格。<br>对于长度变化不大并且对查询速度要求较高的数据可以考虑使用char类型存储。<br>不同存储引擎对char和varchar使用原则不同：</p>
<ol>
<li>MyISAM：建议使用固定长度的数据列代替可变长度的数据列</li>
<li>MEMORY：目前都使用固定长度的数据行处理，因为无论使用char或varchar列都没有关系，两者都是作为char类型处理</li>
<li>InnoDB：建议使用varchar。InnoDB内部的行存储格式没有区分固定长度和可变长度列（所有数据行都使用指向数据列值的头指针）。因此，使用cahr和varchar的性能差别不大，主要看空间占用大小。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; desc test_char;</span><br><span class="line">+-------+------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type       | Null | Key | Default | Extra |</span><br><span class="line">+-------+------------+------+-----+---------+-------+</span><br><span class="line">| a     | varchar(4) | YES  |     | NULL    |       |</span><br><span class="line">| b     | char(4)    | YES  |     | NULL    |       |</span><br><span class="line">+-------+------------+------+-----+---------+-------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; insert into test_char values(&quot;nnnn&quot;, &quot;nnnn&quot;), (&quot;mm&quot;, &quot;mm&quot;), (&quot;kkkkkk&quot;, &quot;kkkkk&quot;), (&quot;ee &quot;,&quot;ee &quot;), (&quot; tt&quot;, &quot; tt&quot;);</span><br><span class="line">Query OK, 5 rows affected, 2 warnings (0.03 sec)</span><br><span class="line">Records: 5  Duplicates: 0  Warnings: 2</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from test_char;</span><br><span class="line">+------+------+</span><br><span class="line">| a    | b    |</span><br><span class="line">+------+------+</span><br><span class="line">| nnnn | nnnn |</span><br><span class="line">| mm   | mm   |</span><br><span class="line">| kkkk | kkkk |</span><br><span class="line">| ee   | ee   |</span><br><span class="line">|  tt  |  tt  |</span><br><span class="line">+------+------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select concat(a, &apos;+&apos;), concat(b, &apos;+&apos;), length(a), length(b) from test_char;</span><br><span class="line">+----------------+----------------+-----------+-----------+</span><br><span class="line">| concat(a, &apos;+&apos;) | concat(b, &apos;+&apos;) | length(a) | length(b) |</span><br><span class="line">+----------------+----------------+-----------+-----------+</span><br><span class="line">| nnnn+          | nnnn+          |         4 |         4 |</span><br><span class="line">| mm+            | mm+            |         2 |         2 |</span><br><span class="line">| kkkk+          | kkkk+          |         4 |         4 |</span><br><span class="line">| ee +           | ee+            |         3 |         2 |</span><br><span class="line">|  tt+           |  tt+           |         3 |         3 |</span><br><span class="line">+----------------+----------------+-----------+-----------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h3 id="binary和varbinary类型"><a href="#binary和varbinary类型" class="headerlink" title="binary和varbinary类型"></a>binary和varbinary类型</h3><p>binary和varbinary包含二进制字符串，而不包含非二进制字符串。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; desc test_binary;</span><br><span class="line">+-------+--------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type         | Null | Key | Default | Extra |</span><br><span class="line">+-------+--------------+------+-----+---------+-------+</span><br><span class="line">| a     | binary(4)    | YES  |     | NULL    |       |</span><br><span class="line">| b     | varbinary(4) | YES  |     | NULL    |       |</span><br><span class="line">+-------+--------------+------+-----+---------+-------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; insert into test_binary values(&quot;a&quot;, &quot;a&quot;), (&quot;bbbb&quot;, &quot;bbbb&quot;), (&quot;cc  &quot;, &quot;cc  &quot;), (&quot;dddddd&quot;, &quot;ddddd&quot;);</span><br><span class="line">Query OK, 4 rows affected, 2 warnings (0.02 sec)</span><br><span class="line">Records: 4  Duplicates: 0  Warnings: 2</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select *, hex(a), hex(b), concat(a, &quot;+&quot;), concat(b, &quot;+&quot;), length(a), length(b) from test_binary;</span><br><span class="line">+------+------+----------+----------+----------------+----------------+-----------+-----------+</span><br><span class="line">| a    | b    | hex(a)   | hex(b)   | concat(a, &quot;+&quot;) | concat(b, &quot;+&quot;) | length(a) | length(b) |</span><br><span class="line">+------+------+----------+----------+----------------+----------------+-----------+-----------+</span><br><span class="line">| a    | a    | 61000000 | 61       | a   +          | a+             |         4 |         1 |</span><br><span class="line">| bbbb | bbbb | 62626262 | 62626262 | bbbb+          | bbbb+          |         4 |         4 |</span><br><span class="line">| cc   | cc   | 63632020 | 63632020 | cc  +          | cc  +          |         4 |         4 |</span><br><span class="line">| dddd | dddd | 64646464 | 64646464 | dddd+          | dddd+          |         4 |         4 |</span><br><span class="line">+------+------+----------+----------+----------------+----------------+-----------+-----------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<h3 id="text和blob"><a href="#text和blob" class="headerlink" title="text和blob"></a>text和blob</h3><p>保存较大文本时使用text或blob，blob能用来存储二进制数据，text只能保存字符数据。</p>
<ol>
<li>blob和text会引起性能问题，特别是执行大量的删除操作时。删除操作会在数据表中留下很大的”空洞”，后续插入数据插入”空洞”时，性能会有影响。可以定期使用OPTIMIZE和TABLE功能进行碎片整理，避免因为”空洞”导致性能问题。</li>
<li>可以使用合成(Synthetic)索引来提高大文本字段的查询性能。即生成散列值，然后保存在单独列中，在通过散列值查找数据(只能用于精确查找)。对大文本的模糊索引可以使用前缀索引来解决。</li>
<li>在不必要的情况下避免索引大型的blob或者text值。</li>
<li>把blob或text列分离到单独的表中。</li>
</ol>
<h3 id="ENUM类型"><a href="#ENUM类型" class="headerlink" title="ENUM类型"></a>ENUM类型</h3><p>emum枚举类型，取值范围在创建表是通过枚举方式显示指定，对1~255个成员的枚举需要1个字节存储，对于255~65535个成员需要2个字节存储。最多允许65535个成员。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; desc test_enum;</span><br><span class="line">+<span class="comment">-------+---------------+------+-----+---------+-------+</span></span><br><span class="line">| Field | Type          | Null | Key | Default | Extra |</span><br><span class="line">+<span class="comment">-------+---------------+------+-----+---------+-------+</span></span><br><span class="line">| a     | enum('A','B') | YES  |     | NULL    |       |</span><br><span class="line">+<span class="comment">-------+---------------+------+-----+---------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="keyword">test</span>]&gt; <span class="keyword">insert</span> <span class="keyword">into</span> test_enum <span class="keyword">values</span>(<span class="string">"A"</span>), (<span class="string">"b"</span>), (<span class="string">"W"</span>), (<span class="literal">NULL</span>);</span><br><span class="line">Query OK, 4 rows affected, 1 warning (0.00 sec)</span><br><span class="line">Records: 4  Duplicates: 0  Warnings: 1</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; show warnings;</span><br><span class="line">+<span class="comment">---------+------+----------------------------------------+</span></span><br><span class="line">| Level   | Code | Message                                |</span><br><span class="line">+<span class="comment">---------+------+----------------------------------------+</span></span><br><span class="line">| Warning | 1265 | Data truncated for column 'a' at row 3 |</span><br><span class="line">+<span class="comment">---------+------+----------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="keyword">test</span>]&gt; <span class="keyword">select</span> * <span class="keyword">from</span> test_enum;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| A    |</span><br><span class="line">| B    |</span><br><span class="line">|      |</span><br><span class="line">| NULL |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<p><strong>枚举类型忽略大小写</strong>。</p>
<h3 id="SET类型"><a href="#SET类型" class="headerlink" title="SET类型"></a>SET类型</h3><p>set类型也是字符串对象，里面包含0~64个成员。根据成员不同，存储上也有所不同。<br>1~8个成员的集合，占1个字节<br>9~16个成员的集合，占2个字节<br>17~24成员的集合，占3个字节<br>25~32成员的集合，占4个字节<br>33~64成员的集合，占8个字节<br>set和enum，存储不同，而且set一次可以取多个成员，enum只能选一个。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [test]&gt; desc test_set;</span><br><span class="line">+<span class="comment">-------+----------------------+------+-----+---------+-------+</span></span><br><span class="line">| Field | Type                 | Null | Key | Default | Extra |</span><br><span class="line">+<span class="comment">-------+----------------------+------+-----+---------+-------+</span></span><br><span class="line">| a     | <span class="keyword">set</span>(<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>) | YES  |     | <span class="literal">NULL</span>    |       |</span><br><span class="line">+<span class="comment">-------+----------------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [<span class="keyword">test</span>]&gt; <span class="keyword">insert</span> <span class="keyword">into</span> test_set <span class="keyword">values</span>(<span class="string">'a,b'</span>), (<span class="string">'a,b,a'</span>), (<span class="string">'a,c'</span>), (<span class="string">'a'</span>), (<span class="string">'f'</span>), (<span class="string">'a, b'</span>);</span><br><span class="line">Query OK, 6 rows affected, 2 warnings (0.03 sec)</span><br><span class="line">Records: 6  Duplicates: 0  Warnings: 2</span><br><span class="line"></span><br><span class="line">MariaDB [test]&gt; select * from test_set;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a,b  |</span><br><span class="line">| a,b  |</span><br><span class="line">| a,c  |</span><br><span class="line">| a    |</span><br><span class="line">|      |</span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>set所取成员中间不能有空格<br>set取成员中不存在的值会自动过滤掉<br>set取重复的成员只取一个</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.casezheng.date/2018/03/14/linux-2-gcc-make/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CaseZheng">
      <meta itemprop="description" content="CaseZheng的博客网站">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CaseZheng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/14/linux-2-gcc-make/" class="post-title-link" itemprop="url">linux编译链接</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-14 13:31:43" itemprop="dateCreated datePublished" datetime="2018-03-14T13:31:43+08:00">2018-03-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/基础/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="GCC简介"><a href="#GCC简介" class="headerlink" title="GCC简介"></a>GCC简介</h1><p>GCC是Linux下的编译工具集，是GNU Compiler Collection的缩写，包括gcc、g++等编译器和其它工具集。<br>GCC的C编译器为gcc，命令格式为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc [options] files ...</span><br></pre></td></tr></table></figure></p>
<p>文件扩展名含义</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">文件扩展名</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">.c</td>
<td style="text-align:center">C语言的源文件</td>
</tr>
<tr>
<td style="text-align:center">.h</td>
<td style="text-align:center">C/C++语言的头文件</td>
</tr>
<tr>
<td style="text-align:center">.hpp</td>
<td style="text-align:center">C++语言的头文件</td>
</tr>
<tr>
<td style="text-align:center">.i</td>
<td style="text-align:center">预处理后的C文件</td>
</tr>
<tr>
<td style="text-align:center">.C .cc .cxx</td>
<td style="text-align:center">C++语言的源文件</td>
</tr>
<tr>
<td style="text-align:center">.s</td>
<td style="text-align:center">汇编语言的源文件</td>
</tr>
<tr>
<td style="text-align:center">.o</td>
<td style="text-align:center">会变后的目标文件</td>
</tr>
<tr>
<td style="text-align:center">.a</td>
<td style="text-align:center">静态库</td>
</tr>
<tr>
<td style="text-align:center">.so</td>
<td style="text-align:center">动态库</td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">GCC编译命令</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">cpp</td>
<td style="text-align:center">预处理器编译器</td>
</tr>
<tr>
<td style="text-align:center">cc</td>
<td style="text-align:center">C语言编译器</td>
</tr>
<tr>
<td style="text-align:center">gcc</td>
<td style="text-align:center">C语言编译器</td>
</tr>
<tr>
<td style="text-align:center">cc1</td>
<td style="text-align:center">C语言编译器</td>
</tr>
<tr>
<td style="text-align:center">cc1plus</td>
<td style="text-align:center">C++语言编译器</td>
</tr>
<tr>
<td style="text-align:center">g++</td>
<td style="text-align:center">C++语言编译器</td>
</tr>
<tr>
<td style="text-align:center">as</td>
<td style="text-align:center">汇编器</td>
</tr>
<tr>
<td style="text-align:center">ld</td>
<td style="text-align:center">链接器</td>
</tr>
</tbody>
</table>
</div>
<p>默认搜索路径</p>
<ol>
<li>头文件 /usr/local/include  /usr/lib/gcc/  /usr/include</li>
<li>库文件 /usr/lib/gcc /lib/</li>
</ol>
<h1 id="编译程序基础"><a href="#编译程序基础" class="headerlink" title="编译程序基础"></a>编译程序基础</h1><p>GCC编译器对程序的编译分为<strong>4个阶段：预处理、编译和优化、汇编、链接</strong>。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">          预处理(cpp)        编译和优化(gcc/cc)            汇编(as)              链接(ld)</span><br><span class="line">*.c *.h ------------&gt; *.i -------------------------&gt; *.s -------------&gt; *.o -----------------&gt;  可执行文件</span><br></pre></td></tr></table></figure></p>
<h2 id="gcc选项"><a href="#gcc选项" class="headerlink" title="gcc选项"></a>gcc选项</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">选项</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">-o</td>
<td style="text-align:center">指定生成文件名</td>
</tr>
<tr>
<td style="text-align:center">-c</td>
<td style="text-align:center">生成目标文件</td>
</tr>
<tr>
<td style="text-align:center">-E</td>
<td style="text-align:center">预编译操作</td>
</tr>
<tr>
<td style="text-align:center">-S</td>
<td style="text-align:center">生成汇编代码</td>
</tr>
<tr>
<td style="text-align:center">-g</td>
<td style="text-align:center">加上调试信息</td>
</tr>
</tbody>
</table>
</div>
<h2 id="预编译"><a href="#预编译" class="headerlink" title="预编译"></a>预编译</h2><p>主要处理源代码文件中以”#”开始的预编译指令。生成.i文件。编译后的.i文件不包含任何宏定义。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ls</span><br><span class="line">main.c</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ gcc -E -o main.i main.c </span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ls</span><br><span class="line">main.c  main.i</span><br></pre></td></tr></table></figure></p>
<h2 id="编译和优化"><a href="#编译和优化" class="headerlink" title="编译和优化"></a>编译和优化</h2><p>词法分析、语法分析、语义分析、优化、生成汇编代码文件。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ls</span><br><span class="line">main.c</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ gcc -S main.c </span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ls</span><br><span class="line">main.c  main.s</span><br></pre></td></tr></table></figure></p>
<h3 id="词法分析"><a href="#词法分析" class="headerlink" title="词法分析"></a>词法分析</h3><p>词法分析使用类似于有限状态机的算法，将源代码的字符序列分割成一系列的记号。<br>词法分析产生的记号一般可以分为：关键词、标识符、字面量、特殊符号等。<br>程序lex可以实现词法扫描，按用户定义的词法规则将字符串分割为一个个记号。</p>
<h3 id="语法分析"><a href="#语法分析" class="headerlink" title="语法分析"></a>语法分析</h3><p>语法分析将词法分析产生的记号进行语法分析，产生语法树。<br>程序yacc可以完成语法分析。</p>
<h3 id="语义分析"><a href="#语义分析" class="headerlink" title="语义分析"></a>语义分析</h3><p>语义分析是对表达式的含义进行分析，编译器所能分析的时静态语义（编译期可以确定的语义），动态语义是只在运行期才能确定的语义。<br>静态语义通常包括声明和类型的匹配，类型的转换。</p>
<h3 id="源码级优化及中间代码生成"><a href="#源码级优化及中间代码生成" class="headerlink" title="源码级优化及中间代码生成"></a>源码级优化及中间代码生成</h3><p>源代码级优化器会在源代码级别进行优化。优化器将整个语法树转换成中间代码（三地址码、P-代码）</p>
<h3 id="生成汇编代码及优化"><a href="#生成汇编代码及优化" class="headerlink" title="生成汇编代码及优化"></a>生成汇编代码及优化</h3><p>源代码级优化器产生中间代码后的过程属于编译器后端。编译器后端主要包括代码生成器和目标代码优化器。<br>代码生成器将中间代码转换成目标机器代码（汇编代码）。目标代码优化器对汇编代码进行优化。</p>
<p>预编译和编译可以合并成一个步骤，对C语言预编译和编译的程序是cc1，对C++是cc1plus。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[CaseZheng@VM_187_252_centos /]$ locate cc1</span><br><span class="line">/usr/libexec/gcc/x86_64-redhat-linux/4.8.2/cc1</span><br><span class="line">/usr/libexec/gcc/x86_64-redhat-linux/4.8.2/cc1plus</span><br></pre></td></tr></table></figure></p>
<h2 id="汇编"><a href="#汇编" class="headerlink" title="汇编"></a>汇编</h2><p>将汇编代码转变成机器可执行的指令，每一个汇编语句几乎对应一条机器指令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ls</span><br><span class="line">main.c</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ gcc -c main.c </span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ls</span><br><span class="line">main.c  main.o</span><br></pre></td></tr></table></figure>
<h1 id="目标文件"><a href="#目标文件" class="headerlink" title="目标文件"></a>目标文件</h1><p>编译器编译源代码后的生成的文件叫做目标文件。目标文件从结构上讲，是已经编译后的可执行文件格式，只是还没经过链接的过程。</p>
<h2 id="目标文件格式"><a href="#目标文件格式" class="headerlink" title="目标文件格式"></a>目标文件格式</h2><p>PC平台流行的可执行文件格式主要是Windows下的PE和Linux下的ELF，都是COFF格式的变种。<br>目标文件、可执行文件、动态链接库、静态链接库都是按照可执行文件格式存储。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ file hello.o</span><br><span class="line">hello.o: ELF 64-bit LSB relocatable, x86-64, version 1 (SYSV), not stripped</span><br><span class="line"></span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ gcc -o run main.c hello.c</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ls</span><br><span class="line">hello.c  hello.o  main.c  run</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ file run</span><br><span class="line">run: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.32, BuildID[sha1]=92d675d4aed8cea8d1aeee31f3d4e901f8c57022, not stripped</span><br><span class="line"></span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ file /lib/libc-2.17.so </span><br><span class="line">/lib/libc-2.17.so: ELF 32-bit LSB shared object, Intel 80386, version 1 (GNU/Linux), dynamically linked (uses shared libs), BuildID[sha1]=efcb4322c3353d41309c104563110b0c238bbc51, for GNU/Linux 2.6.32, not stripped</span><br></pre></td></tr></table></figure></p>
<h2 id="目标文件内容"><a href="#目标文件内容" class="headerlink" title="目标文件内容"></a>目标文件内容</h2><p>目标文件将指令代码、数据、链接所需信息以”节”(“段”)的形式存储。<br><strong>ELF文件开头是文件头，描述了整个文件的文件属性</strong>，包括文件是否可执行、是静态链接还是动态链接等信息，文件头还包括一个<strong>段表</strong>，段表时一个描述文件中各个段的数据。<strong>段表描述了文件中的偏移位置及段的属性等，从段表中可以得到段的所有信息</strong>。文件头后面就是各个段的内容。<br>程序源代码编译后的机器指令经常放在代码段(.code/.text)<br><strong>已初始化的全局变量和局部静态变量放在.data段</strong>。<br><strong>未初始化的全局变量和局部静态变量放在.bss段</strong>。因为未初始化的全局变量和局部静态变量默认值都是0，在.data段分配空间存储0是没有必要的。<strong>.bss段只是为未初始化的全局变量和局部静态变量预留位置而已</strong>，并没有内容，在文件中不占据空间。<br>.rodata段存放只读数据，一般是程序里面的只读变量和字符串常量。<br>.comment段存放编译器版本信息<br>.debug段调试信息<br>.hash段符号哈希表<br>.line段调试时的行号表，即源代码行号与编译后指令的对应表<br>.strtab段字符串表，存储ELF文件用到的各种字符串<br>.symtab段符号表<br>.shstrtab段段名表<br>.plt .got动态链接的跳转表和全局入口表<br>.init .fini程序初始化与终结代码段<br>总体来说，<strong>程序源代码被编译后主要分两种段：程序指令和程序数据。代码段属于程序指令，而数据段和.bss段属于程序数据</strong>。<br>程序指令和程序数据分开存储的好处：</p>
<ol>
<li>安全，程序加载后程序指令只读、程序数据读写</li>
<li>利于缓存，提高CPU的缓存命中率</li>
<li>共享指令，节省内存</li>
</ol>
<h2 id="目标文件结构"><a href="#目标文件结构" class="headerlink" title="目标文件结构"></a>目标文件结构</h2><ol>
<li>文件头定义了ELF魔数、文件机器字节长度、数据存储方式、版本、运行平台、ABI版本、ELF重定位类型、硬件平台、硬件平台版本、入口地址、程序头入口和长度、段表的位置和长度及段的数量等。</li>
<li>段表是保存各个段的基本属性的结构，描述各个段的信息。ELF文件的段结构由段表决定、编译器、连接器和装载器都是依靠段表来定位和访问各个段的属性的。</li>
<li>重定位表(.rel.text/.rel.data)链接器在处理目标文件时需要对某些部位进行重定位，这些重定位信息都记录在ELF文件的重定位表中。</li>
<li>字符串表.strtab保存普通字符串。</li>
<li>段名字符串表.shstrtab保存短表中用到的字符串。</li>
<li>符号表.symtab记录了目标文件中所用到的所有符号。每个定义的符号有一个对应的值，叫做符号值。对变量和函数，符号值就是它们的地址。</li>
<li>特殊符号<ul>
<li>__executable_start 程序起始地址，不是入口地址，是程序最开始的地址</li>
<li>__extext或_extext或extext代码段结束地址，即代码段最末尾的地址</li>
<li>_edata或edata数据段结束地址，即数据段最末尾的地址</li>
<li>_end或end程序结束地址</li>
</ul>
</li>
</ol>
<h2 id="符号修饰与函数签名"><a href="#符号修饰与函数签名" class="headerlink" title="符号修饰与函数签名"></a>符号修饰与函数签名</h2><p>函数签名包含了一个函数的信息，包括函数名、参数类型、所在类、所在名字空间等信息<br>编译器及链接器处理符号时，使用某种那个名称修饰方法，使每个函数签名对应一个修饰后的名称<br>C++编译器会将在extern “C”的大括号内部的代码当作C语言处理。</p>
<h2 id="静态链接"><a href="#静态链接" class="headerlink" title="静态链接"></a>静态链接</h2><p>链接的主要内容是将各个目标代码之间相互引用的部分都处理好，使各个模块之间能够正确的衔接。<br>链接过程包括地址和空间分配、符号决议、重定位等步骤。<br>运行时库是支持程序运行的基本函数的集合。库其实是一组目标文件的包。<br>各个目标文件独立编译，变量及函数地址不能独立确定，需要在链接过程中修正，使其指向正确的地址，这个过程叫重定位，每个要修正的地方叫重定位入口。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ls</span><br><span class="line">main.c</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ gcc -o run main.c </span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ls</span><br><span class="line">main.c  run</span><br></pre></td></tr></table></figure>
<h3 id="相似段合并"><a href="#相似段合并" class="headerlink" title="相似段合并"></a>相似段合并</h3><p>链接器为目标文件分配地址和空间，其中地址和空间有两个含义：1.输出的可执行文件中的空间；2.装载的虚拟地址中的虚拟地址空间。<br>虚拟地址空间分配关系到链接器关于地址的计算，而可执行文件本身的空间分配与链接过程关系并不大。</p>
<ol>
<li>空间与地址分配 扫描所有输入目标文件，获取各个段长度、属性、位置，将目标文件符号表中符号定义和符号引用收集起来，统一放在全局符号表。链接器根据收集的信息合并各个段，计算文件文件中各个段合并后的长度与位置，并建立映射关系。</li>
<li>符号解析与重定位 使用空间与地址分配收集的信息，读取文件中段的数据、重定位信息，并进行符号解析和重定位、调整代码中的地址。</li>
</ol>
<h1 id="动态链接"><a href="#动态链接" class="headerlink" title="动态链接"></a>动态链接</h1><p>静态链接缺点</p>
<ol>
<li>浪费内存和磁盘空间</li>
<li>模块更新困难</li>
</ol>
<p><strong>动态链接：不对组成程序的目标文件进行链接，等程序运行时才进行链接，即将链接过程推迟到运行时再进行</strong>。<br>Linux系统中，ELF动态连接文件被称为<strong>动态共享对象（共享对象）</strong>，一般都以”.so”为扩展名。Windos中称为动态链接库，一般以”.dll”为扩展名。<br><strong>共享对象在编译时不能假设自己在进程虚拟地址控件中的位置</strong>。</p>
<h2 id="装载时重定位"><a href="#装载时重定位" class="headerlink" title="装载时重定位"></a>装载时重定位</h2><p>Linux和GCC支持装载时重定位的方法，在产生共享对象是<strong>不使用’-fPIC’，只使用’-shared’参数，输出的共享对象就是使用装载时重定位的方法</strong>。</p>
<h2 id="地址无关代码"><a href="#地址无关代码" class="headerlink" title="地址无关代码"></a>地址无关代码</h2><p>装载时重定位是解决动态模块中的办法之一，但其指令部分不能在多个进程间共享，失去了动态连接节省内存的一大优势。</p>
<ol>
<li>模块内部调用或跳转 模块内相对位置固定，通过相对地址调用</li>
<li>模块内部数据访问 相对寻址</li>
<li>模块间数据访问 ELF在数据段建立一个指向其它模块变量的指针数组（全局偏移表GOT），当代码需要引用该全局变量时，通过GOT中的相对应的项间接引用。</li>
<li>模块间调用、跳转 建立全局偏移表GOT，保存目标函数的地址。</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">指令跳转、调用</th>
<th style="text-align:center">数据访问</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">模块内部</td>
<td style="text-align:center">1.相对跳转和调用</td>
<td style="text-align:center">2.相对地址访问</td>
</tr>
<tr>
<td style="text-align:center">模块外部</td>
<td style="text-align:center">3.间接跳转和调用</td>
<td style="text-align:center">4.间接访问</td>
</tr>
</tbody>
</table>
</div>
<p>‘-fpic’和’-fPIC’功能相同都是生成地址无关代码，但’-fPIC’生成的代码要大一点，’-fpic’生成代码小，不过’-fpic’在某些平台上会有一些限制，而’-fPIC’则不存在。</p>
<h2 id="延迟绑定"><a href="#延迟绑定" class="headerlink" title="延迟绑定"></a>延迟绑定</h2><p>延迟绑定：函数第一次被使用时才进行绑定。</p>
<h2 id="“-interp”段"><a href="#“-interp”段" class="headerlink" title="“.interp”段"></a>“.interp”段</h2><p>动态链接器的位置不是由系统配置指定，也不是由环境参数决定，而是由ELF可执行文件决定。<strong>“.interp”段保存的一个字符串就是可执行文件所需要的动态链接器的路径</strong>。</p>
<h2 id="“-dynamic”段"><a href="#“-dynamic”段" class="headerlink" title="“.dynamic”段"></a>“.dynamic”段</h2><p>“.dynamic”段保存了动态链接器所需要的基本信息（依赖的共享库、动态链接符号表位置、动态连接重定向表的位置、共享对象初始化代码的地址等）。<br>ldd命令可以查看一个程序或共享库依赖哪些共享库。</p>
<h2 id="动态符号表"><a href="#动态符号表" class="headerlink" title="动态符号表"></a>动态符号表</h2><p>“.dynsym”</p>
<h2 id="动态链接重定向表"><a href="#动态链接重定向表" class="headerlink" title="动态链接重定向表"></a>动态链接重定向表</h2><p>静态链接中”.rel.text”代码段重定位表 “.rel.data”数据段重定位表<br>动态链接中”.rel.dyn”对数据引用的修正 “.rel.plt”对函数引用的修正，它所修正的位置位于”.got.plt”</p>
<h1 id="静态链接库"><a href="#静态链接库" class="headerlink" title="静态链接库"></a>静态链接库</h1><p>静态链接库通常以”.a”为后缀，由程序ar生成。<br>静态链接库优点</p>
<ol>
<li>不需要重新编译程序库代码，就可进行程序的重新链接，节省编译时间。</li>
<li>提供库文件给使用人员，不需要开放源代码。</li>
<li>静态库执行速度比共享库和动态库要快。</li>
</ol>
<h2 id="静态链接库生成"><a href="#静态链接库生成" class="headerlink" title="静态链接库生成"></a>静态链接库生成</h2><ol>
<li>生成目标文件</li>
<li>用ar工具对目标文件归档。</li>
</ol>
<p>ar的-r选项，可以创建库，并把目标文件插入指定库中。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ls</span><br><span class="line">hello.c</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ gcc -c hello.c </span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ls</span><br><span class="line">hello.c  hello.o</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ar -rcs libhello.a hello.o</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ls</span><br><span class="line">hello.c  hello.o  libhello.a</span><br></pre></td></tr></table></figure></p>
<h2 id="使用静态链接库"><a href="#使用静态链接库" class="headerlink" title="使用静态链接库"></a>使用静态链接库</h2><ol>
<li>和使用目标文件一致</li>
<li>使用”-l库名”使用，库名是不包含函数库和扩展名的字符串。</li>
</ol>
<p>使用”-L”显式指定搜索库的路径。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ rm run </span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ls</span><br><span class="line">hello.c  hello.o  libhello.a  main.c</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ gcc -o run main.c libhello.a </span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ls</span><br><span class="line">hello.c  hello.o  libhello.a  main.c  run</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ./run </span><br><span class="line">hello</span><br><span class="line"></span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ rm run </span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ls</span><br><span class="line">hello.c  hello.o  libhello.a  main.c</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ gcc -o run main.c -L./ -lhello</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ls</span><br><span class="line">hello.c  hello.o  libhello.a  main.c  run</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ./run </span><br><span class="line">hello</span><br></pre></td></tr></table></figure>
<h2 id="检查包的正确性"><a href="#检查包的正确性" class="headerlink" title="检查包的正确性"></a>检查包的正确性</h2><p>如果碰到<code>error adding symbols: Archive has no index; run ranlib to add one</code>可以使用<code>ar -t</code>检查打包的正确性<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ar -t libhello.a</span><br><span class="line">hello.o</span><br></pre></td></tr></table></figure></p>
<p>确认无误的话在使用file查看被打包文件类型<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ file hello.o</span><br><span class="line">hello.o: ELF 64-bit LSB relocatable, x86-64, version 1 (SYSV), not stripped</span><br></pre></td></tr></table></figure></p>
<p>文件类型没问题再使用nm导出符号检查<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ nm hello.o</span><br><span class="line">                 U puts</span><br><span class="line">0000000000000000 T _Z11print_hellov</span><br></pre></td></tr></table></figure></p>
<h1 id="动态链接库"><a href="#动态链接库" class="headerlink" title="动态链接库"></a>动态链接库</h1><h2 id="生成动态链接库"><a href="#生成动态链接库" class="headerlink" title="生成动态链接库"></a>生成动态链接库</h2><p>使用-fPIC或-fpic选项使gcc生成动态链接库。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ cat hello.h</span><br><span class="line">#ifndef _HELLO_H_</span><br><span class="line">#define _HELLO_H_</span><br><span class="line"></span><br><span class="line">void print_hello();</span><br><span class="line"></span><br><span class="line">#endif</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ cat hello.cpp </span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &quot;hello.h&quot;</span><br><span class="line"></span><br><span class="line">void print_hello()</span><br><span class="line">&#123;</span><br><span class="line">    printf(&quot;hello\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ g++ -fPIC -shared -o libhello.so.1.0.0 hello.cpp hello.h</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ln -s libhello.so.1.0.0 libhello.so</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ls</span><br><span class="line">hello.cpp  hello.h  libhello.so  libhello.so.1.0.0  main.cpp</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ g++ -o run main.cpp hello.h -L./ -lhello</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ./run </span><br><span class="line">./run: error while loading shared libraries: libhello.so: cannot open shared object file: No such file or directory</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ldd ./run </span><br><span class="line">	linux-vdso.so.1 =&gt;  (0x00007ffc6fb99000)</span><br><span class="line">	libhello.so =&gt; not found</span><br><span class="line">	libstdc++.so.6 =&gt; /lib64/libstdc++.so.6 (0x00007f35af31c000)</span><br><span class="line">	libm.so.6 =&gt; /lib64/libm.so.6 (0x00007f35af01a000)</span><br><span class="line">	libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007f35aee04000)</span><br><span class="line">	libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f35aea37000)</span><br><span class="line">	/lib64/ld-linux-x86-64.so.2 (0x00007f35af623000)</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ sudo vim /etc/ld.so.conf</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ cat /etc/ld.so.conf</span><br><span class="line">include ld.so.conf.d/*.conf</span><br><span class="line">/usr/local/lib</span><br><span class="line">.</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ sudo ldconfig</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ldd ./run </span><br><span class="line">	linux-vdso.so.1 =&gt;  (0x00007ffc251b6000)</span><br><span class="line">	libhello.so =&gt; ./libhello.so (0x00007fcc32399000)</span><br><span class="line">	libstdc++.so.6 =&gt; /lib64/libstdc++.so.6 (0x00007fcc32092000)</span><br><span class="line">	libm.so.6 =&gt; /lib64/libm.so.6 (0x00007fcc31d90000)</span><br><span class="line">	libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007fcc31b7a000)</span><br><span class="line">	libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fcc317ad000)</span><br><span class="line">	/lib64/ld-linux-x86-64.so.2 (0x00007fcc3259b000)</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ./run </span><br><span class="line">hello</span><br></pre></td></tr></table></figure></p>
<h2 id="Wl-soname编译选项"><a href="#Wl-soname编译选项" class="headerlink" title="-Wl,-soname编译选项"></a>-Wl,-soname编译选项</h2><p>-Wl选项告知编译器将后面的参数传递给链接器.<br>-soname指定动态库的soname(简单共享名,Short for shared object name)</p>
<p>利用soname可以提供动态库的兼容性,当升级一个库时新库和旧库兼容,则可以直接使用相同的soname,如果不兼容换个新的soname则不会影响旧库链接生成的程序.使得升级动态库变的容易.</p>
<p>可以通过readelf -d查看动态库的soname<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[CaseZheng@VM_187_252_centos ~]$ readelf -d /usr/lib/libz.so.1.2.7 </span><br><span class="line">......</span><br><span class="line">  0x0000000e (SONAME)                     Library soname: [libz.so.1]</span><br><span class="line">......</span><br></pre></td></tr></table></figure></p>
<p>可以看到前面的动态库链接后libhello.so链接到libhello.so,当新的动态库不兼容旧的动态库时就会影响到旧库链接生成的程序,而指定soname后链接到libhello.so.1.0.0,动态库升级后不会影响到旧库链接生成的程序<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ldd ./run </span><br><span class="line">	linux-vdso.so.1 =&gt;  (0x00007ffee638a000)</span><br><span class="line">	libhello.so =&gt; ./libhello.so (0x00007fa8c214f000)</span><br><span class="line">	libstdc++.so.6 =&gt; /lib64/libstdc++.so.6 (0x00007fa8c1e48000)</span><br><span class="line">	libm.so.6 =&gt; /lib64/libm.so.6 (0x00007fa8c1b46000)</span><br><span class="line">	libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007fa8c1930000)</span><br><span class="line">	libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fa8c1563000)</span><br><span class="line">	/lib64/ld-linux-x86-64.so.2 (0x00007fa8c2351000)</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ g++ -fPIC -shared -Wl,-soname,libhello.so.1.0.0 -o libhello.so.1.0.0 hello.cpp hello.h</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ g++ -o run main.cpp hello.h -L./ -lhello</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ./run </span><br><span class="line">hello</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ldd ./run </span><br><span class="line">	linux-vdso.so.1 =&gt;  (0x00007ffc921b7000)</span><br><span class="line">	libhello.so.1.0.0 =&gt; ./libhello.so.1.0.0 (0x00007fc55f726000)</span><br><span class="line">	libstdc++.so.6 =&gt; /lib64/libstdc++.so.6 (0x00007fc55f41f000)</span><br><span class="line">	libm.so.6 =&gt; /lib64/libm.so.6 (0x00007fc55f11d000)</span><br><span class="line">	libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007fc55ef07000)</span><br><span class="line">	libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fc55eb3a000)</span><br><span class="line">	/lib64/ld-linux-x86-64.so.2 (0x00007fc55f928000)</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ readelf -d libhello.so.1.0.0 </span><br><span class="line">......</span><br><span class="line">    0x000000000000000e (SONAME)             Library soname: [libhello.so.1.0.0]</span><br><span class="line">......</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ readelf -d libhello.so</span><br><span class="line">......</span><br><span class="line">    0x000000000000000e (SONAME)             Library soname: [libhello.so.1.0.0]</span><br><span class="line">......</span><br></pre></td></tr></table></figure></p>
<p>还可以兼容版本使用同一个soname,当有新的不兼容版本时再更换soname</p>
<h2 id="优先使用静态链接的方法"><a href="#优先使用静态链接的方法" class="headerlink" title="优先使用静态链接的方法"></a>优先使用静态链接的方法</h2><p>使用动态库的不便之处在于服务部署环境必须安装了该动态库,且版本必须一致或兼容,否则程序无法运行,而静态库则不存在这个问题,当既有动态库,又有静态库时程序默认优先使用动态库,使用<code>-Wl,-Bstatic</code>可以指定优先使用静态库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ g++ -o run main.cpp hello.h -L./ -lhello</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ./run </span><br><span class="line">hello</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ls</span><br><span class="line">hello.cpp  hello.h  libhello.so  libhello.so.1.0.0  main.cpp  run</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ldd ./run </span><br><span class="line">	linux-vdso.so.1 =&gt;  (0x00007ffc20f4f000)</span><br><span class="line">	libhello.so.1.0.0 =&gt; ./libhello.so.1.0.0 (0x00007f9025501000)</span><br><span class="line">	libstdc++.so.6 =&gt; /lib64/libstdc++.so.6 (0x00007f90251fa000)</span><br><span class="line">	libm.so.6 =&gt; /lib64/libm.so.6 (0x00007f9024ef8000)</span><br><span class="line">	libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007f9024ce2000)</span><br><span class="line">	libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f9024915000)</span><br><span class="line">	/lib64/ld-linux-x86-64.so.2 (0x00007f9025703000)</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ g++ -c hello.cpp -o hello.o</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ar -rcs libhello.a hello.o</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ g++ -o run main.cpp hello.h -Wl,-Bstatic -L./ -lhello</span><br><span class="line">/usr/bin/ld: cannot find -lstdc++</span><br><span class="line">/usr/bin/ld: cannot find -lgcc_s</span><br><span class="line">/usr/bin/ld: cannot find -lgcc_s</span><br><span class="line">collect2: error: ld returned 1 exit status</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ g++ -o run main.cpp hello.h -L./ -Wl,-Bstatic -lhello</span><br><span class="line">/usr/bin/ld: cannot find -lstdc++</span><br><span class="line">/usr/bin/ld: cannot find -lgcc_s</span><br><span class="line">/usr/bin/ld: cannot find -lgcc_s</span><br><span class="line">collect2: error: ld returned 1 exit status</span><br></pre></td></tr></table></figure></p>
<p>找不到库是因为指定<code>-Wl,-Bstatic</code>后所有库都强制使用了静态库导致的,添加<code>-Wl,-Bdynamic</code>让别的库可以使用动态库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ g++ -o run main.cpp hello.h -L./ -Wl,-Bstatic -lhello -Wl,-Bdynamic</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ./run </span><br><span class="line">hello</span><br><span class="line">[CaseZheng@VM_187_252_centos Tmp]$ ldd ./run </span><br><span class="line">	linux-vdso.so.1 =&gt;  (0x00007ffcf61cf000)</span><br><span class="line">	libstdc++.so.6 =&gt; /lib64/libstdc++.so.6 (0x00007fa076f64000)</span><br><span class="line">	libm.so.6 =&gt; /lib64/libm.so.6 (0x00007fa076c62000)</span><br><span class="line">	libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007fa076a4c000)</span><br><span class="line">	libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fa07667f000)</span><br><span class="line">	/lib64/ld-linux-x86-64.so.2 (0x00007fa07726b000)</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="CaseZheng"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">CaseZheng</p>
  <div class="site-description" itemprop="description">CaseZheng的博客网站</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">130</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/CaseZheng" title="GitHub → https://github.com/CaseZheng" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:764307915@qq.com" title="E-Mail → mailto:764307915@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2017 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CaseZheng</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">717k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">10:52</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  <script src="/js/local-search.js"></script>












  

  

</body>
</html>
