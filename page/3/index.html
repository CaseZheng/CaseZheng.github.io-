<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="msvalidate.01" content="F14AAB2D4C842CB9F200D0A80DA8CB2F">
  <meta name="baidu-site-verification" content="GNlbaIvRtqlfiBfg">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.casezheng.date","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="CaseZheng的博客网站">
<meta property="og:type" content="website">
<meta property="og:title" content="CaseZheng">
<meta property="og:url" content="http://www.casezheng.date/page/3/index.html">
<meta property="og:site_name" content="CaseZheng">
<meta property="og:description" content="CaseZheng的博客网站">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CaseZheng">
<meta name="twitter:description" content="CaseZheng的博客网站">

<link rel="canonical" href="http://www.casezheng.date/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>CaseZheng</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?4f1686055a927fa7bf1a09bc1143b57c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">CaseZheng</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">CaseZheng Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.casezheng.date/2018/11/16/centos-multiple-gcc-version/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CaseZheng">
      <meta itemprop="description" content="CaseZheng的博客网站">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CaseZheng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/16/centos-multiple-gcc-version/" class="post-title-link" itemprop="url">centos安装多个gcc版本</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-16 12:57:27" itemprop="dateCreated datePublished" datetime="2018-11-16T12:57:27+08:00">2018-11-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/other/" itemprop="url" rel="index"><span itemprop="name">other</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="centos下多个gcc版本的安装方法和切换"><a href="#centos下多个gcc版本的安装方法和切换" class="headerlink" title="centos下多个gcc版本的安装方法和切换"></a>centos下多个gcc版本的安装方法和切换</h1><h2 id="安装scl发布源"><a href="#安装scl发布源" class="headerlink" title="安装scl发布源"></a>安装scl发布源</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install centos-release-scl-rh</span><br></pre></td></tr></table></figure>
<h2 id="安装gcc和gcc-c"><a href="#安装gcc和gcc-c" class="headerlink" title="安装gcc和gcc-c++"></a>安装gcc和gcc-c++</h2><p>devtoolset中有多个gcc版本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[CaseZheng@Test ~]$ yum search devtoolset- | grep gcc-c++</span><br><span class="line">devtoolset-6-gcc-c++.x86_64 : C++ support for GCC version 6</span><br><span class="line">devtoolset-7-gcc-c++.x86_64 : C++ support for GCC version 7</span><br></pre></td></tr></table></figure></p>
<p>安装devtoolset-6-*如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install devtoolset-6-gcc devtoolset-6-gcc-c++ devtoolset-6-gdb devtoolset-6-libstdc++-devel</span><br></pre></td></tr></table></figure></p>
<p>devtoolset-*中还有别的工具,可以根据需要安装</p>
<h2 id="启用安装的gcc版本"><a href="#启用安装的gcc版本" class="headerlink" title="启用安装的gcc版本"></a>启用安装的gcc版本</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[CaseZheng@Test ~]$ gcc --version | grep GCC</span><br><span class="line">gcc (GCC) 4.4.7 20120313 (Red Hat 4.4.7-23)</span><br></pre></td></tr></table></figure>
<p>使用<code>source /opt/rh/devtoolset-6/enable</code>启用, 如果安装的devtoolset-7-*则使用<code>source /opt/rh/devtoolset-7/enable</code>,依次类推<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[CaseZheng@Test ~]$ gcc --version | grep GCC</span><br><span class="line">gcc (GCC) 6.3.1 20170216 (Red Hat 6.3.1-3)</span><br></pre></td></tr></table></figure></p>
<p>使用这种方法只对当前会话有效,如果想每次新开会话都生效可以将<code>source /opt/rh/devtoolset-6/enable</code>加入到<code>~/.bashrc</code>,加入后<code>source ~/.bashrc</code>生效<br>如果想全局生效可以将<code>source /opt/rh/devtoolset-6/enable</code>加入到<code>/etc/bashrc</code>,加入后执行下<code>source /etc/bashrc</code>生效</p>
<h1 id="Software-Collections介绍"><a href="#Software-Collections介绍" class="headerlink" title="Software Collections介绍"></a>Software Collections介绍</h1><p>Software Collections 是 Red Hat 唯一支持的新软件包源. Software Collections 为 CentOS 设立了专门的仓库,安装和管理都和其它第三方仓库一样. centos-release-scl 里有一些由社区维护的额外的软件包</p>
<p>安装 Software Collections<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install centos-release-scl centos-release-scl-rh</span><br></pre></td></tr></table></figure></p>
<p>SCL的默认关闭,启用使用<code>source /opt/rh/devtoolset-7/enable</code>,参考启用安装的gcc版本</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="https://www.centoschina.cn/course/install/10408.html" target="_blank" rel="noopener">CentOS 6&amp;7 安装使用多个GCC版本（GCC4.9，GCC5.3，GCC6.2） </a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.casezheng.date/2018/10/26/kafka/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CaseZheng">
      <meta itemprop="description" content="CaseZheng的博客网站">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CaseZheng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/10/26/kafka/" class="post-title-link" itemprop="url">Kafka介绍与实践</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-10-26 21:43:10" itemprop="dateCreated datePublished" datetime="2018-10-26T21:43:10+08:00">2018-10-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/高性能服务器/" itemprop="url" rel="index"><span itemprop="name">高性能服务器</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="kafka安装"><a href="#kafka安装" class="headerlink" title="kafka安装"></a>kafka安装</h1><h2 id="安装java"><a href="#安装java" class="headerlink" title="安装java"></a>安装java</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install java-1.8.0-openjdk</span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>
<h2 id="安装zookeeper"><a href="#安装zookeeper" class="headerlink" title="安装zookeeper"></a>安装zookeeper</h2><ol>
<li>获取zookeeper<code>wget http://mirror.bit.edu.cn/apache/zookeeper/current/zookeeper-3.4.12.tar.gz</code></li>
<li>解压<code>tar zxvf zookeeper-3.4.12.tar.gz</code></li>
<li><p>移动解压文件到安装路径下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir /data/zookeeper -p</span><br><span class="line">mv zookeeper-3.4.12 /data/zookeeper/</span><br><span class="line">cd /date/zookeeper/zookeeper-3.4.12</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_187_252_centos zookeeper-3.4.12]# vim conf/zoo.cfg</span><br><span class="line">[root@VM_187_252_centos zookeeper-3.4.12]# cat conf/zoo.cfg</span><br><span class="line">tickTime = 2000</span><br><span class="line">dataDir = /data/zookeeper/data</span><br><span class="line">clientPort = 2181</span><br><span class="line">initLimit = 5</span><br><span class="line">syncLimit = 2</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动zookeeper服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_187_252_centos zookeeper-3.4.12]# bin/zkServer.sh start</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /data/zookeeper/zookeeper-3.4.12/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用客户端连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_187_252_centos zookeeper-3.4.12]# bin/zkCli.sh</span><br><span class="line">... ...</span><br><span class="line">[zk: localhost:2181(CONNECTED) 0]</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="安装kafka"><a href="#安装kafka" class="headerlink" title="安装kafka"></a>安装kafka</h2><ol>
<li>获取kafka<code>wget http://mirrors.hust.edu.cn/apache/kafka/2.0.0/kafka_2.12-2.0.0.tgz</code></li>
<li>解压<code>tar zxf kafka_2.12-2.0.0.tgz</code></li>
<li><p>移动解压文件到安装路径下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir /data/kafka -p</span><br><span class="line">mv kafka_2.12-2.0.0 /data/kafka/</span><br><span class="line">cd /data/kafka/kafka_2.12-2.0.0/</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动kafka</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_187_252_centos kafka_2.12-2.0.0]# nohup bin/kafka-server-start.sh config/server.properties 1&gt;/dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="kafka-manager安装"><a href="#kafka-manager安装" class="headerlink" title="kafka manager安装"></a>kafka manager安装</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">mkdir .sbt</span><br><span class="line">cd .sbt</span><br><span class="line">vim repositories</span><br></pre></td></tr></table></figure>
<p>在repositories中加入如下内容,使用国内阿里云资源加快下载速度<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[repositories]</span><br><span class="line">local</span><br><span class="line">aliyun: http://maven.aliyun.com/nexus/content/groups/public</span><br><span class="line">typesafe: http://repo.typesafe.com/typesafe/ivy-releases/, [organization]/[module]/(scala_[scalaVersion]/)(sbt_[sbtVersion]/)[revision]/[type]s/[artifact](-[classifier]).[ext], bootOnly</span><br></pre></td></tr></table></figure></p>
<p>返回安装目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/yahoo/kafka-manager.git</span><br><span class="line">cd kafka-manager</span><br><span class="line">./sbt clean dist</span><br></pre></td></tr></table></figure></p>
<p>这个过程比较慢,需要耐心等待,完成之后在<code>target/universal</code>目录下会生产一个zip压缩包<code>kafka-manager-*.zip</code>,将其拷贝到要部署的目录下解压。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd target/universal</span><br><span class="line">cp kafka-manager-1.3.3.21.zip /data/kafka/</span><br><span class="line">cd /data/kafka/</span><br><span class="line">unzip kafka-manager-1.3.3.21.zip</span><br><span class="line">cd kafka-manager-1.3.3.21/</span><br></pre></td></tr></table></figure></p>
<p>修改 <code>conf/application.conf</code> 中<code>kafka-manager.zkhosts</code>为正确的zookeeper地址<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-manager -Dconfig.file=./conf/application.conf -Dhttp.port=9000</span><br></pre></td></tr></table></figure></p>
<p>正常启动后即可登陆进行相关操作</p>
<h1 id="kafka概述"><a href="#kafka概述" class="headerlink" title="kafka概述"></a>kafka概述</h1><p>kafka专为<strong>分布式高吞吐量</strong>系统而设计,kafka相比其它消息传递系统具有更好的吞吐量,内置分区,复制和固有的容错能力,非常<strong>适合大规模消息处理应用程序</strong>.<br>kafka是一个<strong>分布式发布-订阅消息系统</strong>和一个<strong>强大的队列</strong>,可以处理大量的数据,并使您能够将消息从一个端点传递到另一个端点.<br>kafka适合离线和在线消息消费.<br>Kafka消息保留在磁盘上,并在群集内复制以防止数据丢失.<br>Kafka构建在ZooKeeper同步服务之上.它与Apache Storm和Spark非常好地集成,用于实时流式数据分析.</p>
<h2 id="kafka的好处"><a href="#kafka的好处" class="headerlink" title="kafka的好处"></a>kafka的好处</h2><ol>
<li>可靠性 kafka是分布式,分区,复制和容错的</li>
<li>可扩展性 kafka消息传递系统轻松缩放,无需停机</li>
<li>耐用性 kafka使用分布式提交日志,消息尽可能快的保存在磁盘上</li>
<li>性能 kafka对于发布和订阅都具有高吞吐量</li>
</ol>
<p>kafka非常快,并保证零停机和零数据丢失</p>
<h2 id="kafka的用例"><a href="#kafka的用例" class="headerlink" title="kafka的用例"></a>kafka的用例</h2><ol>
<li>指标 kafka通常用来操作监控数据,涉及聚合来自分布式应用程序的统计信息,以产生操作数据和集中馈送</li>
<li>日志聚合解决方案 kafka用于跨组织来从多个服务收集日志,并提供标准格式给多个服务器</li>
<li>流处理 流行的框架从主题中读取数据,对其处理,并将处理后的数据写入新主题,供用户和应用程序使用.kafka的强耐久性在流处理的上下文中非常有用</li>
</ol>
<p><img src="/Picture/KafkaFrame.png" alt="Kafka框架图"></p>
<h1 id="kafka基础"><a href="#kafka基础" class="headerlink" title="kafka基础"></a>kafka基础</h1><ol>
<li>Topics 主题<br> 属于特定类别的消息流称为主题.数据存储在主题中.主题被拆分成分区.对于每个主题,Kafka保存一个分区的数据.每个这样的分区包含不可变有序序列的消息.分区被实现为具有相等大小的一组分段文件</li>
<li>Partition分区<br> 主题可能有许多分区,因此它可以处理任意数量的数据.</li>
<li>Partition offset 分区偏移<br> 每个分区消息具有称为offset的唯一序列标识.</li>
<li>Replicas of partition 分区备份<br> 副本只是一个分区的备份.副本从不读取或写入数据.它们用于防止数据丢失.</li>
<li>Brokers 经纪人<ul>
<li>代理是负责维护发布数据的简单系统.每个代理中的每个主题可以具有零个或多个分区 假设,如果在一个主题和N个代理中有N个分区，每个代理将有一个分区.</li>
<li>假设在一个主题中有N个分区并且多于N个代理(n+m)，则第一个N代理将具有一个分区，并且下一个M代理将不具有用于该特定主题的任何分区。</li>
<li>假设在一个主题中有N个分区并且小于N个代理(n-m)，每个代理将在它们之间具有一个或多个分区共享。 由于代理之间的负载分布不相等，不推荐使用此方案。</li>
</ul>
</li>
<li>Kafka Cluster Kafka集群<br> Kafka有多个代理被称为Kafka集群.可以扩展Kafka集群,无需停机.集群用于管理消息数据的持久性和复制.</li>
<li>Producers 生产者<br> 生产者是发送给一个或多个Kafka主题的消息的发布者.生产者向Kafka经纪人发送数据.每当生产者将消息发布给代理时,代理只需将消息附加到最后一个段文件.实际上,该消息将被附加到分区.生产者还可以向他们选择的分区发送消息.</li>
<li>Consumers 消费者<br> Consumers从经纪人处读取数据.消费者订阅一个或多个主题,并通过从代理中提取数据来使用已发布的消息.</li>
<li>Leader 领导者<br> Leader是负责给定分区的所有读取和写入的节点. 每个分区都有一个服务器充当Leader</li>
<li>Follower 追随者<br>跟随领导者指令的节点被称为Follower.如果领导失败,一个追随者将自动成为新的领导者.跟随者作为正常消费者,拉取消息并更新其自己的数据存储.</li>
</ol>
<h1 id="kafka集群架构"><a href="#kafka集群架构" class="headerlink" title="kafka集群架构"></a>kafka集群架构</h1><ol>
<li>Broker代理<br> Kafka集群通常由多个代理组成以保持负载平衡.Kafka代理是无状态的,使用ZooKeeper来维护它们的集群状态.一个Kafka代理实例可以每秒处理数十万次读取和写入,每个Broker可以处理TB的消息,而没有性能影响.Kafka经纪人领导选举可以由ZooKeeper完成.</li>
<li>ZooKeeper<br> ZooKeeper用于管理和协调Kafka代理.ZooKeeper服务主要用于通知生产者和消费者Kafka系统中存在任何新代理或Kafka系统中代理失败.根据Zookeeper接收到关于代理的存在或失败的通知,然后产品和消费者采取决定并开始与某些其他代理协调他们的任务.</li>
<li>Producers 生产者<br> 生产者将数据推送给经纪人.当新代理启动时,所有生产者搜索它并自动向该新代理发送消息.Kafka生产者不等待来自代理的确认,并且发送消息的速度与代理可以处理的一样快.</li>
<li>Consumers 消费者<br> 因为Kafka代理是无状态的,这意味着消费者必须通过使用分区偏移来维护已经消耗了多少消息.如果消费者确认特定的消息偏移,则意味着消费者已经消费了所有先前的消息.消费者向代理发出异步拉取请求,以具有准备好消耗的字节缓冲区.消费者可以简单地通过提供偏移值来快退或跳到分区中的任何点.消费者偏移值由ZooKeeper通知.</li>
</ol>
<h1 id="Kafka工作流程"><a href="#Kafka工作流程" class="headerlink" title="Kafka工作流程"></a>Kafka工作流程</h1><p>Kafka只是分为一个或多个分区的主题的集合.<br>Kafka分区是消息的线性有序序列,其中每个消息由它们的偏移来标识.Kafka集群中的所有数据都是不相连的分区联合.传入消息写在分区的末尾,消息由消费者顺序读取.通过将消息复制到不同的代理提供持久性.<br>Kafka以快速,可靠,持久,容错和零停机的方式提供基于pub-sub和队列的消息系统.<br>生产者只需将消息发送到主题，消费者可以根据自己的需要选择任何一种类型的消息传递系统</p>
<h2 id="发布订阅工作流程"><a href="#发布订阅工作流程" class="headerlink" title="发布订阅工作流程"></a>发布订阅工作流程</h2><ol>
<li>生产者向主题发送消息。</li>
<li>Kafka代理存储为该特定主题配置的分区中的所有消息.它确保消息在分区之间平等共享.如果生产者发送两个消息并且有两个分区,Kafka将在第一分区中存储一个消息,在第二分区中存储第二消息.</li>
<li>消费者订阅特定主题.</li>
<li>一旦消费者订阅主题,Kafka将向消费者提供主题的当前偏移,并且还将偏移保存在Zookeeper中.</li>
<li>消费者将定期请求Kafka新消息.</li>
<li>一旦Kafka收到来自生产者的消息,它将这些消息转发给消费者.</li>
<li>消费者将收到消息并进行处理.</li>
<li>一旦消息被处理,消费者将向Kafka代理发送确认.</li>
<li>一旦Kafka收到确认,它将偏移更改为新值,并在Zookeeper中更新它.由于偏移在Zookeeper中维护,消费者可以正确地读取下一封邮件,即使在服务器暴力期间.</li>
<li>以上流程将重复,直到消费者停止请求.</li>
</ol>
<p>消费者可以随时回退/跳到所需的主题偏移量,并阅读所有后续消息.</p>
<h2 id="队列消息-用户组的工作流"><a href="#队列消息-用户组的工作流" class="headerlink" title="队列消息/用户组的工作流"></a>队列消息/用户组的工作流</h2><p>在队列消息传递系统而不是单个消费者中，具有相同”组ID “的一组消费者将订阅主题。 简单来说，订阅具有相同” Group ID “的主题的消费者被认为是单个组，并且消息在它们之间共享。 让我们检查这个系统的实际工作流程。</p>
<ol>
<li>生产者以固定间隔向某个主题发送消息.</li>
<li>Kafka存储在为该特定主题配置的分区中的所有消息.</li>
<li>单个消费者订阅特定主题，假设Topic-01的Group ID为Group-1。</li>
<li>Kafka以与发布-订阅消息相同的方式与消费者交互,直到新消费者以相同的组ID订阅相同主题Topic-01</li>
<li>一旦新消费者到达,Kafka将其操作切换到共享模式,并在两个消费者之间共享数据.此共享将继续,直到用户数达到为该特定主题配置的分区数。</li>
<li>一旦消费者的数量超过分区的数量,新消费者将不会接收任何进一步的消息,直到现有消费者取消订阅任何一个消费者.出现这种情况是因为Kafka中的每个消费者将被分配至少一个分区,并且一旦所有分区被分配给现有消费者,新消费者将必须等待</li>
</ol>
<p>此功能也称为”使用者组”。 同样，Kafka将以非常简单和高效的方式提供两个系统中最好的</p>
<h2 id="ZooKeeper的作用"><a href="#ZooKeeper的作用" class="headerlink" title="ZooKeeper的作用"></a>ZooKeeper的作用</h2><p>Apache Kafka的一个关键依赖是Apache Zookeeper, Zookeeper是一个分布式配置和同步服务.<br>Zookeeper是Kafka代理和消费者之间的协调接口.<br>Kafka服务器通过Zookeeper集群共享信息.<br>Kafka在Zookeeper中存储基本元数据,例如关于主题,代理,消费者偏移(队列读取器)等的信息.</p>
<p>由于所有关键信息存储在Zookeeper中,并且它通常在其整体上复制此数据,因此Kafka代理/Zookeeper的故障不会影响Kafka集群的状态.Kafka将恢复状态,一旦Zookeeper重新启动.这为Kafka带来了零停机时间.Kafka代理之间的领导者选举也通过使用Zookeeper在领导者失败的情况下完成.</p>
<h1 id="Kafka-Leader的选举"><a href="#Kafka-Leader的选举" class="headerlink" title="Kafka Leader的选举"></a>Kafka Leader的选举</h1><p>Kafka Partition的Leader选举是在所有Broker中选出一个Controller(管理员),所有Partition的Leader选举都由Controller决定,Controller会将Leader的改变直接通过RPC的方式(比Zookeeper Queue的方式更高效)通知需要为此做出响应的Broker.<br>Kafka Controller的选举过程:</p>
<ol>
<li>每个Broker都会在Zookeeper中Controller Path上注册一个<strong>Watch</strong>(监听者)</li>
<li>当前Controller由于某些原因和Zookeeper断开时,对应的Controller Path会自动消失,此时会触发Watch,所有活着的Broker都回去竞争成为新的Controller(创建新的Controller Path),但只有一个会竞争成功(Zookeeper保证).</li>
<li>竞争成功的Broker会成功新的Controller,竞争失败的Broker会重新在新的Controller Path上注册Watch.</li>
</ol>
<p><strong>Kafka Partition Leader的选举由Controller执行</strong>:</p>
<ol>
<li>从Zookeeper中读取当前分区的所有ISR集合</li>
<li>调用配置的分区选择算法选择分区的Leader</li>
</ol>
<h1 id="Kafka-C-实践"><a href="#Kafka-C-实践" class="headerlink" title="Kafka C++实践"></a>Kafka C++实践</h1><h2 id="librdkafka安装"><a href="#librdkafka安装" class="headerlink" title="librdkafka安装"></a>librdkafka安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/edenhill/librdkafka/archive/v0.11.6.tar.gz</span><br><span class="line">tar zxvf v0.11.6.tar.gz</span><br><span class="line">cd librdkafka-0.11.6</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><ul>
<li><a href="http://kafka.apachecn.org/documentation.html#introduction" target="_blank" rel="noopener">Kafka中文文档</a></li>
<li><a href="https://www.w3cschool.cn/apache_kafka/" target="_blank" rel="noopener">Apache Kafka 教程</a></li>
<li>Kafka权威指南</li>
<li><a href="https://github.com/edenhill/librdkafka" target="_blank" rel="noopener">librdkafka github</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.casezheng.date/2018/10/15/linux-common-commands/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CaseZheng">
      <meta itemprop="description" content="CaseZheng的博客网站">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CaseZheng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/10/15/linux-common-commands/" class="post-title-link" itemprop="url">Linux常用命令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-10-15 22:43:57" itemprop="dateCreated datePublished" datetime="2018-10-15T22:43:57+08:00">2018-10-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Linux常用命令"><a href="#Linux常用命令" class="headerlink" title="Linux常用命令"></a>Linux常用命令</h1><h2 id="Linux批量查找和替换"><a href="#Linux批量查找和替换" class="headerlink" title="Linux批量查找和替换"></a>Linux批量查找和替换</h2><h3 id="语法格式"><a href="#语法格式" class="headerlink" title="语法格式"></a>语法格式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i &quot;s/原字符串/新字符串/g&quot; `grep 原字符串 -rl 所在目录`</span><br></pre></td></tr></table></figure>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>查找./post/目录下包含c++字符串的文档,并将文档中c++字符串替换为c<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i "s/c++/c/g" `grep c++ -rl ./post/`</span><br></pre></td></tr></table></figure></p>
<h1 id="yum"><a href="#yum" class="headerlink" title="yum"></a>yum</h1><p>yum在误操作后的回滚,通过<code>yum history</code>查看yum的历史操作记录,然后通过<code>yum history undo ID</code>的方式回滚<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> yum <span class="built_in">history</span></span></span><br><span class="line">ID     | 命令行                   | 日期和时间       | 操作           | 更改</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">    41 | autoremove               | 2019-05-04 02:26 | Removed        |    4</span><br><span class="line">    40 | install ibus-libpinyin   | 2019-05-04 02:15 | Install        |    1</span><br><span class="line">    39 | remove ibus-libpinyin    | 2019-05-04 02:12 | Removed        |    1</span><br><span class="line">... ...</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> yum <span class="built_in">history</span> undo 41</span></span><br></pre></td></tr></table></figure></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="http://www.runoob.com/linux/linux-command-manual.html" target="_blank" rel="noopener">Linux命令大全</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.casezheng.date/2018/09/28/boost-install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CaseZheng">
      <meta itemprop="description" content="CaseZheng的博客网站">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CaseZheng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/09/28/boost-install/" class="post-title-link" itemprop="url">C++ boost库源码编译安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-09-28 23:20:39" itemprop="dateCreated datePublished" datetime="2018-09-28T23:20:39+08:00">2018-09-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/other/" itemprop="url" rel="index"><span itemprop="name">other</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="boost库的安装"><a href="#boost库的安装" class="headerlink" title="boost库的安装"></a>boost库的安装</h1><h2 id="获取boost源码"><a href="#获取boost源码" class="headerlink" title="获取boost源码"></a>获取boost源码</h2><p><a href="https://www.boost.org/" target="_blank" rel="noopener">boost官网</a>获取最新版本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://dl.bintray.com/boostorg/release/1.68.0/source/boost_1_68_0.tar.gz</span><br><span class="line">tar zxvf boost_1_68_0.tar.gz</span><br><span class="line">cd boost_1_68_0</span><br></pre></td></tr></table></figure></p>
<h2 id="booststrap-sh"><a href="#booststrap-sh" class="headerlink" title="booststrap.sh"></a>booststrap.sh</h2><p>boost库有两种类型 1.需要编译才可使用 2.直接包含文件即可使用<br>booststrap.sh设置编译参数 如下设置库的安装目录为/usr/lib/boost 编译thread date_time 如果安装全部组件则不需要指定—with-libraries<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bootstrap.sh  --prefix=/usr/lib/boost --with-libraries=thread,date_time</span><br></pre></td></tr></table></figure></p>
<p>再运行b2编译安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./b2</span><br><span class="line">./b2 install</span><br></pre></td></tr></table></figure></p>
<h2 id="boost库瘦身"><a href="#boost库瘦身" class="headerlink" title="boost库瘦身"></a>boost库瘦身</h2><p>boost库很是庞大,只需要部分功能的话可以使用bcp工具瘦身</p>
<h3 id="编译bcp工具"><a href="#编译bcp工具" class="headerlink" title="编译bcp工具"></a>编译bcp工具</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./b2 tools/bcp</span><br></pre></td></tr></table></figure>
<h3 id="使用bcp工具"><a href="#使用bcp工具" class="headerlink" title="使用bcp工具"></a>使用bcp工具</h3><p>如下创建boost_lib目录 提取smart_ptr thread组件到boost_lib目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir boost_lib</span><br><span class="line">./dist/bin/bcp smart_ptr thread ./boost_lib</span><br></pre></td></tr></table></figure></p>
<p>注意此处提取只是头文件</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.casezheng.date/2018/09/18/mysql-slave/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CaseZheng">
      <meta itemprop="description" content="CaseZheng的博客网站">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CaseZheng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/09/18/mysql-slave/" class="post-title-link" itemprop="url">MySQL主从复制与异地容灾</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-09-18 19:12:57" itemprop="dateCreated datePublished" datetime="2018-09-18T19:12:57+08:00">2018-09-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-05-06 19:12:57" itemprop="dateModified" datetime="2019-05-06T19:12:57+08:00">2019-05-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MySQL主从复制用途、条件和问题"><a href="#MySQL主从复制用途、条件和问题" class="headerlink" title="MySQL主从复制用途、条件和问题"></a>MySQL主从复制用途、条件和问题</h1><h2 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h2><ol>
<li>实时灾备，用于故障切换</li>
<li>读写分离，提供查询服务</li>
</ol>
<h2 id="主从复制的必要条件"><a href="#主从复制的必要条件" class="headerlink" title="主从复制的必要条件"></a>主从复制的必要条件</h2><ol>
<li>主库开启binlog日志(设置<code>log-bin</code>参数)</li>
<li>主库和从库的<code>server-id</code>不同</li>
<li>从库能连接到主库，并且有权限</li>
</ol>
<h2 id="主从复制原理"><a href="#主从复制原理" class="headerlink" title="主从复制原理"></a>主从复制原理</h2><p>MySQL最基本的主从复制是<strong>异步复制（Asynchronous replication）</strong><br>Master事务的提交不需要经过Slave的确认，Master对Slave接收Master binlog成功与否并不关心。Slave接收到Master的binlog后先写relay log，然后异步执行relay log的SQL。<br>从库有两个线程</p>
<ol>
<li>I/O线程，请求主库的binlog，并将得到的binlog日志写入到relay log(中继日志)文件中。</li>
<li>SQL线程，读取中继日志，并解析成具体的操作执行，保证主从一致<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Slave1  --------------------------------&gt; relay log ---&gt; apply ---&gt; binlog ---&gt; commit -------------&gt;</span><br><span class="line">                                   /|\</span><br><span class="line">        Commit                      |                         End</span><br><span class="line">     ------                         |                         -----&gt;        </span><br><span class="line">         \|/                        |                         |  不用等待直接返回成功</span><br><span class="line">Master  -----&gt; execute ---&gt; binlog -----&gt; commit ---------------------------------------------------&gt;</span><br><span class="line">                                    |</span><br><span class="line">                                    |</span><br><span class="line">                                   \|/</span><br><span class="line">Slave2  --------------------------------&gt; relay log ---&gt; apply ---&gt; binlog ---&gt; commit -------------&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>主库生成log dump线程，给从库的I/O线程传递binlog</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ol>
<li>主库和从库的同步会出现延时，主库宕机可能导致数据丢失</li>
<li>主库和从库的同步因为网络延迟等各种问题，导致主库和从库的差距过大</li>
<li>主库和从库的由于配置问题、权限问题等，导致主从同步失败</li>
<li>主库只负责把binlog日志发送到从库，当从库故障时，导致主从数据库数据不一致</li>
</ol>
<p><strong>单一的主从复制并不能保证数据的安全可靠，也不能做到异地容灾</strong></p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><ol>
<li>基于GTID的<strong>半同步复制</strong><ol>
<li>解决数据丢失问题(GTID)</li>
<li>解决从库故障时主库无感知的问题(半同步)</li>
</ol>
</li>
<li><strong>并行复制</strong>，解决从库复制延迟的问题</li>
</ol>
<h1 id="MySQL基于GTID的半同步复制"><a href="#MySQL基于GTID的半同步复制" class="headerlink" title="MySQL基于GTID的半同步复制"></a>MySQL基于GTID的半同步复制</h1><h2 id="GTID"><a href="#GTID" class="headerlink" title="GTID"></a>GTID</h2><p>GTID(Global Transaction ID 全局事物标记)是对于一个已提交事务的编号，并且是一个全局唯一的编号.GTID实际上是由UUID+TID组成的.其中UUID是一个MySQL实例的唯一标识.<code>server_uuid</code>在MySQl启动时，使用当前时间，随机数等拼接成一个128bit位的uuid.然后该<code>server_uuid</code>被写入到<code>auto.conf</code>文件，当MySQL再次重启时不再随即生成，直接使用保存的这个<code>server_uuid</code>.<br>TID代表了该实例上已经提交的事务数量，并且随着事务提交单调递增.<br>MySQL数据库从5.6.5开始新增一种基于GDIT的复制方式.通过GDIT保证每个主库上提交的事务在集群中有一个唯一的ID.这种方式强化了数据库的主备一致性，故障恢复以及容错能力.</p>
<h2 id="全同步复制（Fully-synchronous-replication）"><a href="#全同步复制（Fully-synchronous-replication）" class="headerlink" title="全同步复制（Fully synchronous replication）"></a>全同步复制（Fully synchronous replication）</h2><p>主库完成一个事务，所有从库都需要返回事务执行成功才返回给客户端。由于要所有从库都返回Ack成功才能返回，所有全同步复制的性能会受到严重影响</p>
<h2 id="半同步复制（Semisynchronous-replication）"><a href="#半同步复制（Semisynchronous-replication）" class="headerlink" title="半同步复制（Semisynchronous replication）"></a>半同步复制（Semisynchronous replication）</h2><p>半同步复制的效率介于异步复制和半同步复制之间，主库完成一个事务不直接返回给客户端，而是等待至少一个从库接收到并写到relay log中然后给主库返回Ack，才返回客户端。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Slave1  ------------------------------&gt; relay log ----------&gt; apply ---&gt; binlog ---&gt; commit -------------&gt;</span><br><span class="line">                                   /|\                   |</span><br><span class="line">                                    |                   Ack 至少等待一个从库的Ack才给客户端返回成功</span><br><span class="line">                                    |                    | </span><br><span class="line">        Commit                      |                    |                 Commit End</span><br><span class="line">     ------                         |                    |                 -----&gt;        </span><br><span class="line">         \|/                        |                   \|/                |</span><br><span class="line">Master  -----&gt; execute ---&gt; binlog -----&gt; engine commit -------------------------------------------------&gt;</span><br><span class="line">                                    |                   /|\</span><br><span class="line">                                    |                   Ack</span><br><span class="line">                                   \|/                   |</span><br><span class="line">Slave2  ------------------------------&gt; relay log ----------&gt; apply ---&gt; binlog ---&gt; commit -------------&gt;</span><br></pre></td></tr></table></figure></p>
<p><strong>半同步复制Slave对relay log的应用仍然是异步的</strong></p>
<p>开启基于GTID的主从复制，在从库和主库都需要在配置文件加入如下配置:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gtid-mode=ON</span><br><span class="line">enforce-gtid-consistency=ON</span><br><span class="line">log-slave-updates=ON</span><br></pre></td></tr></table></figure></p>
<h2 id="半同步复制的增强"><a href="#半同步复制的增强" class="headerlink" title="半同步复制的增强"></a>半同步复制的增强</h2><p>MySQL5.7增强半同步复制，两种方式：<code>AFTER SYNC</code>和<code>AFTER COMMIT</code></p>
<h3 id="AFTER-COMMIT"><a href="#AFTER-COMMIT" class="headerlink" title="AFTER COMMIT"></a>AFTER COMMIT</h3><p>5.6版本MySQL半同步的方式，现在引擎层做提交后再等待Ack确认。<br>如果一个事务在该模式下，如果在接收Ack的阶段Master实例故障，数据库切到从库,有两种请求：</p>
<ol>
<li>binlog未发送到从库，但主库已经提交了，主从数据不同步</li>
<li>binlog已发送到从库，但Client未收到提交成功的消息，但该事务实际已执行成功，如果业务不判断则会将该事务执行两次</li>
</ol>
<h3 id="AFTER-SYNC"><a href="#AFTER-SYNC" class="headerlink" title="AFTER SYNC"></a>AFTER SYNC</h3><p>官方推荐方式，客户端发出Commit请求后，在主库上写入binlog并推送给Slave，Slave接收到binlog并写入relay log，再发送Ack到Master，Master收到Ack后再在引擎层提交。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Slave1  ------------------------------&gt; relay log ---&gt; apply ---&gt; binlog ---&gt; commit -------------&gt;</span><br><span class="line">                                   /|\             |</span><br><span class="line">                                    |             Ack 至少等待一个从库的Ack才给客户端返回成功</span><br><span class="line">                                    |              | </span><br><span class="line">        Commit                      |              |                 End</span><br><span class="line">     ------                         |              |                 -----&gt;        </span><br><span class="line">         \|/                        |             \|/                |</span><br><span class="line">Master  -----&gt; execute ---&gt; binlog ------------------&gt;----engine commit --------------------------&gt;</span><br><span class="line">                                    |             /|\</span><br><span class="line">                                    |             Ack</span><br><span class="line">                                   \|/             |</span><br><span class="line">Slave2  ------------------------------&gt; relay log ---&gt; apply ---&gt; binlog ---&gt; commit -------------&gt;</span><br></pre></td></tr></table></figure></p>
<p>该模式下，现将binlog发送到从库，然后再在引擎层提交</p>
<h1 id="基于GTID的主从复制实例"><a href="#基于GTID的主从复制实例" class="headerlink" title="基于GTID的主从复制实例"></a>基于GTID的主从复制实例</h1><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>单机启动3306和3307两个MySQL实例，配置以3306作为主库，3307为从库 同步主库的<code>test.t_test1</code>和<code>test.t_test2</code><br>两个实例的server-id不能相同<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[mysqld3306]</span><br><span class="line">user = mysql</span><br><span class="line">port = 3306</span><br><span class="line">socket = /data/mysql/3306/mysql.sock</span><br><span class="line">pid-file = /data/mysql/3306/mysqld.pid</span><br><span class="line">log-error = /data/mysql/3306/mysqld.log</span><br><span class="line">datadir = /data/mysql/3306/data</span><br><span class="line">max_connections = 200</span><br><span class="line">default-storage-engine = innodb</span><br><span class="line">character_set_server = utf8</span><br><span class="line"></span><br><span class="line">log-bin=mysql-bin               #开启二进制日志</span><br><span class="line">server-id=1                     #服务器ID</span><br><span class="line">binlog-do-db=test               #需要同步的数据库名</span><br><span class="line">binlog-ignore-db=mysql          #禁止同步的数据库名</span><br><span class="line"></span><br><span class="line">gtid-mode=ON</span><br><span class="line">enforce-gtid-consistency=ON</span><br><span class="line">log-slave-updates=ON</span><br><span class="line"></span><br><span class="line">[mysqld3307]</span><br><span class="line">user = mysql</span><br><span class="line">port = 3307</span><br><span class="line">socket = /data/mysql/3307/mysql.sock</span><br><span class="line">pid-file = /data/mysql/3307/mysqld.pid</span><br><span class="line">log-error = /data/mysql/3307/mysqld.log</span><br><span class="line">datadir = /data/mysql/3307/data</span><br><span class="line">max_connections = 200</span><br><span class="line">default-storage-engine = innodb</span><br><span class="line">character_set_server = utf8</span><br><span class="line"></span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">server-id=2</span><br><span class="line"></span><br><span class="line">relay_log=relay-bin</span><br><span class="line">replicate-wild-do-table=test.t_test1</span><br><span class="line">replicate-wild-do-table=test.t_test2</span><br><span class="line">slave-skip-errors=all</span><br><span class="line"></span><br><span class="line">gtid-mode=ON</span><br><span class="line">enforce-gtid-consistency=ON</span><br><span class="line">log-slave-updates=ON</span><br></pre></td></tr></table></figure></p>
<h2 id="3307同步3306的test-t-test1和test-t-test2"><a href="#3307同步3306的test-t-test1和test-t-test2" class="headerlink" title="3307同步3306的test.t_test1和test.t_test2"></a>3307同步3306的test.t_test1和test.t_test2</h2><ol>
<li>在3306上创建同步所用的帐号 <code>grant replication slave on *.* to rep@&#39;%&#39; identified by &#39;123456&#39;;</code></li>
<li>在3307上设置同步配置 <code>change master to master_host=&#39;127.0.0.1&#39;,master_user=&#39;rep&#39;,master_password=&#39;123456&#39;,master_port=3306;</code></li>
<li>开启同步 <code>start slave;</code></li>
<li>关闭同步 <code>stop slave;</code></li>
<li>查看同步状态 <code>show slave status\G</code><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">                Slave_IO_State: Waiting for master to send event</span><br><span class="line">                   Master_Host: 127.0.0.1</span><br><span class="line">                   Master_User: root</span><br><span class="line">                   Master_Port: 3306</span><br><span class="line">                 Connect_Retry: 60</span><br><span class="line">               Master_Log_File: mysql-bin.000001</span><br><span class="line">           Read_Master_Log_Pos: 502</span><br><span class="line">                Relay_Log_File: relay-bin.000002</span><br><span class="line">                 Relay_Log_Pos: 801</span><br><span class="line">         Relay_Master_Log_File: mysql-bin.000001</span><br><span class="line">              Slave_IO_Running: Yes</span><br><span class="line">             Slave_SQL_Running: Yes</span><br><span class="line">               Replicate_Do_DB:</span><br><span class="line">           Replicate_Ignore_DB:</span><br><span class="line">            Replicate_Do_Table:</span><br><span class="line">        Replicate_Ignore_Table:</span><br><span class="line">       Replicate_Wild_Do_Table: test.t_test1,test.t_test2</span><br><span class="line">   Replicate_Wild_Ignore_Table:</span><br><span class="line">                    Last_Errno: 0</span><br><span class="line">                    Last_Error:</span><br><span class="line">                  Skip_Counter: 0</span><br><span class="line">           Exec_Master_Log_Pos: 502</span><br><span class="line">               Relay_Log_Space: 1104</span><br><span class="line">               Until_Condition: None</span><br><span class="line">                Until_Log_File:</span><br><span class="line">                 Until_Log_Pos: 0</span><br><span class="line">            Master_SSL_Allowed: No</span><br><span class="line">            Master_SSL_CA_File:</span><br><span class="line">            Master_SSL_CA_Path:</span><br><span class="line">               Master_SSL_Cert:</span><br><span class="line">             Master_SSL_Cipher:</span><br><span class="line">                Master_SSL_Key:</span><br><span class="line">         Seconds_Behind_Master: 0</span><br><span class="line"> Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                 Last_IO_Errno: 0</span><br><span class="line">                 Last_IO_Error:</span><br><span class="line">                Last_SQL_Errno: 0</span><br><span class="line">                Last_SQL_Error:</span><br><span class="line">   Replicate_Ignore_Server_Ids:</span><br><span class="line">              Master_Server_Id: 1</span><br><span class="line">                Master_SSL_Crl:</span><br><span class="line">            Master_SSL_Crlpath:</span><br><span class="line">                    Using_Gtid: No</span><br><span class="line">                   Gtid_IO_Pos:</span><br><span class="line">       Replicate_Do_Domain_Ids:</span><br><span class="line">   Replicate_Ignore_Domain_Ids:</span><br><span class="line">                 Parallel_Mode: conservative</span><br><span class="line">                     SQL_Delay: 0</span><br><span class="line">           SQL_Remaining_Delay: NULL</span><br><span class="line">       Slave_SQL_Running_State: Slave has read all relay log; waiting for the slave I/O thread to <span class="keyword">update</span> it</span><br><span class="line">              Slave_DDL_Groups: <span class="number">0</span></span><br><span class="line">Slave_Non_Transactional_Groups: <span class="number">0</span></span><br><span class="line">    Slave_Transactional_Groups: <span class="number">1</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.000</span> sec)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="MySQL组复制（MySQL-Group-Replication，简称MGR）"><a href="#MySQL组复制（MySQL-Group-Replication，简称MGR）" class="headerlink" title="MySQL组复制（MySQL Group Replication，简称MGR）"></a>MySQL组复制（MySQL Group Replication，简称MGR）</h1><p>传统异步复制和半同步复制的缺陷（数据的一致性问题无法保证）<br>由若干个节点共同组成一个复制组，一个事物的提交，必须经过组内大多数节点（N/2+1）决议并通过才能进行提交。<br>组复制主要是解决传统异步复制和半同步复制可能产生的数据不一致的问题。组复制依靠分布式一致性协议（Paxos协议的变体），实现分布式下数据的一致性。</p>
<h2 id="MGR原理"><a href="#MGR原理" class="headerlink" title="MGR原理"></a>MGR原理</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">                      --------------------</span><br><span class="line">                      |                  |</span><br><span class="line">Slave1  --------------|---------&gt;------&gt; certify ---&gt; relay log ---&gt; apply ---&gt; binlog ---&gt; commit -------------&gt;</span><br><span class="line">                      |      /|\         |</span><br><span class="line">        Commit        |       |          |                                     End</span><br><span class="line">     ------           |       |          |                                     -----&gt;        </span><br><span class="line">         \|/          |       |          |                                     |</span><br><span class="line">Master  -----&gt; execute|----------------&gt; certify ---&gt; binlog ------------------&gt;-----------&gt; commit ------------&gt;</span><br><span class="line">                      |       |          |</span><br><span class="line">                      |      \|/         |</span><br><span class="line">Slave2  --------------|---------&gt;------&gt; certify ---&gt; relay log ---&gt; apply ---&gt; binlog ---&gt; commit -------------&gt;</span><br><span class="line">                      |                  |</span><br><span class="line">                      |     Consensus    |</span><br><span class="line">                      --------------------</span><br></pre></td></tr></table></figure>
<p>一个复制组由若干个节点（数据库实例）组成，组内各个节点维护各自的数据副本，通过一致性协议实现原子消息和全局有序消息，来实现组内实例数据的一致。</p>
<h2 id="MGR特性"><a href="#MGR特性" class="headerlink" title="MGR特性"></a>MGR特性</h2><ul>
<li>数据一致性保障：确保集群中大部分节点收到日志</li>
<li>多节点写入支持：多写模式下支持集群中的所有节点都可以写入</li>
<li>容错：确保系统发生故障（包括脑裂）依然可用</li>
<li>MGR的性能比Semi-sync（半同步复制）好</li>
<li>MGR能极大的简化业务逻辑架构</li>
</ul>
<h1 id="碰到问题"><a href="#碰到问题" class="headerlink" title="碰到问题"></a>碰到问题</h1><h2 id="mysqld-multi启动实例会默认读取mysql默认配置"><a href="#mysqld-multi启动实例会默认读取mysql默认配置" class="headerlink" title="mysqld_multi启动实例会默认读取mysql默认配置"></a>mysqld_multi启动实例会默认读取mysql默认配置</h2><p>mysqld_multi启动实例会读取默认mysql配置，导致配置有问题，尝试给mysqld_multi使用<code>--defaults-file</code>设置默认配置，但仍未解决，最后解决方法先移除mysql默认配置，启动mysqld_multi实例后再恢复回去</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="https://blog.csdn.net/a939029674/article/details/81632565" target="_blank" rel="noopener">mysql的主从复制和半同步复制</a></li>
<li><a href="https://www.cnblogs.com/zero-gg/p/9057092.html" target="_blank" rel="noopener">MySQL 5.7半同步复制技术</a></li>
<li><a href="https://www.cnblogs.com/luoahong/articles/8043035.html" target="_blank" rel="noopener">MySQL5.7新特性—官方高可用方案MGR介绍</a></li>
<li><a href="https://www.jianshu.com/p/3bfb0bfb8b34" target="_blank" rel="noopener">【MySQL】5.7增强半同步AFTER SYNC&amp;AFTER COMMIT</a></li>
<li><a href="http://blog.itpub.net/15498/viewspace-2143986/" target="_blank" rel="noopener">MySQL5.7新特性半同步复制之AFTER_SYNC/AFTER_COMMIT的过程分析和总结 </a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.casezheng.date/2018/09/17/mysqld-multi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CaseZheng">
      <meta itemprop="description" content="CaseZheng的博客网站">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CaseZheng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/09/17/mysqld-multi/" class="post-title-link" itemprop="url">MySQL单机多实例</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-09-17 18:48:08" itemprop="dateCreated datePublished" datetime="2018-09-17T18:48:08+08:00">2018-09-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-05-07 01:12:08" itemprop="dateModified" datetime="2019-05-07T01:12:08+08:00">2019-05-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>这里演示在单台机器上利用mysqld_multi运行两个MySQL实例,MySQL版本5.1.73</p>
<h1 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h1><h2 id="创建mysql-multi所需的配置文件"><a href="#创建mysql-multi所需的配置文件" class="headerlink" title="创建mysql_multi所需的配置文件"></a>创建mysql_multi所需的配置文件</h2><p>touch /etc/mysql_multi.cnf</p>
<h2 id="编辑配置文件如下"><a href="#编辑配置文件如下" class="headerlink" title="编辑配置文件如下"></a>编辑配置文件如下</h2><p>vim /etc/mysql_multi.cnf<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[mysqld_multi]</span><br><span class="line">mysqld = /usr/bin/mysqld_safe</span><br><span class="line">mysqladmin = /usr/bin/mysqladmin</span><br><span class="line">log = /data/mysql/log/mysqld_multi.log</span><br><span class="line"></span><br><span class="line">[mysqld3306]</span><br><span class="line">user = mysql</span><br><span class="line">port = 3306</span><br><span class="line">socket = /data/mysql/3306/mysql.sock</span><br><span class="line">pid-file = /data/mysql/3306/mysqld.pid</span><br><span class="line">log-error = /data/mysql/3306/mysqld.log</span><br><span class="line">datadir = /data/mysql/3306/data</span><br><span class="line">max_connections = 200</span><br><span class="line">default-storage-engine = innodb</span><br><span class="line">character_set_server = utf8</span><br><span class="line"></span><br><span class="line">[mysqld3307]</span><br><span class="line">user = mysql</span><br><span class="line">port = 3307</span><br><span class="line">socket = /data/mysql/3307/mysql.sock</span><br><span class="line">pid-file = /data/mysql/3307/mysqld.pid</span><br><span class="line">log-error = /data/mysql/3307/mysqld.log</span><br><span class="line">datadir = /data/mysql/3307/data</span><br><span class="line">max_connections = 200</span><br><span class="line">default-storage-engine = innodb</span><br><span class="line">character_set_server = utf8</span><br></pre></td></tr></table></figure></p>
<h1 id="初始化DB"><a href="#初始化DB" class="headerlink" title="初始化DB"></a>初始化DB</h1><p>mysql_install_db —datadir=/data/mysql/3306/data —user=mysql<br>mysql_install_db —datadir=/data/mysql/3307/data —user=mysql</p>
<h1 id="查看mysql用户组-不存在则创建一个"><a href="#查看mysql用户组-不存在则创建一个" class="headerlink" title="查看mysql用户组 不存在则创建一个"></a>查看mysql用户组 不存在则创建一个</h1><h2 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h2><p><code>grep mysql /etc/group</code></p>
<h2 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h2><p><code>groupadd mysql</code></p>
<h1 id="查看mysql用户-不存在则创建一个"><a href="#查看mysql用户-不存在则创建一个" class="headerlink" title="查看mysql用户 不存在则创建一个"></a>查看mysql用户 不存在则创建一个</h1><h2 id="查看-1"><a href="#查看-1" class="headerlink" title="查看"></a>查看</h2><p><code>grep mysql /etc/passwd</code></p>
<h2 id="创建-1"><a href="#创建-1" class="headerlink" title="创建"></a>创建</h2><p><code>useradd mysql -g mysql -M -s /sbin/nologin</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">增加一个名为CentOS Mysql的用户。</span><br><span class="line">-g：指定新用户所属的用户组(group)</span><br><span class="line">-M：不建立根目录</span><br><span class="line">-s：定义其使用的shell，/sbin/nologin代表用户不能登录系统。</span><br></pre></td></tr></table></figure>
<h1 id="给mysql用户添加权限"><a href="#给mysql用户添加权限" class="headerlink" title="给mysql用户添加权限"></a>给mysql用户添加权限</h1><p><code>chown -R mysql.mysql /data/mysql</code></p>
<h1 id="启用MySQL实例"><a href="#启用MySQL实例" class="headerlink" title="启用MySQL实例"></a>启用MySQL实例</h1><p><code>mysqld_multi --defaults-extra-file=/etc/mysql_multi.cnf start</code></p>
<h1 id="查看启用的MySQL实例状态"><a href="#查看启用的MySQL实例状态" class="headerlink" title="查看启用的MySQL实例状态"></a>查看启用的MySQL实例状态</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@HSB-DEV-001 log]mysqld_multi --defaults-extra-file=/etc/mysql_multi.cnf report</span><br><span class="line">Reporting MySQL servers</span><br><span class="line">MySQL server from group: mysqld3306 is running</span><br><span class="line">MySQL server from group: mysqld3307 is running</span><br><span class="line"></span><br><span class="line">[root@HSB-DEV-001 mysql]ps -aef | grep mysql</span><br><span class="line">root     28064     1  0 19:08 pts/7    00:00:00 /bin/sh /usr/bin/mysqld_safe --user=mysql --port=3306 --socket=/data/mysql/3306/mysql.sock --pid-file=/data/mysql/3306/mysqld.pid --log-error=/data/mysql/3306/mysqld.log --datadir=/data/mysql/3306/data --max_connections=200 --default-storage-engine=innodb --character_set_server=utf8</span><br><span class="line">root     28072     1  0 19:08 pts/7    00:00:00 /bin/sh /usr/bin/mysqld_safe --user=mysql --port=3307 --socket=/data/mysql/3307/mysql.sock --pid-file=/data/mysql/3307/mysqld.pid --log-error=/data/mysql/3307/mysqld.log --datadir=/data/mysql/3307/data --max_connections=200 --default-storage-engine=innodb --character_set_server=utf8</span><br><span class="line">mysql    28304 28064  0 19:08 pts/7    00:00:00 /usr/libexec/mysqld --basedir=/usr --datadir=/data/mysql/3306/data --user=mysql --max_connections=200 --default-storage-engine=innodb --character_set_server=utf8 --log-error=/data/mysql/3306/mysqld.log --pid-file=/data/mysql/3306/mysqld.pid --socket=/data/mysql/3306/mysql.sock --port=3306</span><br><span class="line">mysql    28308 28072  0 19:08 pts/7    00:00:00 /usr/libexec/mysqld --basedir=/usr --datadir=/data/mysql/3307/data --user=mysql --max_connections=200 --default-storage-engine=innodb --character_set_server=utf8 --log-error=/data/mysql/3307/mysqld.log --pid-file=/data/mysql/3307/mysqld.pid --socket=/data/mysql/3307/mysql.sock --port=3307</span><br></pre></td></tr></table></figure>
<h1 id="设置密码和权限"><a href="#设置密码和权限" class="headerlink" title="设置密码和权限"></a>设置密码和权限</h1><h2 id="登录MySQL"><a href="#登录MySQL" class="headerlink" title="登录MySQL"></a>登录MySQL</h2><p><code>mysql -h 127.0.0.1 -P3306 -uroot -p</code></p>
<h2 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h2><p><code>SET PASSWORD=password(&#39;123456&#39;);</code></p>
<h1 id="设置权限"><a href="#设置权限" class="headerlink" title="设置权限"></a>设置权限</h1><p><code>GRANT ALL PRIVILEGES ON *.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39; WITH GRANT OPTION;</code></p>
<h1 id="查看权限"><a href="#查看权限" class="headerlink" title="查看权限"></a>查看权限</h1><p><code>SHOW GRANTS FOR &#39;root&#39;@&#39;%&#39;;</code></p>
<h1 id="设置mysqld-multi为开机自启动"><a href="#设置mysqld-multi为开机自启动" class="headerlink" title="设置mysqld_multi为开机自启动"></a>设置mysqld_multi为开机自启动</h1><ol>
<li><p><code>sudo vim /etc/rc.d/rc.local</code></p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">mysqld_multi --defaults-extra-file=/etc/mysql_multi.cnf start</span><br></pre></td></tr></table></figure>
</li>
<li><p>赋予<code>rc.local</code>可执行权限<code>chmod +x  /etc/rc.d/rc.local</code></p>
</li>
<li><p><code>sudo vim /usr/lib/systemd/system/rc-local.service</code></p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置<code>rc-local.service</code>服务开机运行<code>systemctl enable rc-local.service</code></p>
</li>
</ol>
<h1 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h1><h2 id="Warning-World-writable-config-file-‘-etc-mysql-multi-cnf’-is-ignored"><a href="#Warning-World-writable-config-file-‘-etc-mysql-multi-cnf’-is-ignored" class="headerlink" title="Warning: World-writable config file ‘/etc/mysql_multi.cnf’ is ignored"></a>Warning: World-writable config file ‘/etc/mysql_multi.cnf’ is ignored</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@HSB-DEV-001 ~]# /usr/local/mysql/bin/mysqld_multi --defaults-extra-file=/etc/mysql_multi.cnf report</span><br><span class="line">Warning: World-writable config file &apos;/etc/mysql_multi.cnf&apos; is ignored</span><br><span class="line">Warning: World-writable config file &apos;/etc/mysql_multi.cnf&apos; is ignored</span><br><span class="line">Reporting MySQL servers</span><br><span class="line">Warning: World-writable config file &apos;/etc/mysql_multi.cnf&apos; is ignored</span><br><span class="line">MySQL server from group: mysqld3307 is running</span><br></pre></td></tr></table></figure>
<p>当配置文件的权限为任何人都可访问时,MySQL任务不安全会忽略配置文件,改为644即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@HSB-DEV-001 ~]# chmod 644 /etc/mysql_multi.cnf</span><br></pre></td></tr></table></figure></p>
<h2 id="doesn’t-have-a-default-value"><a href="#doesn’t-have-a-default-value" class="headerlink" title="doesn’t have a default value"></a>doesn’t have a default value</h2><p>重启MySQL实例后执行SQL命令报如下错误,经查是开启了MySQL严格模式导致的,使用select @@sql_mode;语句查看MySQL实例的模式,发现确实是开启了严格模式,查看MySQL配置配置,发现已经设置不使用严格模式,最后发现是MySQL读取了多个配置文件导致的,MySQL在读取了首选配置文件后又读取了别的配置文件导致设置的默认被覆盖.</p>
<h3 id="查看MySQL模式"><a href="#查看MySQL模式" class="headerlink" title="查看MySQL模式"></a>查看MySQL模式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select @@sql_mode;</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">| @@sql_mode                                 |</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">| STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION |</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>在sql_mode中有STRICT_TRANS_TABLES则表示开启严格模式, 使用mysql严格模式可以使数据更加安全严格，缺点是减少了对空数据入库的兼容性, 严格模式功能说明:</p>
<ol>
<li>不支持对not null字段插入null值</li>
<li>不支持对自增长字段插入值</li>
<li>不支持text字段有默认值</li>
</ol>
<h3 id="查看MySQL默认配置文件和优先顺序"><a href="#查看MySQL默认配置文件和优先顺序" class="headerlink" title="查看MySQL默认配置文件和优先顺序"></a>查看MySQL默认配置文件和优先顺序</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[CaseZheng@VM_187_252_centos ~]$ mysql --help|grep &apos;my.cnf&apos;</span><br><span class="line">/etc/mysql/my.cnf /etc/my.cnf ~/.my.cnf</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.casezheng.date/2018/07/13/rabbitmq/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CaseZheng">
      <meta itemprop="description" content="CaseZheng的博客网站">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CaseZheng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/13/rabbitmq/" class="post-title-link" itemprop="url">RabbitMQ</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-13 15:02:50" itemprop="dateCreated datePublished" datetime="2018-07-13T15:02:50+08:00">2018-07-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-08-28 23:03:00" itemprop="dateModified" datetime="2018-08-28T23:03:00+08:00">2018-08-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/高性能服务器/" itemprop="url" rel="index"><span itemprop="name">高性能服务器</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="RabbitMQ的安装"><a href="#RabbitMQ的安装" class="headerlink" title="RabbitMQ的安装"></a>RabbitMQ的安装</h1><p><a href="http://www.rabbitmq.com/" target="_blank" rel="noopener">RabbitMQ官网</a><br>系统版本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CaseZheng@VM_187_252_centos ~]$ uname -a</span><br><span class="line">Linux VM_187_252_centos 3.10.0-693.17.1.el7.x86_64 #1 SMP Thu Jan 25 20:13:58 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line"></span><br><span class="line">[CaseZheng@VM_187_252_centos ~]$ cat /etc/redhat-release</span><br><span class="line">CentOS Linux release 7.4.1708 (Core)</span><br></pre></td></tr></table></figure></p>
<p>RabbitMQ基于Erlang,需要先安装Erlang环境</p>
<h2 id="Erlang安装"><a href="#Erlang安装" class="headerlink" title="Erlang安装"></a>Erlang安装</h2><p>Erlang的版本需要看下<a href="http://www.rabbitmq.com/which-erlang.html" target="_blank" rel="noopener">RabbitMQ的对应版本的要求</a><br>Erlang的<a href="https://www.erlang.org/downloads" target="_blank" rel="noopener">下载页面</a></p>
<p>下载Erlang到本地<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://erlang.org/download/otp_src_21.0.tar.gz</span><br></pre></td></tr></table></figure></p>
<p>解压并安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf otp_src_21.0.tar.gz</span><br><span class="line">cd otp_src_21.0/</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; sudo make install</span><br></pre></td></tr></table></figure></p>
<p>默认使用默认路径 如需更改需要在 ./configure 时指定 如:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/opt/erlang</span><br></pre></td></tr></table></figure></p>
<p>输入erl有以下提示则为安装成功<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[CaseZheng@VM_187_252_centos ~]$ erl</span><br><span class="line">Erlang/OTP 21 [erts-10.0] [source] [64-bit] [smp:1:1] [ds:1:1:10] [async-threads:1] [hipe]</span><br><span class="line">Eshell V10.0  (abort with ^G)</span><br><span class="line">1&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="RabbitMQ安装"><a href="#RabbitMQ安装" class="headerlink" title="RabbitMQ安装"></a>RabbitMQ安装</h2><p>下载RabbitMQ 这里安装rabbitmq的generic版本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.7.7/rabbitmq-server-generic-unix-3.7.7.tar.xz</span><br></pre></td></tr></table></figure></p>
<p>解压<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar xvJf rabbitmq-server-generic-unix-3.7.7.tar.xz</span><br></pre></td></tr></table></figure></p>
<p>移动 rabbitmq_server-3.7.7 到 /usr/local/ 并重命名为rabbitmq<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mv rabbitmq_server-3.7.7 /usr/local/rabbitmq</span><br></pre></td></tr></table></figure></p>
<p>给/etc/profile加入环境变量如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$PATH:/usr/local/rabbitmq/sbin</span><br></pre></td></tr></table></figure></p>
<p>使环境变量生效<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure></p>
<p>启用rabbitmq网页管理插件(该插件实际已随rabbitmq安装,启用即可)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure></p>
<p>启动rabbitmq<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rabbitmq-server -detached</span><br><span class="line">ERROR: epmd error for host bogon: timeout (timed out)</span><br></pre></td></tr></table></figure></p>
<p>出现此报错信息是因为解析不了主机名 修改hosts 将主机名解析到127.0.0.1或者当前机器的内网地址</p>
<p>查看启动成功<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[CaseZheng@VM_187_252_centos ~]$ netstat -tunlp | grep beam</span><br><span class="line"> tcp        0      0 0.0.0.0:15672           0.0.0.0:*               LISTEN      31942/beam.smp</span><br><span class="line"> tcp        0      0 0.0.0.0:25672           0.0.0.0:*               LISTEN      31942/beam.smp</span><br><span class="line"> tcp6       0      0 :::5672                 :::*                    LISTEN      31942/beam.smp</span><br><span class="line"> udp        0      0 0.0.0.0:46173           0.0.0.0:*                           31942/beam.smp</span><br></pre></td></tr></table></figure></p>
<p>添加用户 设置用户组 授权<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl add_user root 123456</span><br><span class="line">rabbitmqctl set_user_tags root administrator</span><br><span class="line">rabbitmqctl set_permissions -p / root &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span><br></pre></td></tr></table></figure></p>
<p>可通过外网地址+15672端口号的形式访问web管理界面,需要开放15672端口</p>
<h1 id="RabbitMQ介绍"><a href="#RabbitMQ介绍" class="headerlink" title="RabbitMQ介绍"></a>RabbitMQ介绍</h1><p>RabbitMQ是由Erlang语言开发的AMQP的开源实现<br>AMQP(Advanced Message Queuing Protocol 高级消息队列协议)是一个开放的应用层协议,为面对消息的中间件而设计,基于此协议的客户端和消息中间件可传递消息.</p>
<p><img src="/Picture/RabbitMq.png" alt="RabbitMQ结构图"></p>
<h2 id="AMQP模型简介"><a href="#AMQP模型简介" class="headerlink" title="AMQP模型简介"></a>AMQP模型简介</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">                   |---------------------------------|</span><br><span class="line">                   |                                 |</span><br><span class="line">生产者 ---publish--|-&gt; Exchange ---Routes---&gt; Queue -|--consumes---&gt; 消费者</span><br><span class="line">                   |                                 |</span><br><span class="line">                   |-------- Brokers(消息代理) ------|</span><br></pre></td></tr></table></figure>
<p>生产者发布消息到交换机,交换机根据路由规则将消息转发到消息队列,消息队列从消息队列取数据消费.<br>生产者可以在发布消息时给消息指定各种消息属性.消息的属性有的会被消息代理(brokers)使用,有的则完全不透明,只能由被接收消息的应用所使用.<br>由于网络是不可靠的,而且消费者处理消息也可能失败,为了保证消息可靠的被处理掉,AMQP包含了消息确认机制,当消息从队列投递到消费者后,消费者需通知消息代理,进行确认,这个确认操作可以是自动的,也可以由处理消息的消费者执行.当消息确认机制启用时,消息代理不会完全将消息从队列中删除,直到它收到来自消费者的确认信息.</p>
<h3 id="交换机和交换机类型"><a href="#交换机和交换机类型" class="headerlink" title="交换机和交换机类型"></a>交换机和交换机类型</h3><p>交换机负责消息的路由,使用的路由算法由交换机和绑定规则决定.</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">交换机类型(Exchange Type)</th>
<th style="text-align:center">预声明的默认名称</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Direct exchange</td>
<td style="text-align:center">(Empty string) 或 amq.direct</td>
</tr>
<tr>
<td style="text-align:center">Fanout exchange</td>
<td style="text-align:center">amq.fanout</td>
</tr>
<tr>
<td style="text-align:center">Topic exchange</td>
<td style="text-align:center">amq.topic</td>
</tr>
<tr>
<td style="text-align:center">Headers exchange</td>
<td style="text-align:center">amq.match</td>
</tr>
</tbody>
</table>
</div>
<p>交换机除类型外,在申明交换机时还有许多其它属性,主要的有:</p>
<ul>
<li>Name</li>
<li>Durability 消息代理重启后,交换机是否存在</li>
<li>Auto-delete 在所有与之绑定的消息队列都完成对此交换机的使用后,删除它</li>
</ul>
<p>交换机有两个状态:持久(durable)和暂存(transient),持久化的交换机在消息代理重启后依然存在,而暂存的交换机则不会.</p>
<h4 id="默认交换机"><a href="#默认交换机" class="headerlink" title="默认交换机"></a>默认交换机</h4><p>默认交换机是一个由消息代理预先声明的名字为空字符串的amq.direct交换机</p>
<h4 id="Direct-exchange-直连交换器-路由键完全匹配"><a href="#Direct-exchange-直连交换器-路由键完全匹配" class="headerlink" title="Direct exchange(直连交换器 路由键完全匹配)"></a>Direct exchange(直连交换器 路由键完全匹配)</h4><p>direct exchange是根据消息携带的路由键将消息投递给对应队列的.direct exchange用来处理消息的单播路由</p>
<ol>
<li>将一个队列绑定在某个交换机上,同时绑定一个路由键</li>
<li>当一个携带路由键R的消息被发送到直连交换机时,交换机会将该消息路由给绑定值同样为R的队列<br>direct交换器当路由键完全匹配队列绑定键才路由消息到绑定的队列</li>
</ol>
<h4 id="Fanout-exchange-扇形交换器-不理会路由键"><a href="#Fanout-exchange-扇形交换器-不理会路由键" class="headerlink" title="Fanout exchange(扇形交换器 不理会路由键)"></a>Fanout exchange(扇形交换器 不理会路由键)</h4><p>fanout exchange将消息路由给绑定在它身上的所有队列,不理会绑定的路由键.如果N个队列绑定在某个扇形交换机上,当有消息发送到此扇形交换机时,交换机将消息的拷贝发送给所有的N个队列.funout exchange用来处理消息的广播路由.</p>
<h4 id="Topic-exchange-路由键部分匹配"><a href="#Topic-exchange-路由键部分匹配" class="headerlink" title="Topic exchange(路由键部分匹配)"></a>Topic exchange(路由键部分匹配)</h4><p>topic exchange通过对消息的路由键和队列到交换机的绑定模式之间的匹配,将消息路由给一个或多个队列.topic exchange经常用来实现各种分发/订阅模式及其变种.topic exchange用来实现消息的多播路由.<br>路由键部分匹配,路由键的约定如下:</p>
<ol>
<li>路由键为一个句点号”.”分隔的字符串(被”.”分割的每一段独立的字符串称为一个单词),例如:”product.conf.del”, “price.conf.add”</li>
<li>绑定键和路由键都是”.”分隔的字符串</li>
<li>绑定键可以存在两种特殊字符”<em>“和”#”,用于模糊匹配,”</em>“用于匹配一个单词,”#”用于匹配多个单词(可以匹配零个)</li>
</ol>
<h4 id="Headers-exchange"><a href="#Headers-exchange" class="headerlink" title="Headers exchange"></a>Headers exchange</h4><p>消息的路由操作如果涉及到多个属性,使用消息头比用路由键更容易表达,headers exchange使用多个消息属性代替路由键建立路由规则.通过判断消息头的值能否与指定的绑定相匹配来确定路由规则.</p>
<h3 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h3><p>队列(queue)存储着即将被应用消费掉的消息.<br>队列属性:</p>
<ol>
<li>Name</li>
<li>Durable(消息代理重启后,队列依旧存在)</li>
<li>Exclusive(只被一个连接使用,当连接关闭后队列即被删除)</li>
<li>Auto-delete(当最后一个消费者退订后即被删除)</li>
<li>Arguments</li>
</ol>
<p>队列在声明(declare)后才能被使用.如果一个队列尚不存在,声明一个队列会创建它.如果声明的队列已经存在,并且属性完全相同.那么此次声明不会对原有队列产生任何影响.如果声明中的属性与已存在队列的属性有差异,那么一个错误代码为406的通道级异常就会被抛出</p>
<h4 id="队列名称"><a href="#队列名称" class="headerlink" title="队列名称"></a>队列名称</h4><p>队列名称可以指定,也可以由消息代理生成,队列名称是最多255字节的一个utf-8字符串.如果想让消息代理生成队列名,需要给消息队列的name参数赋值一个空字符串(在统一个通道的后续方法中可以使用空字符串表示之前生成的队列名称,因为通道可以默默记住消息代理最后一次生成的队列名称).<br>以”amq.”开始的队列名称被预留给消息代理内部使用.</p>
<h4 id="队列持久化"><a href="#队列持久化" class="headerlink" title="队列持久化"></a>队列持久化</h4><p>持久化队列(Durable queues)会被存储在磁盘上,当消息代理重启时它依然存在,没有被持久话的队列被称为暂存队列(Transient queues).<br><strong>持久化队列并不会使得路由到它的消息也持久化,只有持久化的消息才能在消息代理重启后重新恢复.</strong></p>
<h4 id="绑定"><a href="#绑定" class="headerlink" title="绑定"></a>绑定</h4><p>绑定是交换机将消息路由给队列所需遵循的规则.<br>AMQP的消息无法路由到队列,消息会被就地销毁或者返还给发布者.如何处理取决于发布者设置的消息属性</p>
<h4 id="消费者"><a href="#消费者" class="headerlink" title="消费者"></a>消费者</h4><p>消费者有两种方式消费数据:</p>
<ol>
<li>消息代理主动将消息投递给消费者(push API)</li>
<li>消费者根据需要主动获取消息(pull API)</li>
</ol>
<h4 id="消息确认"><a href="#消息确认" class="headerlink" title="消息确认"></a>消息确认</h4><p>消息代理删除消息的时机:</p>
<ol>
<li>当消息代理将消息发送给应用后立即删除(自动确认)</li>
<li>待应用发送一个确认回执后再删除(显式确认)</li>
</ol>
<h4 id="拒绝消息"><a href="#拒绝消息" class="headerlink" title="拒绝消息"></a>拒绝消息</h4><p>消费者可以在处理某条消息后向消息代理表明如何处理该消息,销毁它或者重新放入队列.</p>
<h3 id="消息属性"><a href="#消息属性" class="headerlink" title="消息属性"></a>消息属性</h3><ol>
<li>Content type(内容类型)</li>
<li>Content encoding(内容编码)</li>
<li>Routing key(路由键)</li>
<li>Delivery mode(persistent or not)投递模式(持久化或非持久化)</li>
<li>Message priority(消息优先权)</li>
<li>Message publishing timestamp(消息发布的时间戳)</li>
<li>Expiration period(消息有效期)</li>
<li>Publisher application id(发布应用ID)</li>
</ol>
<h3 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h3><p>AMQP连接通常为长连接,AMQP是一个使用TCP提供可靠投递的应用层协议.AMQP使用认证机制并且提供TLS(SSL)保护.当一个应用不再需要连接到AMQP代理时,需要优雅的释放AMQP连接,而不是直接关闭TCP连接.</p>
<h3 id="通道"><a href="#通道" class="headerlink" title="通道"></a>通道</h3><p>一个应用可能会和AMQP代理建立多个连接,此时同时开启多个TCP连接不合适,会消耗过多的系统资源,AMQP提供通道来处理多连接,可以将通道理解为共享一个TCP的多个轻量化连接.在多线程/多进程应用中可为每个线程/进程开启一个通道,这些通道不能被线程/进程共享.<br>一个特定通道上的通讯和其它通道上的通信是完全隔离的,因此每个AMQP方法都需要携带一个通道号.</p>
<h3 id="虚拟主机"><a href="#虚拟主机" class="headerlink" title="虚拟主机"></a>虚拟主机</h3><p>为了在一个单独的AMQP代理上实现多个隔离环境(用户、用户组、交换机、队列等),AMPQ提供虚拟主机概念(vhosts),为AMQP实体提供完全隔离的环境.当连接建立时,AMQP客户端指定使用的虚拟主机.</p>
<h3 id="AMQP可扩展"><a href="#AMQP可扩展" class="headerlink" title="AMQP可扩展"></a>AMQP可扩展</h3><h1 id="RabbitMQ-c客户端的使用"><a href="#RabbitMQ-c客户端的使用" class="headerlink" title="RabbitMQ c客户端的使用"></a>RabbitMQ c客户端的使用</h1><h2 id="c客户端编译安装"><a href="#c客户端编译安装" class="headerlink" title="c客户端编译安装"></a>c客户端编译安装</h2><p>编译安装看git说明即可<a href="https://github.com/alanxz/rabbitmq-c" target="_blank" rel="noopener">rabbitmq-c git网址</a></p>
<h2 id="api说明"><a href="#api说明" class="headerlink" title="api说明"></a>api说明</h2><p>api可查看官方文档或头文件注释<a href="http://alanxz.github.io/rabbitmq-c/docs/0.8.0/" target="_blank" rel="noopener">rabbitmq-c 官方文档</a></p>
<h2 id="原始c接口的封装"><a href="#原始c接口的封装" class="headerlink" title="原始c接口的封装"></a>原始c接口的封装</h2><p><a href="https://github.com/CaseZheng/SimpleServerFramework/tree/master/comm/rabbitmq" target="_blank" rel="noopener">rabbitmq-c 原始c接口的简单封装</a></p>
<h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><ul>
<li><a href="https://www.cnblogs.com/dwlsxj/p/RabbitMQ.html" target="_blank" rel="noopener">RabbitMQ基础知识</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.casezheng.date/2018/07/12/simple-server-framework/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CaseZheng">
      <meta itemprop="description" content="CaseZheng的博客网站">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CaseZheng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/12/simple-server-framework/" class="post-title-link" itemprop="url">服务器框架设计与编码</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-12 18:16:50" itemprop="dateCreated datePublished" datetime="2018-07-12T18:16:50+08:00">2018-07-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/cpp/" itemprop="url" rel="index"><span itemprop="name">cpp</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>一个libevent和boost库写的轻量级服务器框架</p>
<h1 id="总体服务器框架"><a href="#总体服务器框架" class="headerlink" title="总体服务器框架"></a>总体服务器框架</h1><p>先看下总体的服务器框架设计图<br><img src="https://www.plantuml.com/plantuml/svg/ZPDVIiD04CRVznG31QbemUT4Ip5KB8X8zJrijgjTI3PXTn84zG2Un4Fuu6tq6axM_Aj9IVCIldpV_2OpcomiSeDv4ZCHSsjXTMLu8k650LqdXIAFnn2bQGmhhN0gKcqHB1gbd-28xlVI5DBSKj4fzCmWrOzt7BV75sV-076Tw-aUQ_bCpPpdp4a5JSATbdxVh5lwx8rLCmNrJEsJ6nN9GchiJZkXnXOzpswvaPimGtDEl5mWk6WOSIldr2HRblAIb3z0l4RCHgX1cVaRml5QEGHSPsACHv4Ehb53j0Sn-dOKwT0QDKXJYJIZl3BK9RRQCQlZcUNPx7LUVu0U_7n-VBz_iNz7LQM2VQbs_NLojxvVqUptq89cXGSNj5iQALb8lQ5_yHS0"><br>服务器启动,根据不同服务实例化出对应的CLibeventFrame实例,例如Http服务器实例化CLibeventHttpFrame,Rpc服务实例化CLibeventRpcFrame,Tcp服务实例化CLibeventTcpFrame,Timer定时器服务实例化CLibeventTimerFrame.然后运行初始化函数Init(初始化日志,拉取配置文件等操作),然后运行Run函数启动反应堆.</p>
<h1 id="Http服务器"><a href="#Http服务器" class="headerlink" title="Http服务器"></a>Http服务器</h1><p><a href="https://github.com/CaseZheng/SimpleServerFramework/tree/master/libevent_http_frame" target="_blank" rel="noopener">Http服务器代码</a></p>
<p>Http服务器类图如下:<br><img src="https://www.plantuml.com/plantuml/svg/XLLTRzem57rkVeMbIGXeG7kc3BLDgShKQOW2UuoSv1Oo4YUp7RIfst_VTUo4VBWgBzZtt8_ZUu-TMo4fbqMQE652XI3USnp06PXyaZ9_v3G5ykOG_7qAiap8sKmSAOV8poMVUyhd1VWP-8AaVdxPtZZ_d2hXnOgPhgunJK9MB9R3qKsrlOkY7O-7OSQ494Boc1t80F_Hw9Bb_ccxNVlUFGa3bvopE2BZCA3yeE8dVLOOLuIIb8Vm0ogWvBPKstlSVH1qHBOcG16tUtjh6fv0bdvwgVpE4CgCpv7qYhrc2aIBsJKReYDCMw-n_p8EzRbKHIyOQXO-Xry5O4F6-jHZF6yPSOvnO3GXPUiUW2OwuN3qvRFnA16Tx4MDTpZg0qiMLUO9i28rP_V3DFBbdnoGFYZFBQwDcvbCwkDYnIp67KSkylWUWceI5cm38lUoo5RbUo6j0LHaLVrki-hHRRIbt_blM2lfjB-IuOf9uAyqX9OO1wGIOq-YTO1BF3KBdNoSr-iFfuRurSJGI6a-rydTrjeYmRh0Oa6KrWebDCEbnbJjKi09yOuGdkvOj6Cv5gv7NzDfMzPDd_RSJGqBjerJR3XDSs4DF6SdM4KMQ0zSn9bDK1vD4k3wzR26Ri0k4FcEe13Hrx54lgACPhCzJGebzvyjXNQm1off2q4HHlYa8QHNBV2H2lc3nr8xN7PDCLxKKagnBH3CcPHJCOfhiXaOecvJXtYmxbwre6jJXtSxsTJHohVZmctv6wUOm7DsG56-zO7w2KF4yiMOJdbyEChfeldwEwthDodooTz5TIMTvbUY4LsXpSZfL25rzvmssIfl7pUSEuMTMs0HVlx-0m00"><br>在调用CLibeventHttpFrame的Init函数时,除了初始化框架的日志,配置等模块外,还会生成CHttpServer实例,并运行HttpServer的初始化Init函数,给evhttp设置相应uri对应的回调函数,最后返回.等框架启动反应堆后,当有请求到来,会调用CPacket的DealPacket函数,解析请求,并通过uri分发请求,如果为默认的请求则分发到CPacketModel,并根据Interface分发到不同的CDealModel,自定义URI则分发到别的具体的CPacket实例,例如示例CExamplePacket.</p>
<h1 id="Timer服务器"><a href="#Timer服务器" class="headerlink" title="Timer服务器"></a>Timer服务器</h1><p><a href="https://github.com/CaseZheng/SimpleServerFramework/tree/master/libevent_timer_frame" target="_blank" rel="noopener">Timer服务器代码</a></p>
<p>Timer服务器类图如下:<br><img src="https://www.plantuml.com/plantuml/svg/ZLHDJyCm33sllo8I4ke-nNcCQQmhg19SjebhbRPcYqZRAV4Y9E2_aoKjJLc7wCtni_tyR7SXaGeyvjppKawb9C4JIq11WLkMWtWGD0VouH7zNILbAN4wbNig88iFA6Q10Mr0A11paiS7nxxrldvoEiywMM-eCt4I5Gpz_gt9FTGqaAMaSaWGjhuVkQ43Dx-Dx8tFMKaKnnI9wI9Eg0H3BJoPIstPYkEgee8KIp4xp-9Mdl_HNDHkpkr6bImZnXqaFgWZCXxBCdq3Z96yPYCYzwMeYCgHXGy85RjQ5VEo1WcL6bR80R5KQfGHRNEQeqF5xrjv5DFZfTmgMt4ns5hwJaHOPDt-Hqj5KUvNCgCroJMgFhaZDnUpha07kP1B-zI8VRP3Lk1gWUwppCgIbeL4qi775MW5tABhliANRVGShkDWgUkbIStR326FzHGkqdGNhDcjVy4xzx5fCdod-O53tQjsTDtZP2BORe-JUUkolDQPDHXtGRse6sD3lNRzyVZpL_G2Yap_Axu1"><br>在调用CLibeventTimerFrame的Init函数时,除了初始化框架的日志,配置等模块外,还会生成CTimerServer实例,并运行CTimerServer的初始化Init函数,生成定时器,最后启动定时器,当定时器激活后根据注册的ItimerServer执行相应的应用代码</p>
<h1 id="Tcp服务器"><a href="#Tcp服务器" class="headerlink" title="Tcp服务器"></a>Tcp服务器</h1><p><a href="https://github.com/CaseZheng/SimpleServerFramework/tree/master/libevent_tcp_frame" target="_blank" rel="noopener">Tcp服务器代码</a></p>
<p>Tcp服务器类图如下:<br><img src="https://www.plantuml.com/plantuml/svg/hLPRRvim57xdLrYQLD6Ce3sdNLGrRRT8dLgjc_Q833YfLR2HRPYcRlzznnYC3QHff_MXujo-Sp_nXLHOgBeiWgp0KgBDBKr9GvZwbbKt0fS4FGS8_jwbd4krMib7B4YUL4gSRq3bWOY6Y3KgayfIPy6Ve4Upp0xcFS0KQCke2a_F3AVXD4VN0alomBCdeZvZbXVayfUXGieKal3PgsUSIOMcqMpl1LSyuyKQdNmYofBXKSChWeilF2UzfQLxqoNKID4CcKYR3MVibaf5616RD9HAr9b2f047hEZuQ87CHmI2Mj4YaMqwYKacGfsL9d2UYmNI_oEaioq8Yuol1O80vu8mjVbAS0u1Q9jT3f2FNEWue7co1y1YVzZ-Xw2Al0MWInJaIGhzMY0erxKcBu6orPgP5BUpQstbj_ecxsBe8LhVMoQ9y3JjC4Jeg9EJogKFnpRRldQW_KuV1-ZBqXbtPR75orUh4bVdaCBnw3L4wN8EUdV67hpsn65rPzX1trBEpbh4VcKR2WS25wXTtU-imjaJPVlmXKgazMwdYtYYFo90n3gJrX5QL2rnYZwY3sSp3eok_3_mGr8sqzcijDIWX6ySh6Zs50q1QVqjSnZZo3nq6roxf6R3sqaANvuxxQNLyuxgGxVY_uvmBGGNTs9JS4bWIJsPZkqAA-npMuTJjbRk2ZnLFrZvSI7lQkLMifjoVHJAX9ewtkJ3jO8f1G5yR0eAcMshL-rmknYsyAyt6KfztAQVu39fjAVBbdoJMUjDp1d-9FZfjR_FtkeyEqDvdpfNm6LxipoI-UrnXVSfd4AQQIdUav6Pkvh0dxv0ubZG_QEAryvx8d2U5d5SLo2qXsjEPftuGWliRc7WxsGS5sGtzZxIw08OiW-6Cnh74zcGybGOkCLVBdzxYOqRiAmhe-40J3jnG6i4fLNyHir1pMiD2Pc8Xt875uJbyBxy2m00"><br>在调用CLibeventTcpFrame的Init函数时,除了初始化框架的日志,配置等模块外,还会生成CTcpServer实例,并运行CTcpServer的初始化Init函数,生成具体的IDealModel实例化对象和IProtocol实例化对象,返回后框架启动反应堆,当有请求到来时生成一个CSocketHandle对象,并记录到CTcpServer中,对发过来的信息,通过IProtocol实例解析报文,并将解析后的信息存放在生成的IPacketModel实例中,将IPacketModel实例传递给IDealModel实例进行业务逻辑的处理.</p>
<h1 id="Rpc服务器"><a href="#Rpc服务器" class="headerlink" title="Rpc服务器"></a>Rpc服务器</h1><p><a href="https://github.com/CaseZheng/SimpleServerFramework/tree/master/libevent_rpc_frame" target="_blank" rel="noopener">Rpc服务器代码</a></p>
<p>Rpc服务器类图如下:</p>
<p><img src="https://www.plantuml.com/plantuml/svg/XLHDRzim3BtxLmWeK2HP4-oST4KTrscxsLdchjlHK6pMyIPBggIa0xRzzz7oHvGbG7mI-SX7Ye_MhJPKcMt5l8nHhKaGbMlO0JU9p1QALa1-UmI_YxKGsaodUaCLvAaqwZh0a2TGEr0tf4fbRysylrxBziWDg1UQmID_4ItJknDCaIZApBBOqwm9r4QLl40l7fROoemq_i2FedJk1v_gX80oDgVPpmvCmY_fClnkEuBN9Rnrm4wKEHdj_Rugt9n54eOjk500iptol8pzvEd1ZrhucLTKOVUiYrb5VKN9wef71QtRBOWfVK79t8A819_ZLHH-xT10L9A1SIFSXYIBktRwkU-bSOREK8xI38ODp_XO1XppDZF4of-kgGQhI5YRSxJEvssCaMtE0nxF9oYPkOMmQwVG3Z8ZrFN13jM1w3_mkVUswzFT6LVRe6Lrk0FAOf436nmKL_2Q5i11OToe5lU-CQwQh954qOQTdYN-A9GHEye4-MhEGIQuDkIZ5dmw_KRP5iZbZnN5F-VgF-STDNJuuNrxkIQjtV1BSWyc0HDWWxq-nn6XKkSZObrq0HVk3zJIdq1QsjC8qjdv7hyBauagYusPt3ZRvZcBjySFrF8EtmI7nMhd1U4lMkzxe-Gu5szy_AT7lLlWERvM_m00"><br>在调用CLibevenRpcFrame的Init函数时,除了初始化框架的日志,配置等模块外,还会生成CRpcServer实例,并运行CTcpServer的初始化Init函数,将InterfaceInfo信息通过evrpc_register_generic注册到libevent中,然后返回,框架启动反应堆,如果收到rpc请求则会调用注册的各个回调函数,包括生成请求参数结构体,将请求信息解码到请求信息结构体中,生成返回信息结构体,业务处理回调函数,将返回信息结构体重新编码为字节流的回调函数等.<br>libevent的rpc框架中存在一个问题,如果请求参数为空会core掉,经查是libevent的一个bug.已经提了<a href="https://github.com/libevent/libevent/issues/660" target="_blank" rel="noopener">Issues</a>.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.casezheng.date/2018/06/08/elasticsearch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CaseZheng">
      <meta itemprop="description" content="CaseZheng的博客网站">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CaseZheng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/08/elasticsearch/" class="post-title-link" itemprop="url">elasticsearch入门学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-06-08 10:54:14" itemprop="dateCreated datePublished" datetime="2018-06-08T10:54:14+08:00">2018-06-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-10-13 10:54:14" itemprop="dateModified" datetime="2018-10-13T10:54:14+08:00">2018-10-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/other/" itemprop="url" rel="index"><span itemprop="name">other</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>Elasticsearch是一个分布式、可扩展、实时的搜索和数据分析引擎。支持全文索引、结构化搜索、数据分析。</p>
<ul>
<li>一个分布式的实时文档存储，每个字段 可以被索引与搜索</li>
<li>一个分布式实时分析搜索引擎</li>
<li>能胜任上百个服务节点的扩展，并支持 PB 级别的结构化或者非结构化数据</li>
</ul>
<h1 id="Elasticsearch和Lucene关系"><a href="#Elasticsearch和Lucene关系" class="headerlink" title="Elasticsearch和Lucene关系"></a>Elasticsearch和Lucene关系</h1><p>Elasticsearch基于Lucene开发而来,Lucene是一个搜索引擎框架,基于Lucene开发需要做大量工作,调用各种API接口.<br>Elasticsearch隐藏了Lucene的复杂性,提供了分布式方案.</p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>从官网下载最新版本安装,步骤看官网文档即可</p>
<h1 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/elasticsearch</span><br></pre></td></tr></table></figure>
<p>可以在后面添加参数 -d, 使Elasticsearch作为一个守护进程在后台运行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">curl &apos;http://localhost:9200/?pretty&apos;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot; : &quot;YZ_zxCT&quot;,</span><br><span class="line">  &quot;cluster_name&quot; : &quot;elasticsearch&quot;,</span><br><span class="line">  &quot;cluster_uuid&quot; : &quot;BKMvoXKrTW-4mj2OyOfibw&quot;,</span><br><span class="line">  &quot;version&quot; : &#123;</span><br><span class="line">    &quot;number&quot; : &quot;5.6.3&quot;,</span><br><span class="line">    &quot;build_hash&quot; : &quot;1a2f265&quot;,</span><br><span class="line">    &quot;build_date&quot; : &quot;2017-10-06T20:33:39.012Z&quot;,</span><br><span class="line">    &quot;build_snapshot&quot; : false,</span><br><span class="line">    &quot;lucene_version&quot; : &quot;6.6.1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;tagline&quot; : &quot;You Know, for Search&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p>具体可查看Elasticsearch<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.0/getting-started.html" target="_blank" rel="noopener">官方文档</a></p>
<p>Elasticsearch中文资料</p>
<ol>
<li><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/index.html" target="_blank" rel="noopener">Elasticsearch: 权威指南</a></li>
<li><a href="https://www.yiibai.com/elasticsearch" target="_blank" rel="noopener">Elasticsearch教程</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.casezheng.date/2018/06/03/linux-signal/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CaseZheng">
      <meta itemprop="description" content="CaseZheng的博客网站">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CaseZheng">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/03/linux-signal/" class="post-title-link" itemprop="url">linux信号</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-06-03 22:18:14" itemprop="dateCreated datePublished" datetime="2018-06-03T22:18:14+08:00">2018-06-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="不可忽略或捕获的信号SIGSTOP和SIGKILL"><a href="#不可忽略或捕获的信号SIGSTOP和SIGKILL" class="headerlink" title="不可忽略或捕获的信号SIGSTOP和SIGKILL"></a>不可忽略或捕获的信号SIGSTOP和SIGKILL</h2><p>一般的信号可以使用signal函数忽略或捕获做进一步处理,而SIGSTOP和SIGKILL信号不可捕获,自然也没有办法忽略了.</p>
<h2 id="在命令行使用kill-l命令可以列出所有linux信号"><a href="#在命令行使用kill-l命令可以列出所有linux信号" class="headerlink" title="在命令行使用kill -l命令可以列出所有linux信号"></a>在命令行使用kill -l命令可以列出所有linux信号</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[CaseZheng@VM_187_252_centos example]$ kill -l</span><br><span class="line"> 1) SIGHUP       2) SIGINT	 	 3) SIGQUIT	 	 4) SIGILL	 	 5) SIGTRAP</span><br><span class="line"> 6) SIGABRT      7) SIGBUS	 	 8) SIGFPE	 	 9) SIGKILL		10) SIGUSR1</span><br><span class="line">11) SIGSEGV	    12) SIGUSR2		13) SIGPIPE		14) SIGALRM		15) SIGTERM</span><br><span class="line">16) SIGSTKFLT	17) SIGCHLD		18) SIGCONT	 	19) SIGSTOP		20) SIGTSTP</span><br><span class="line">21) SIGTTIN	    22) SIGTTOU		23) SIGURG		24) SIGXCPU		25) SIGXFSZ</span><br><span class="line">26) SIGVTALRM	27) SIGPROF		28) SIGWINCH	29) SIGIO		30) SIGPWR</span><br><span class="line">31) SIGSYS	    34) SIGRTMIN	35) SIGRTMIN+1	36) SIGRTMIN+2	37) SIGRTMIN+3</span><br><span class="line">38) SIGRTMIN+4	39) SIGRTMIN+5	40) SIGRTMIN+6	41) SIGRTMIN+7	42) SIGRTMIN+8</span><br><span class="line">43) SIGRTMIN+9	44) SIGRTMIN+10	45) SIGRTMIN+11	46) SIGRTMIN+12	47) SIGRTMIN+13</span><br><span class="line">48) SIGRTMIN+14	49) SIGRTMIN+15	50) SIGRTMAX-14	51) SIGRTMAX-13	52) SIGRTMAX-12</span><br><span class="line">53) SIGRTMAX-11	54) SIGRTMAX-10	55) SIGRTMAX-9	56) SIGRTMAX-8	57) SIGRTMAX-7</span><br><span class="line">58) SIGRTMAX-6	59) SIGRTMAX-5	60) SIGRTMAX-4	61) SIGRTMAX-3	62) SIGRTMAX-2</span><br><span class="line">63) SIGRTMAX-1	64) SIGRTMAX</span><br></pre></td></tr></table></figure>
<h2 id="Linux信号的捕获"><a href="#Linux信号的捕获" class="headerlink" title="Linux信号的捕获"></a>Linux信号的捕获</h2><h3 id="signal"><a href="#signal" class="headerlink" title="signal"></a>signal</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*<span class="keyword">sighandler_t</span>)</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">sighandler_t</span> <span class="title">signal</span><span class="params">(<span class="keyword">int</span> signum, <span class="keyword">sighandler_t</span> handler)</span></span>;</span><br></pre></td></tr></table></figure>
<p>signum信号值<br>handler信号处理函数,有两个特殊值</p>
<ol>
<li>SIG_IGN屏蔽该函数</li>
<li>SIG_DFL恢复默认行为<br>返回值为之前的信号处理函数</li>
</ol>
<h3 id="sigaction"><a href="#sigaction" class="headerlink" title="sigaction"></a>sigaction</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sigaction</span><span class="params">(<span class="keyword">int</span> signum, <span class="keyword">const</span> struct sigaction *act, struct sigaction *oldact)</span></span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sigaction</span> &#123;</span></span><br><span class="line">    <span class="keyword">void</span>     (*sa_handler)(<span class="keyword">int</span>);                    <span class="comment">//信号处理函数</span></span><br><span class="line">    <span class="keyword">void</span>     (*sa_sigaction)(<span class="keyword">int</span>, <span class="keyword">siginfo_t</span> *, <span class="keyword">void</span> *); <span class="comment">//信号处理函数 第二个参数可指向一个siginfo_t结构体</span></span><br><span class="line">    <span class="keyword">sigset_t</span>   sa_mask;                             <span class="comment">//屏蔽信号集</span></span><br><span class="line">    <span class="keyword">int</span>        sa_flags;                            <span class="comment">//</span></span><br><span class="line">    <span class="keyword">void</span>     (*sa_restorer)(<span class="keyword">void</span>);                  <span class="comment">//</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>用于改变进程接收到特定信号后的行为<br>signum信号值<br>act指向sigaction的一个实例指针,在sigaction中制定了对特定信号的处理方式,为空表示使用默认方式对信号进行处理<br>oldact保存原来对信号的处理方式,可以为NULL<br>成功返回0,失败返回-1</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="CaseZheng"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">CaseZheng</p>
  <div class="site-description" itemprop="description">CaseZheng的博客网站</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">130</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/CaseZheng" title="GitHub → https://github.com/CaseZheng" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:764307915@qq.com" title="E-Mail → mailto:764307915@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2017 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CaseZheng</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">717k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">10:52</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  <script src="/js/local-search.js"></script>












  

  

</body>
</html>
